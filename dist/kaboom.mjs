var Qi=Object.defineProperty;var s=(t,e)=>Qi(t,"name",{value:e,configurable:!0});var oo=(()=>{for(var t=new Uint8Array(128),e=0;e<64;e++)t[e<26?e+65:e<52?e+71:e<62?e-4:e*4-205]=e;return n=>{for(var o=n.length,i=new Uint8Array((o-(n[o-1]=="=")-(n[o-2]=="="))*3/4|0),u=0,l=0;u<o;){var m=t[n.charCodeAt(u++)],h=t[n.charCodeAt(u++)],d=t[n.charCodeAt(u++)],M=t[n.charCodeAt(u++)];i[l++]=m<<2|h>>4,i[l++]=h<<4|d>>2,i[l++]=d<<6|M}return i}})();function Ve(t){return t*Math.PI/180}s(Ve,"deg2rad");function gt(t){return t*180/Math.PI}s(gt,"rad2deg");function it(t,e,n){return e>n?it(t,n,e):Math.min(Math.max(t,e),n)}s(it,"clamp");function Ke(t,e,n){if(typeof t=="number"&&typeof e=="number")return t+(e-t)*n;if(t instanceof P&&e instanceof P)return t.lerp(e,n);if(t instanceof ie&&e instanceof ie)return t.lerp(e,n);throw new Error(`Bad value for lerp(): ${t}, ${e}. Only number, Vec2 and Color is supported.`)}s(Ke,"lerp");function Ze(t,e,n,o,i){return o+(t-e)/(n-e)*(i-o)}s(Ze,"map");function io(t,e,n,o,i){return it(Ze(t,e,n,o,i),o,i)}s(io,"mapc");var P=class t{static{s(this,"Vec2")}x=0;y=0;constructor(e=0,n=e){this.x=e,this.y=n}static fromAngle(e){let n=Ve(e);return new t(Math.cos(n),Math.sin(n))}static LEFT=new t(-1,0);static RIGHT=new t(1,0);static UP=new t(0,-1);static DOWN=new t(0,1);clone(){return new t(this.x,this.y)}add(...e){let n=S(...e);return new t(this.x+n.x,this.y+n.y)}sub(...e){let n=S(...e);return new t(this.x-n.x,this.y-n.y)}scale(...e){let n=S(...e);return new t(this.x*n.x,this.y*n.y)}dist(...e){let n=S(...e);return this.sub(n).len()}sdist(...e){let n=S(...e);return this.sub(n).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let e=this.len();return e===0?new t(0):this.scale(1/e)}normal(){return new t(this.y,-this.x)}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}angle(...e){let n=S(...e);return gt(Math.atan2(this.y-n.y,this.x-n.x))}angleBetween(...e){let n=S(...e);return gt(Math.atan2(this.cross(n),this.dot(n)))}lerp(e,n){return new t(Ke(this.x,e.x,n),Ke(this.y,e.y,n))}slerp(e,n){let o=this.dot(e),i=this.cross(e),u=Math.atan2(i,o);return this.scale(Math.sin((1-n)*u)).add(e.scale(Math.sin(n*u))).scale(1/i)}isZero(){return this.x===0&&this.y===0}toFixed(e){return new t(Number(this.x.toFixed(e)),Number(this.y.toFixed(e)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new be(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}};function S(...t){if(t.length===1){if(t[0]instanceof P)return new P(t[0].x,t[0].y);if(Array.isArray(t[0])&&t[0].length===2)return new P(...t[0])}return new P(...t)}s(S,"vec2");var ie=class t{static{s(this,"Color")}r=255;g=255;b=255;constructor(e,n,o){this.r=it(e,0,255),this.g=it(n,0,255),this.b=it(o,0,255)}static fromArray(e){return new t(e[0],e[1],e[2])}static fromHex(e){if(typeof e=="number")return new t(e>>16&255,e>>8&255,e>>0&255);if(typeof e=="string"){let n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return new t(parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16))}else throw new Error("Invalid hex color format")}static fromHSL(e,n,o){if(n==0)return new t(255*o,255*o,255*o);let i=s((M,y,U)=>(U<0&&(U+=1),U>1&&(U-=1),U<1/6?M+(y-M)*6*U:U<1/2?y:U<2/3?M+(y-M)*(2/3-U)*6:M),"hue2rgb"),u=o<.5?o*(1+n):o+n-o*n,l=2*o-u,m=i(l,u,e+1/3),h=i(l,u,e),d=i(l,u,e-1/3);return new t(Math.round(m*255),Math.round(h*255),Math.round(d*255))}static RED=new t(255,0,0);static GREEN=new t(0,255,0);static BLUE=new t(0,0,255);static YELLOW=new t(255,255,0);static MAGENTA=new t(255,0,255);static CYAN=new t(0,255,255);static WHITE=new t(255,255,255);static BLACK=new t(0,0,0);clone(){return new t(this.r,this.g,this.b)}lighten(e){return new t(this.r+e,this.g+e,this.b+e)}darken(e){return this.lighten(-e)}invert(){return new t(255-this.r,255-this.g,255-this.b)}mult(e){return new t(this.r*e.r/255,this.g*e.g/255,this.b*e.b/255)}lerp(e,n){return new t(Ke(this.r,e.r,n),Ke(this.g,e.g,n),Ke(this.b,e.b,n))}toHSL(){let e=this.r/255,n=this.g/255,o=this.b/255,i=Math.max(e,n,o),u=Math.min(e,n,o),l=(i+u)/2,m=l,h=l;if(i==u)l=m=0;else{let d=i-u;switch(m=h>.5?d/(2-i-u):d/(i+u),i){case e:l=(n-o)/d+(n<o?6:0);break;case n:l=(o-e)/d+2;break;case o:l=(e-n)/d+4;break}l/=6}return[l,m,h]}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}toArray(){return[this.r,this.g,this.b]}};function le(...t){if(t.length===0)return new ie(255,255,255);if(t.length===1){if(t[0]instanceof ie)return t[0].clone();if(typeof t[0]=="string")return ie.fromHex(t[0]);if(Array.isArray(t[0])&&t[0].length===3)return ie.fromArray(t[0])}return new ie(...t)}s(le,"rgb");var ao=s((t,e,n)=>ie.fromHSL(t,e,n),"hsl2rgb"),pe=class t{static{s(this,"Quad")}x=0;y=0;w=1;h=1;constructor(e,n,o,i){this.x=e,this.y=n,this.w=o,this.h=i}scale(e){return new t(this.x+this.w*e.x,this.y+this.h*e.y,this.w*e.w,this.h*e.h)}pos(){return new P(this.x,this.y)}clone(){return new t(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}};function Ae(t,e,n,o){return new pe(t,e,n,o)}s(Ae,"quad");var It=class t{static{s(this,"Mat2")}a;b;c;d;constructor(e,n,o,i){this.a=e,this.b=n,this.c=o,this.d=i}mul(e){return new t(this.a*e.a+this.b*e.c,this.a*e.b+this.b*e.d,this.c*e.a+this.d*e.c,this.c*e.b+this.d*e.d)}transform(e){return S(this.a*e.x+this.b*e.y,this.c*e.x+this.d*e.y)}get inverse(){let e=this.det;return new t(this.d/e,-this.b/e,-this.c/e,this.a/e)}get transpose(){return new t(this.a,this.c,this.b,this.d)}get eigenvalues(){let e=this.trace/2,n=this.det,o=e+Math.sqrt(e*e-n),i=e-Math.sqrt(e*e-n);return[o,i]}eigenvectors(e,n){return this.c!=0?[[e-this.d,this.c],[n-this.d,this.c]]:this.b!=0?[[this.b,e-this.a],[this.b,n-this.a]]:Math.abs(this.transform(S(1,0)).x-e)<Number.EPSILON?[[1,0],[0,1]]:[[0,1],[1,0]]}get det(){return this.a*this.d-this.b*this.c}get trace(){return this.a+this.d}static rotation(e){let n=Math.cos(e),o=Math.sin(e);return new t(n,o,-o,n)}static scale(e,n){return new t(e,0,0,n)}};var St=class t{static{s(this,"Mat3")}m11;m12;m13;m21;m22;m23;m31;m32;m33;constructor(e,n,o,i,u,l,m,h,d){this.m11=e,this.m12=n,this.m13=o,this.m21=i,this.m22=u,this.m23=l,this.m31=m,this.m32=h,this.m33=d}static fromMat2(e){return new t(e.a,e.b,0,e.c,e.d,0,0,0,1)}toMat2(){return new It(this.m11,this.m12,this.m21,this.m22)}mul(e){return new t(this.m11*e.m11+this.m12*e.m21+this.m13*e.m31,this.m11*e.m12+this.m12*e.m22+this.m13*e.m32,this.m11*e.m13+this.m12*e.m23+this.m13*e.m33,this.m21*e.m11+this.m22*e.m21+this.m23*e.m31,this.m21*e.m12+this.m22*e.m22+this.m23*e.m32,this.m21*e.m13+this.m22*e.m23+this.m23*e.m33,this.m31*e.m11+this.m32*e.m21+this.m33*e.m31,this.m31*e.m12+this.m32*e.m22+this.m33*e.m32,this.m31*e.m13+this.m32*e.m23+this.m33*e.m33)}get det(){return this.m11*this.m22*this.m33+this.m12*this.m23*this.m31+this.m13*this.m21*this.m32-this.m13*this.m22*this.m31-this.m12*this.m21*this.m33-this.m11*this.m23*this.m32}rotate(e){let n=Math.cos(e),o=Math.sin(e),i=this.m11,u=this.m12;return this.m11=n*this.m11+o*this.m21,this.m12=n*this.m12+o*this.m22,this.m21=n*this.m21-o*i,this.m22=n*this.m22-o*u,this}scale(e,n){return this.m11*=e,this.m12*=e,this.m21*=n,this.m22*=n,this}get inverse(){let e=this.det;return new t((this.m22*this.m33-this.m23*this.m32)/e,(this.m13*this.m32-this.m12*this.m33)/e,(this.m12*this.m23-this.m13*this.m22)/e,(this.m23*this.m31-this.m21*this.m33)/e,(this.m11*this.m33-this.m13*this.m31)/e,(this.m13*this.m21-this.m11*this.m23)/e,(this.m21*this.m32-this.m22*this.m31)/e,(this.m12*this.m31-this.m11*this.m32)/e,(this.m11*this.m22-this.m12*this.m21)/e)}get transpose(){return new t(this.m11,this.m21,this.m31,this.m12,this.m22,this.m32,this.m13,this.m23,this.m33)}},$e=class t{static{s(this,"Mat4")}m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];constructor(e){e&&(this.m=e)}static translate(e){return new t([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1])}static scale(e){return new t([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(e){e=Ve(-e);let n=Math.cos(e),o=Math.sin(e);return new t([1,0,0,0,0,n,-o,0,0,o,n,0,0,0,0,1])}static rotateY(e){e=Ve(-e);let n=Math.cos(e),o=Math.sin(e);return new t([n,0,o,0,0,1,0,0,-o,0,n,0,0,0,0,1])}static rotateZ(e){e=Ve(-e);let n=Math.cos(e),o=Math.sin(e);return new t([n,-o,0,0,o,n,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=Ve(-e);let n=Math.cos(e),o=Math.sin(e),i=this.m[0],u=this.m[1],l=this.m[4],m=this.m[5];return this.m[0]=i*n+u*o,this.m[1]=-i*o+u*n,this.m[4]=l*n+m*o,this.m[5]=-l*o+m*n,this}mult(e){let n=[];for(let o=0;o<4;o++)for(let i=0;i<4;i++)n[o*4+i]=this.m[0*4+i]*e.m[o*4+0]+this.m[1*4+i]*e.m[o*4+1]+this.m[2*4+i]*e.m[o*4+2]+this.m[3*4+i]*e.m[o*4+3];return new t(n)}multVec2(e){return new P(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new P(this.m[12],this.m[13])}getScale(){if(this.m[0]!=0||this.m[1]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],n=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new P(n,e/n)}else if(this.m[4]!=0||this.m[5]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],n=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new P(e/n,n)}else return new P(0,0)}getRotation(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return gt(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return gt(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}else return 0}getSkew(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new P(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new P(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}else return new P(0,0)}invert(){let e=[],n=this.m[10]*this.m[15]-this.m[14]*this.m[11],o=this.m[9]*this.m[15]-this.m[13]*this.m[11],i=this.m[9]*this.m[14]-this.m[13]*this.m[10],u=this.m[8]*this.m[15]-this.m[12]*this.m[11],l=this.m[8]*this.m[14]-this.m[12]*this.m[10],m=this.m[8]*this.m[13]-this.m[12]*this.m[9],h=this.m[6]*this.m[15]-this.m[14]*this.m[7],d=this.m[5]*this.m[15]-this.m[13]*this.m[7],M=this.m[5]*this.m[14]-this.m[13]*this.m[6],y=this.m[4]*this.m[15]-this.m[12]*this.m[7],U=this.m[4]*this.m[14]-this.m[12]*this.m[6],x=this.m[5]*this.m[15]-this.m[13]*this.m[7],K=this.m[4]*this.m[13]-this.m[12]*this.m[5],H=this.m[6]*this.m[11]-this.m[10]*this.m[7],ee=this.m[5]*this.m[11]-this.m[9]*this.m[7],j=this.m[5]*this.m[10]-this.m[9]*this.m[6],J=this.m[4]*this.m[11]-this.m[8]*this.m[7],V=this.m[4]*this.m[10]-this.m[8]*this.m[6],se=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*n-this.m[6]*o+this.m[7]*i,e[4]=-(this.m[4]*n-this.m[6]*u+this.m[7]*l),e[8]=this.m[4]*o-this.m[5]*u+this.m[7]*m,e[12]=-(this.m[4]*i-this.m[5]*l+this.m[6]*m),e[1]=-(this.m[1]*n-this.m[2]*o+this.m[3]*i),e[5]=this.m[0]*n-this.m[2]*u+this.m[3]*l,e[9]=-(this.m[0]*o-this.m[1]*u+this.m[3]*m),e[13]=this.m[0]*i-this.m[1]*l+this.m[2]*m,e[2]=this.m[1]*h-this.m[2]*d+this.m[3]*M,e[6]=-(this.m[0]*h-this.m[2]*y+this.m[3]*U),e[10]=this.m[0]*x-this.m[1]*y+this.m[3]*K,e[14]=-(this.m[0]*M-this.m[1]*U+this.m[2]*K),e[3]=-(this.m[1]*H-this.m[2]*ee+this.m[3]*j),e[7]=this.m[0]*H-this.m[2]*J+this.m[3]*V,e[11]=-(this.m[0]*ee-this.m[1]*J+this.m[3]*se),e[15]=this.m[0]*j-this.m[1]*V+this.m[2]*se;let Q=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let ue=0;ue<4;ue++)for(let N=0;N<4;N++)e[ue*4+N]*=1/Q;return new t(e)}clone(){return new t([...this.m])}toString(){return this.m.toString()}};function hr(t,e,n,o=i=>-Math.cos(i)){return t+(o(n)+1)/2*(e-t)}s(hr,"wave");var Ji=1103515245,Zi=12345,so=2147483648,Yt=class{static{s(this,"RNG")}seed;constructor(e){this.seed=e}gen(){return this.seed=(Ji*this.seed+Zi)%so,this.seed/so}genNumber(e,n){return e+this.gen()*(n-e)}genVec2(e,n){return new P(this.genNumber(e.x,n.x),this.genNumber(e.y,n.y))}genColor(e,n){return new ie(this.genNumber(e.r,n.r),this.genNumber(e.g,n.g),this.genNumber(e.b,n.b))}genAny(...e){if(e.length===0)return this.gen();if(e.length===1){if(typeof e[0]=="number")return this.genNumber(0,e[0]);if(e[0]instanceof P)return this.genVec2(S(0,0),e[0]);if(e[0]instanceof ie)return this.genColor(le(0,0,0),e[0])}else if(e.length===2){if(typeof e[0]=="number"&&typeof e[1]=="number")return this.genNumber(e[0],e[1]);if(e[0]instanceof P&&e[1]instanceof P)return this.genVec2(e[0],e[1]);if(e[0]instanceof ie&&e[1]instanceof ie)return this.genColor(e[0],e[1])}}},dr=new Yt(Date.now());function uo(t){return t!=null&&(dr.seed=t),dr.seed}s(uo,"randSeed");function at(...t){return dr.genAny(...t)}s(at,"rand");function pr(...t){return Math.floor(at(...t))}s(pr,"randi");function co(t){return at()<=t}s(co,"chance");function fr(t){for(let e=t.length-1;e>0;e--){let n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}s(fr,"shuffle");function lo(t,e){return t.length<=e?t.slice():fr(t.slice()).slice(0,e)}s(lo,"chooseMultiple");function mo(t){return t[pr(t.length)]}s(mo,"choose");function gr(t,e){return t.pos.x+t.width>e.pos.x&&t.pos.x<e.pos.x+e.width&&t.pos.y+t.height>e.pos.y&&t.pos.y<e.pos.y+e.height}s(gr,"testRectRect");function ea(t,e){if(t.p1.x===t.p2.x&&t.p1.y===t.p2.y||e.p1.x===e.p2.x&&e.p1.y===e.p2.y)return null;let n=(e.p2.y-e.p1.y)*(t.p2.x-t.p1.x)-(e.p2.x-e.p1.x)*(t.p2.y-t.p1.y);if(n===0)return null;let o=((e.p2.x-e.p1.x)*(t.p1.y-e.p1.y)-(e.p2.y-e.p1.y)*(t.p1.x-e.p1.x))/n,i=((t.p2.x-t.p1.x)*(t.p1.y-e.p1.y)-(t.p2.y-t.p1.y)*(t.p1.x-e.p1.x))/n;return o<0||o>1||i<0||i>1?null:o}s(ea,"testLineLineT");function Cn(t,e){let n=ea(t,e);return n?S(t.p1.x+n*(t.p2.x-t.p1.x),t.p1.y+n*(t.p2.y-t.p1.y)):null}s(Cn,"testLineLine");function Tn(t,e){let n=e.p2.sub(e.p1),o=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY;if(n.x!=0){let u=(t.pos.x-e.p1.x)/n.x,l=(t.pos.x+t.width-e.p1.x)/n.x;o=Math.max(o,Math.min(u,l)),i=Math.min(i,Math.max(u,l))}if(n.y!=0){let u=(t.pos.y-e.p1.y)/n.y,l=(t.pos.y+t.height-e.p1.y)/n.y;o=Math.max(o,Math.min(u,l)),i=Math.min(i,Math.max(u,l))}return i>=o&&i>=0&&o<=1}s(Tn,"testRectLine");function Sn(t,e){return e.x>t.pos.x&&e.x<t.pos.x+t.width&&e.y>t.pos.y&&e.y<t.pos.y+t.height}s(Sn,"testRectPoint");function ho(t,e){let n=Math.max(t.pos.x,Math.min(e.center.x,t.pos.x+t.width)),o=Math.max(t.pos.y,Math.min(e.center.y,t.pos.y+t.height));return S(n,o).sdist(e.center)<=e.radius*e.radius}s(ho,"testRectCircle");function po(t,e){return fo(e,new Ie(t.points()))}s(po,"testRectPolygon");function En(t,e){let n=e.sub(t.p1),o=t.p2.sub(t.p1);if(Math.abs(n.cross(o))>Number.EPSILON)return!1;let i=n.dot(o)/o.dot(o);return i>=0&&i<=1}s(En,"testLinePoint");function Lt(t,e){let n=t.p2.sub(t.p1),o=n.dot(n),i=t.p1.sub(e.center),u=2*n.dot(i),l=i.dot(i)-e.radius*e.radius,m=u*u-4*o*l;if(o<=Number.EPSILON||m<0)return!1;if(m==0){let h=-u/(2*o);if(h>=0&&h<=1)return!0}else{let h=(-u+Math.sqrt(m))/(2*o),d=(-u-Math.sqrt(m))/(2*o);if(h>=0&&h<=1||d>=0&&d<=1)return!0}return On(e,t.p1)}s(Lt,"testLineCircle");function br(t,e){if(lt(e,t.p1)||lt(e,t.p2))return!0;for(let n=0;n<e.pts.length;n++){let o=e.pts[n],i=e.pts[(n+1)%e.pts.length];if(Cn(t,new je(o,i)))return!0}return!1}s(br,"testLinePolygon");function On(t,e){return t.center.sdist(e)<t.radius*t.radius}s(On,"testCirclePoint");function ta(t,e){return t.center.sdist(e.center)<(t.radius+e.radius)*(t.radius+e.radius)}s(ta,"testCircleCircle");function Qt(t,e){let n=e.pts[e.pts.length-1];for(let o of e.pts){if(Lt(new je(n,o),t))return!0;n=o}return On(t,e.pts[0])?!0:lt(e,t.center)}s(Qt,"testCirclePolygon");function fo(t,e){for(let n=0;n<t.pts.length;n++)if(br(new je(t.pts[n],t.pts[(n+1)%t.pts.length]),e))return!0;return!!(t.pts.some(n=>lt(e,n))||e.pts.some(n=>lt(t,n)))}s(fo,"testPolygonPolygon");function lt(t,e){let n=!1,o=t.pts;for(let i=0,u=o.length-1;i<o.length;u=i++)o[i].y>e.y!=o[u].y>e.y&&e.x<(o[u].x-o[i].x)*(e.y-o[i].y)/(o[u].y-o[i].y)+o[i].x&&(n=!n);return n}s(lt,"testPolygonPoint");function yr(t,e){e=e.sub(t.center);let n=Ve(t.angle),o=Math.cos(n),i=Math.sin(n),u=e.x*o+e.y*i,l=-e.x*i+e.y*o;return u*u/(t.radiusX*t.radiusX)+l*l/(t.radiusY*t.radiusY)<1}s(yr,"testEllipsePoint");function vn(t,e){let n=e.center.sub(t.center),o=Ve(t.angle),i=Math.cos(o),u=Math.sin(o),l=n.x*i+n.y*u,m=-n.x*u+n.y*i;return yr(new Je(S(),t.radiusX+e.radius,t.radiusY+e.radius,0),S(l,m))}s(vn,"testEllipseCircle");function go(t,e){let n=t.toMat2().inverse;return e=new je(n.transform(e.p1.sub(t.center)),n.transform(e.p2.sub(t.center))),Lt(e,new ke(S(),1))}s(go,"testEllipseLine");function na(t,e){if(t.radiusX===t.radiusY)return vn(e,new ke(t.center,t.radiusX));if(e.radiusX===e.radiusY)return vn(t,new ke(e.center,e.radiusX));let n=new St(1/t.radiusX**2,0,0,0,1/t.radiusY**2,0,0,0,-1),o=new St(1/e.radiusX**2,0,0,0,1/e.radiusY**2,0,0,0,-1),i=t.center.x,u=t.center.y,l=e.center.x,m=e.center.y,h=Ve(t.angle),d=Ve(e.angle),M=new St(Math.cos(h),-Math.sin(h),i,Math.sin(h),Math.cos(h),u,0,0,1),y=new St(Math.cos(d),-Math.sin(d),l,Math.sin(d),Math.cos(d),m,0,0,1),U=M.inverse,x=y.inverse,K=U.transpose.mul(n).mul(U),H=x.transpose.mul(o).mul(x),ee=K.m11,j=K.m12,J=K.m13,V=K.m21,se=K.m22,Q=K.m23,ue=K.m31,N=K.m32,_=K.m33,me=H.m11,fe=H.m12,ae=H.m13,xe=H.m21,he=H.m22,Be=H.m23,de=H.m31,Fe=H.m32,ce=H.m33,ye=ee*se*_-ee*Q*N-j*V*_+j*Q*ue+J*V*N-J*se*ue,ve=(ee*se*ce-ee*Q*Fe-ee*N*Be+ee*_*he-j*V*ce+j*Q*de+j*ue*Be-j*_*xe+J*V*Fe-J*se*de-J*ue*he+J*N*xe+V*N*ae-V*_*fe-se*ue*ae+se*_*me+Q*ue*fe-Q*N*me)/ye,Te=(ee*he*ce-ee*Be*Fe-j*xe*ce+j*Be*de+J*xe*Fe-J*he*de-V*fe*ce+V*ae*Fe+se*me*ce-se*ae*de-Q*me*Fe+Q*fe*de+ue*fe*Be-ue*ae*he-N*me*Be+N*ae*xe+_*me*he-_*fe*xe)/ye,Se=(me*he*ce-me*Be*Fe-fe*xe*ce+fe*Be*de+ae*xe*Fe-ae*he*de)/ye;if(ve>=0){let Xe=-3*Te+ve**2,te=3*ve*Se+Te*ve**2-4*Te**2,Ut=-27*Se**2+18*Se*ve*Te+ve**2*Te**2-4*ve**3*Se-4*Te**3;return!(Xe>0&&te<0&&Ut>0)}else{let Xe=-3*Te+ve**2,te=-27*Se**2+18*Se*ve*Te+ve**2*Te**2-4*ve**3*Se-4*Te**3;return!(Xe>0&&te>0)}}s(na,"testEllipseEllipse");function bo(t,e){return xr(t,new Ie(e.points()))}s(bo,"testEllipseRect");function xr(t,e){let n=t.toMat2().inverse;return e=new Ie(e.pts.map(o=>n.transform(o.sub(t.center)))),Qt(new ke(S(),1),e)}s(xr,"testEllipsePolygon");function ra(t,e){return t.x===e.x&&t.y===e.y}s(ra,"testPointPoint");function oa(t,e){return e instanceof P?ra(e,t.pt):e instanceof ke?On(e,t.pt):e instanceof je?En(e,t.pt):e instanceof be?Sn(e,t.pt):e instanceof Ie?lt(e,t.pt):e instanceof Je?yr(e,t.pt):!1}s(oa,"testPointShape");function sa(t,e){return e instanceof P?En(t,e):e instanceof ke?Lt(t,e):e instanceof je?Cn(t,e)!=null:e instanceof be?Tn(e,t):e instanceof Ie?br(t,e):e instanceof Je?go(e,t):!1}s(sa,"testLineShape");function ia(t,e){return e instanceof P?On(t,e):e instanceof ke?ta(t,e):e instanceof je?Lt(e,t):e instanceof be?ho(e,t):e instanceof Ie?Qt(t,e):e instanceof Je?vn(e,t):!1}s(ia,"testCircleShape");function aa(t,e){return e instanceof P?Sn(t,e):e instanceof ke?ho(t,e):e instanceof je?Tn(t,e):e instanceof be?gr(t,e):e instanceof Ie?po(t,e):e instanceof Je?bo(e,t):!1}s(aa,"testRectShape");function ua(t,e){return e instanceof P?lt(t,e):e instanceof ke?Qt(e,t):e instanceof je?br(e,t):e instanceof be?po(e,t):e instanceof Ie?fo(e,t):e instanceof Je?xr(e,t):!1}s(ua,"testPolygonShape");function ca(t,e){return e instanceof P?yr(t,e):e instanceof ke?vn(t,e):e instanceof je?go(t,e):e instanceof be?bo(t,e):e instanceof Ie?xr(t,e):e instanceof Je?na(e,t):!1}s(ca,"testEllipseShape");function yo(t,e,n){let o=t,i=n.p1,u=n.p2,l=e,m=u.sub(i),h=l.cross(m);if(Math.abs(h)<Number.EPSILON)return null;let d=i.sub(o),M=d.cross(m)/h;if(M<=0||M>=1)return null;let y=d.cross(l)/h;if(y<=0||y>=1)return null;let U=m.normal().unit();return e.dot(U)>0&&(U.x*=-1,U.y*=-1),{point:o.add(l.scale(M)),normal:U,fraction:M}}s(yo,"raycastLine");function la(t,e,n){let o=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY,u;if(t.x!=0){let l=(n.pos.x-t.x)/e.x,m=(n.pos.x+n.width-t.x)/e.x;u=S(-Math.sign(e.x),0),o=Math.max(o,Math.min(l,m)),i=Math.min(i,Math.max(l,m))}if(t.y!=0){let l=(n.pos.y-t.y)/e.y,m=(n.pos.y+n.height-t.y)/e.y;Math.min(l,m)>o&&(u=S(0,-Math.sign(e.y))),o=Math.max(o,Math.min(l,m)),i=Math.min(i,Math.max(l,m))}return i>=o&&o>=0&&o<=1?{point:t.add(e.scale(o)),normal:u,fraction:o}:null}s(la,"raycastRect");function xo(t,e,n){let o=t,i=n.center,u=e,l=u.dot(u),m=o.sub(i),h=2*u.dot(m),d=m.dot(m)-n.radius*n.radius,M=h*h-4*l*d;if(l<=Number.EPSILON||M<0)return null;if(M==0){let y=-h/(2*l);if(y>=0&&y<=1){let U=o.add(u.scale(y));return{point:U,normal:U.sub(i),fraction:y}}}else{let y=(-h+Math.sqrt(M))/(2*l),U=(-h-Math.sqrt(M))/(2*l),x=null;if(y>=0&&y<=1&&(x=y),U>=0&&U<=1&&(x=Math.min(U,x??U)),x!=null){let K=o.add(u.scale(x));return{point:K,normal:K.sub(i).unit(),fraction:x}}}return null}s(xo,"raycastCircle");function ma(t,e,n){let o=n.pts,i=null,u=o[o.length-1];for(let l=0;l<o.length;l++){let m=o[l],h=yo(t,e,new je(u,m));h&&(!i||i.fraction>h.fraction)&&(i=h),u=m}return i}s(ma,"raycastPolygon");function da(t,e,n){let o=n.toMat2(),i=o.inverse,u=i.transform(t.sub(n.center)),l=i.transform(e),m=xo(u,l,new ke(S(),1));if(m){let h=It.rotation(Ve(-n.angle)),M=It.scale(n.radiusX,n.radiusY).transform(m.point),y=o.transform(m.point).add(n.center),U=y.dist(t)/e.len();return{point:y,normal:h.transform(S(n.radiusY**2*M.x,n.radiusX**2*M.y)),fraction:U}}return m}s(da,"raycastEllipse");function vo(t,e,n,o=64){let i=t,u=e.len(),l=e.scale(1/u),m=0,h=S(Math.floor(t.x),Math.floor(t.y)),d=S(l.x>0?1:-1,l.y>0?1:-1),M=S(Math.abs(1/l.x),Math.abs(1/l.y)),y=S(d.x>0?h.x+1-t.x:t.x-h.x,d.y>0?h.y+1-t.y:t.y-h.y),U=S(M.x<1/0?M.x*y.x:1/0,M.y<1/0?M.y*y.y:1/0),x=-1;for(;m<=o;){let K=n(h);if(K===!0)return{point:i.add(l.scale(m)),normal:S(x===0?-d.x:0,x===1?-d.y:0),fraction:m/u,gridPos:h};if(K)return K;U.x<U.y?(h.x+=d.x,m=U.x,U.x+=M.x,x=0):(h.y+=d.y,m=U.y,U.y+=M.y,x=1)}return null}s(vo,"raycastGrid");var wn=class t{static{s(this,"Point")}pt;constructor(e){this.pt=e.clone()}transform(e){return new t(e.multVec2(this.pt))}bbox(){return new be(this.pt,0,0)}area(){return 0}clone(){return new t(this.pt)}collides(e){return oa(this,e)}contains(e){return this.pt.eq(e)}raycast(e,n){return null}random(){return this.pt.clone()}},je=class t{static{s(this,"Line")}p1;p2;constructor(e,n){this.p1=e.clone(),this.p2=n.clone()}transform(e){return new t(e.multVec2(this.p1),e.multVec2(this.p2))}bbox(){return be.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new t(this.p1,this.p2)}collides(e){return sa(this,e)}contains(e){return this.collides(e)}raycast(e,n){return yo(e,n,this)}random(){return this.p1.add(this.p2.sub(this.p1).scale(at(1)))}},be=class t{static{s(this,"Rect")}pos;width;height;constructor(e,n,o){this.pos=e.clone(),this.width=n,this.height=o}static fromPoints(e,n){return new t(e.clone(),n.x-e.x,n.y-e.y)}center(){return new P(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new Ie(this.points().map(n=>e.multVec2(n)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new t(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let n=this.pos,o=this.pos.add(this.width,this.height),i=Math.max(n.x-e.x,0,e.x-o.x),u=Math.max(n.y-e.y,0,e.y-o.y);return i*i+u*u}collides(e){return aa(this,e)}contains(e){return this.collides(e)}raycast(e,n){return la(e,n,this)}random(){return this.pos.add(at(this.width),at(this.height))}},ke=class t{static{s(this,"Circle")}center;radius;constructor(e,n){this.center=e.clone(),this.radius=n}transform(e){return new Je(this.center,this.radius,this.radius).transform(e)}bbox(){return be.fromPoints(this.center.sub(S(this.radius)),this.center.add(S(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new t(this.center,this.radius)}collides(e){return ia(this,e)}contains(e){return this.collides(e)}raycast(e,n){return xo(e,n,this)}random(){return this.center.add(P.fromAngle(at(360).scale(at(this.radius))))}},Je=class t{static{s(this,"Ellipse")}center;radiusX;radiusY;angle;constructor(e,n,o,i=0){this.center=e.clone(),this.radiusX=n,this.radiusY=o,this.angle=i}static fromMat2(e){let n=e.inverse,o=n.transpose.mul(n),[i,u]=o.eigenvalues,[l,m]=o.eigenvectors(i,u),[h,d]=[1/Math.sqrt(i),1/Math.sqrt(u)];return h>d?new t(S(),h,d,gt(Math.atan2(-l[1],l[0]))):new t(S(),d,h,gt(Math.atan2(-m[1],m[0])))}toMat2(){let e=Ve(this.angle),n=Math.cos(e),o=Math.sin(e);return new It(n*this.radiusX,o*this.radiusY,-o*this.radiusX,n*this.radiusY)}transform(e){if(this.angle==0&&e.getRotation()==0)return new t(e.multVec2(this.center),e.m[0]*this.radiusX,e.m[5]*this.radiusY);{let n=this.toMat2(),o=e.getRotation(),i=e.getScale();n=St.fromMat2(n).scale(i.x,i.y).rotate(o).toMat2();let l=t.fromMat2(n);return l.center=e.multVec2(this.center),l}}bbox(){if(this.angle==0)return be.fromPoints(this.center.sub(S(this.radiusX,this.radiusY)),this.center.add(S(this.radiusX,this.radiusY)));{let e=Ve(this.angle),n=Math.cos(e),o=Math.sin(e),i=this.radiusX*n,u=this.radiusX*o,l=this.radiusY*o,m=this.radiusY*n,h=Math.sqrt(i*i+l*l),d=Math.sqrt(u*u+m*m);return be.fromPoints(this.center.sub(S(h,d)),this.center.add(S(h,d)))}}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new t(this.center,this.radiusX,this.radiusY,this.angle)}collides(e){return ca(this,e)}contains(e){e=e.sub(this.center);let n=Ve(this.angle),o=Math.cos(n),i=Math.sin(n),u=e.x*o+e.y*i,l=-e.x*i+e.y*o;return u*u/(this.radiusX*this.radiusX)+l*l/(this.radiusY*this.radiusY)<1}raycast(e,n){return da(e,n,this)}random(){return this.center}},Ie=class t{static{s(this,"Polygon")}pts;constructor(e){if(e.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=e}transform(e){return new t(this.pts.map(n=>e.multVec2(n)))}bbox(){let e=S(Number.MAX_VALUE),n=S(-Number.MAX_VALUE);for(let o of this.pts)e.x=Math.min(e.x,o.x),n.x=Math.max(n.x,o.x),e.y=Math.min(e.y,o.y),n.y=Math.max(n.y,o.y);return be.fromPoints(e,n)}area(){let e=0,n=this.pts.length;for(let o=0;o<n;o++){let i=this.pts[o],u=this.pts[(o+1)%n];e+=i.x*u.y*.5,e-=u.x*i.y*.5}return Math.abs(e)}clone(){return new t(this.pts.map(e=>e.clone()))}collides(e){return ua(this,e)}contains(e){return this.collides(e)}raycast(e,n){return ma(e,n,this)}random(){return S()}};function wo(t,e,n,o){let i=o*o,u=1-o,l=u*u;return t.scale(l).add(e.scale(2*u*o)).add(n.scale(i))}s(wo,"evaluateQuadratic");function Co(t,e,n,o){let i=1-o;return e.sub(t).scale(2*i).add(n.sub(e).scale(2*o))}s(Co,"evaluateQuadraticFirstDerivative");function To(t,e,n,o){return n.sub(e.scale(2)).add(t).scale(2)}s(To,"evaluateQuadraticSecondDerivative");function An(t,e,n,o,i){let u=i*i,l=u*i,m=1-i,h=m*m,d=h*m;return t.scale(d).add(e.scale(3*h*i)).add(n.scale(3*m*u)).add(o.scale(l))}s(An,"evaluateBezier");function So(t,e,n,o,i){let u=i*i,l=1-i,m=l*l;return e.sub(t).scale(3*m).add(n.sub(e).scale(6*l*i)).add(o.sub(n).scale(3*u))}s(So,"evaluateBezierFirstDerivative");function Eo(t,e,n,o,i){let u=1-i;return n.sub(e.scale(2)).add(t).scale(6*u).add(o.sub(n.scale(2)).add(e).scale(6*i))}s(Eo,"evaluateBezierSecondDerivative");function Vn(t,e,n,o,i){let u=.5*(((-i+2)*i-1)*i),l=.5*((3*i-5)*i*i+2),m=.5*(((-3*i+4)*i+1)*i),h=.5*((i-1)*i*i);return t.scale(u).add(e.scale(l)).add(n.scale(m)).add(o.scale(h))}s(Vn,"evaluateCatmullRom");function Oo(t,e,n,o,i){let u=.5*((-3*i+4)*i-1),l=.5*((9*i-10)*i),m=.5*((-9*i+8)*i+1),h=.5*((3*i-2)*i);return t.scale(u).add(e.scale(l)).add(n.scale(m)).add(o.scale(h))}s(Oo,"evaluateCatmullRomFirstDerivative");function Ao(t){let e=vr(t),n=e(1);return o=>{let i=o*n,u=e(i,!0);return t(u)}}s(Ao,"normalizedCurve");function vr(t,e=10,n=10){let o=[0],i=[0],l=1/(e-1)/n,m=0,h=t(0),d=0;for(let M=1;M<e;M++){for(let y=0;y<n;y++){d+=l;let U=t(d),x=U.dist(h);m+=x,h=U}o[M]=m,i[M]=d}return i[e-1]=1,(M,y=!1)=>{if(y){let U=M;if(U<=0)return 0;if(U>=m)return 1;let x=0;for(;o[x+1]<U;)x++;let K=i[x],H=i[x+1],ee=o[x],j=o[x+1],J=(U-ee)/(j-ee);return K+(H-K)*J}else{if(M<=0)return 0;if(M>=1)return o[e-1];let U=0;for(;i[U+1]<M;)U++;let x=i[U],K=i[U+1],H=o[U],ee=o[U+1],j=(M-x)/(K-x);return H+(ee-H)*j}}}s(vr,"curveLengthApproximation");function $t(t){return 0<=t&&t<=1}s($t,"inZeroOneDomain");function lr(t,e){return Math.abs(t-e)<=Number.EPSILON}s(lr,"approximately");function Xt(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}s(Xt,"cubeRoot");function ha(t,e,n,o){let i=3*t-6*e+3*n,u=-3*t+3*e,l=t,m=-t+3*e-3*n+o;if(lr(m,0)){if(lr(i,0))return lr(u,0)?[]:[-l/u].filter($t);let j=Math.sqrt(u*u-4*i*l),J=2*i;return[(j-u)/J,(-u-j)/J].filter($t)}i/=m,u/=m,l/=m;let h=(3*u-i*i)/3,d=h/3,M=(2*i*i*i-9*i*u+27*l)/27,y=M/2,U=y*y+d*d*d;if(U<0){let j=-h/3,J=j*j*j,V=Math.sqrt(J),se=-M/(2*V),Q=se<-1?-1:se>1?1:se,ue=Math.acos(Q),_=2*Xt(V),me=_*Math.cos(ue/3)-i/3,fe=_*Math.cos((ue+2*Math.PI)/3)-i/3,ae=_*Math.cos((ue+4*Math.PI)/3)-i/3;return[me,fe,ae].filter($t)}if(U===0){let j=y<0?Xt(-y):-Xt(y),J=2*j-i/3,V=-j-i/3;return[J,V].filter($t)}let x=Math.sqrt(U),K=Xt(x-y),H=Xt(x+y);return[K-H-i/3].filter($t)}s(ha,"getCubicRoots");function pa(t,e,n,o,i){let u=ha(t.x-i,e.x-i,n.x-i,o.x-i);return u.length>0?An(t,e,n,o,u[0]).y:NaN}s(pa,"cubicBezierYforX");function Vo(t){if(!t||t.length==0)throw new Error("Need at least one point for easingLinear.");let e=t.length;return n=>{if(n<=0||t.length==1||n<=t[0].x)return t[0].y;for(let o=0;o<e;o++)if(t[o].x>=n)return Ze(n,t[o-1].x,t[o].x,t[o-1].y,t[o].y);return t[t.length-1].y}}s(Vo,"easingLinear");function Po(t,e){return n=>pa(S(0,0),t,e,S(1,1),n)}s(Po,"easingCubicBezier");function Ro(t,e="jump-end"){let n=1/t,o=e=="jump-start"||e=="jump-both",i=e=="jump-end"||e=="jump-both",u=1/(t+(i?1:0)),l=o?u:0;return m=>{let h=Math.floor(m/n);return l+h*u}}s(Ro,"easingSteps");function Uo(t,e){let n=Number.MAX_VALUE,o=S(0);for(let i of[t,e])for(let u=0;u<i.pts.length;u++){let l=i.pts[u],h=i.pts[(u+1)%i.pts.length].sub(l).normal().unit(),d=Number.MAX_VALUE,M=-Number.MAX_VALUE;for(let K=0;K<t.pts.length;K++){let H=t.pts[K].dot(h);d=Math.min(d,H),M=Math.max(M,H)}let y=Number.MAX_VALUE,U=-Number.MAX_VALUE;for(let K=0;K<e.pts.length;K++){let H=e.pts[K].dot(h);y=Math.min(y,H),U=Math.max(U,H)}let x=Math.min(M,U)-Math.max(d,y);if(x<0)return null;if(x<Math.abs(n)){let K=U-d,H=y-M;n=Math.abs(K)<Math.abs(H)?K:H,o=h.scale(n)}}return o}s(Uo,"sat");function Mo(t,e,n){return(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x)>=0}s(Mo,"isOrientedCcw");function fa(t){let e=0,n=t[t.length-1];for(let o=0;o<t.length;o++)e+=(t[o].x-n.x)*(t[o].y+n.y),n=t[o];return e<0}s(fa,"isOrientedCcwPolygon");function mr(t,e,n,o){let i=o.x-n.x,u=o.y-n.y,l=i*(t.y-n.y)-u*(t.x-n.x),m=i*(e.y-n.y)-u*(e.x-n.x);return l*m>=0}s(mr,"onSameSide");function ga(t,e,n,o){return mr(t,e,n,o)&&mr(t,n,e,o)&&mr(t,o,e,n)}s(ga,"pointInTriangle");function ba(t,e,n,o){for(let i of t)if(i!==e&&i!==n&&i!==o&&ga(i,e,n,o))return!0;return!1}s(ba,"someInTriangle");function ya(t,e,n,o){return Mo(t,e,n)&&!ba(o,t,e,n)}s(ya,"isEar");function wr(t){if(t.length<3)return[];if(t.length==3)return[t];let e=[],n=[],o=0;for(let y=0;y<t.length;y++){let U=t[o],x=t[y];(x.x<U.x||x.x==U.x&&x.y<U.y)&&(o=o),e[y]=y+1,n[y]=y-1}e[e.length-1]=0,n[0]=n.length-1,fa(t)||([e,n]=[n,e]);let i=[];for(let y=0;y<t.length;++y)Mo(t[n[y]],t[y],t[e[y]])||i.push(t[y]);let u=[],l=t.length,m=1,h=0,d,M;for(;l>3;){d=e[m],M=n[m];let y=t[M],U=t[m],x=t[d];if(ya(y,U,x,i))u.push([y,U,x]),e[M]=d,n[d]=M,i.splice(i.indexOf(U),1),--l,h=0;else if(++h>l)return[];m=d}return d=e[m],M=n[m],u.push([t[M],t[m],t[d]]),u}s(wr,"triangulate");function Do(t){if(t.length<3)return!1;let e=t.length-2,n=t.length-1,o=0,i=t[n].sub(t[e]),u=t[o].sub(t[n]),l=i.cross(u);for(;o+1<t.length;)if(e=n,n=o,o++,i=t[n].sub(t[e]),u=t[o].sub(t[n]),i.cross(u)*l<0)return!1;return!0}s(Do,"isConvex");var Jt=class extends Map{static{s(this,"Registry")}lastID=0;push(e){let n=this.lastID;return this.set(n,e),this.lastID++,n}pushd(e){let n=this.push(e);return()=>this.delete(n)}},mt=class t{static{s(this,"KEventController")}paused=!1;cancel;constructor(e){this.cancel=e}static join(e){let n=new t(()=>e.forEach(o=>o.cancel()));return Object.defineProperty(n,"paused",{get:s(()=>e[0].paused,"get"),set:s(o=>e.forEach(i=>i.paused=o),"set")}),n.paused=!1,n}},Pe=class{static{s(this,"KEvent")}handlers=new Jt;add(e){let n=this.handlers.pushd((...i)=>{o.paused||e(...i)}),o=new mt(n);return o}addOnce(e){let n=this.add((...o)=>{n.cancel(),e(...o)});return n}next(){return new Promise(e=>this.addOnce(e))}trigger(...e){this.handlers.forEach(n=>n(...e))}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},dt=class{static{s(this,"KEventHandler")}handlers={};on(e,n){return this.handlers[e]||(this.handlers[e]=new Pe),this.handlers[e].add(n)}onOnce(e,n){let o=this.on(e,(...i)=>{o.cancel(),n(...i)});return o}next(e){return new Promise(n=>{this.onOnce(e,(...o)=>n(o[0]))})}trigger(e,...n){this.handlers[e]&&this.handlers[e].trigger(...n)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){return this.handlers[e]?.numListeners()??0}};function Pn(t,e){if(t===e)return!0;let n=typeof t,o=typeof e;if(n!==o)return!1;if(n==="object"&&o==="object"&&t!==null&&e!==null){if(Array.isArray(t)!==Array.isArray(e))return!1;let i=Object.keys(t),u=Object.keys(e);if(i.length!==u.length)return!1;for(let l of i){let m=t[l],h=e[l];if(!Pn(m,h))return!1}return!0}return!1}s(Pn,"deepEq");function xa(t){let e=window.atob(t),n=e.length,o=new Uint8Array(n);for(let i=0;i<n;i++)o[i]=e.charCodeAt(i);return o.buffer}s(xa,"base64ToArrayBuffer");function Bo(t){return xa(t.split(",")[1])}s(Bo,"dataURLToArrayBuffer");function Rn(t,e){let n=document.createElement("a");n.href=e,n.download=t,n.click()}s(Rn,"download");function Cr(t,e){Rn(t,"data:text/plain;charset=utf-8,"+e)}s(Cr,"downloadText");function Fo(t,e){Cr(t,JSON.stringify(e))}s(Fo,"downloadJSON");function Tr(t,e){let n=URL.createObjectURL(e);Rn(t,n),URL.revokeObjectURL(n)}s(Tr,"downloadBlob");var Sr=s(t=>t.match(/^data:\w+\/\w+;base64,.+/),"isDataURL");var Io=s(t=>t.split(".").slice(0,-1).join("."),"getFileName");function Re(t,e){return(...n)=>{let o=n.length;if(o===t.length)return t(...n);if(o===e.length)return e(...n)}}s(Re,"overload2");var Lo=(()=>{let t=0;return()=>t++})(),Ko=s(t=>t instanceof Error?t.message:String(t),"getErrorMessage");var Kt=class{static{s(this,"BinaryHeap")}_items;_compareFn;constructor(e=(n,o)=>n<o){this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(this._items.length===0)return null;let e=this._items[0],n=this._items.pop();return this._items.length!==0&&(this._items[0]=n,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let n=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[n])&&this._items[e]>=this._items[n])break;this.swap(e,n),e=n}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let n=2*e+1;if(n<this._items.length-1&&!this._compareFn(this._items[n],this._items[n+1])&&++n,this._compareFn(this._items[e],this._items[n]))break;this.swap(e,n),e=n}}swap(e,n){[this._items[e],this._items[n]]=[this._items[n],this._items[e]]}get length(){return this._items.length}};var va=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function jo(t){if(typeof t!="string")throw new TypeError("string cannot be undefined or null");let e=[],n=0,o=0;for(;n<t.length;){if(o+=wa(n+o,t),Va(t[n+o])&&o++,Ea(t[n+o])&&o++,Oa(t[n+o])&&o++,Pa(t[n+o])){o++;continue}e.push(t.substring(n,n+o)),n+=o,o=0}return e}s(jo,"runes");function wa(t,e){let n=e[t];if(!Ca(n)||t===e.length-1)return 1;let o=n+e[t+1],i=e.substring(t+2,t+5);return Go(o)&&Go(i)?4:Ta(o)&&Aa(i)?e.slice(t).indexOf(String.fromCodePoint(917631))+2:Sa(i)?4:2}s(wa,"nextUnits");function Ca(t){return t&&Et(t[0].charCodeAt(0),55296,56319)}s(Ca,"isFirstOfSurrogatePair");function Go(t){return Et(Er(t),127462,127487)}s(Go,"isRegionalIndicator");function Ta(t){return Et(Er(t),127988,127988)}s(Ta,"isSubdivisionFlag");function Sa(t){return Et(Er(t),127995,127999)}s(Sa,"isFitzpatrickModifier");function Ea(t){return typeof t=="string"&&Et(t.charCodeAt(0),65024,65039)}s(Ea,"isVariationSelector");function Oa(t){return typeof t=="string"&&Et(t.charCodeAt(0),8400,8447)}s(Oa,"isDiacriticalMark");function Aa(t){let e=t.codePointAt(0);return typeof t=="string"&&typeof e=="number"&&Et(e,917504,917631)}s(Aa,"isSupplementarySpecialpurposePlane");function Va(t){return typeof t=="string"&&va.includes(t.charCodeAt(0))}s(Va,"isGrapheme");function Pa(t){return typeof t=="string"&&t.charCodeAt(0)===8205}s(Pa,"isZeroWidthJoiner");function Er(t){let e=t.charCodeAt(0)-55296,n=t.charCodeAt(1)-56320;return(e<<10)+n+65536}s(Er,"codePointFromSurrogatePair");function Et(t,e,n){return t>=e&&t<=n}s(Et,"betweenInclusive");function ko(t){return t?.prototype&&Object.getOwnPropertyDescriptor(t.prototype,"constructor")!==void 0}s(ko,"isClass");var Qe=s((t,e)=>Array.isArray(t)?t?.includes(e):t===e,"isEqOrIncludes"),nt=s((t,e)=>Array.isArray(e)?e.some(n=>t.has(n)):t.has(e),"setHasOrIncludes");var Or={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{"0":"south","1":"east","2":"west","3":"north","4":"lshoulder","5":"rshoulder","6":"ltrigger","7":"rtrigger","8":"select","9":"start","10":"lstick","11":"rstick","12":"dpad-up","13":"dpad-down","14":"dpad-left","15":"dpad-right","16":"home","17":"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{"0":"south","1":"east","2":"west","3":"north","4":"lshoulder","5":"rshoulder","9":"select","10":"lstick","16":"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{"0":"south","1":"east","2":"west","3":"north","4":"lshoulder","5":"rshoulder","9":"start","10":"lstick","16":"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{"0":"south","1":"east","2":"west","3":"north","4":"lshoulder","5":"rshoulder","6":"ltrigger","7":"rtrigger","8":"select","9":"start","10":"lstick","11":"rstick","12":"dpad-up","13":"dpad-down","14":"dpad-left","15":"dpad-right","16":"home","17":"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{"0":"south","1":"east","2":"west","3":"north","4":"lshoulder","5":"rshoulder","6":"ltrigger","7":"rtrigger","8":"select","9":"start","10":"lstick","11":"rstick","12":"dpad-up","13":"dpad-down","14":"dpad-left","15":"dpad-right","16":"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}};var Ot=class{static{s(this,"ButtonState")}pressed=new Set([]);pressedRepeat=new Set([]);released=new Set([]);down=new Set([]);update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}},Ar=class{static{s(this,"GamepadState")}buttonState=new Ot;stickState=new Map},Vr=class{static{s(this,"FPSCounter")}dts=[];timer=0;fps=0;tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((n,o)=>n+o)/this.dts.length)),this.dts=[])}},No=s(t=>{if(!t.canvas)throw new Error("Please provide a canvas");let e={canvas:t.canvas,buttons:t.buttons??{},loopID:null,stopped:!1,dt:0,time:0,realTime:0,fpsCounter:new Vr,timeScale:1,skipTime:!1,isHidden:!1,numFrames:0,mousePos:new P(0),mouseDeltaPos:new P(0),keyState:new Ot,mouseState:new Ot,mergedGamepadState:new Ar,gamepadStates:new Map,buttonState:new Ot,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:t.canvas.offsetWidth,lastHeight:t.canvas.offsetHeight,events:new dt};function n(){return e.dt*e.timeScale}s(n,"dt");function o(){return e.isHidden}s(o,"isHidden");function i(){return e.time}s(i,"time");function u(){return e.fpsCounter.fps}s(u,"fps");function l(){return e.numFrames}s(l,"numFrames");function m(){return e.canvas.toDataURL()}s(m,"screenshot");function h(f){e.canvas.style.cursor=f}s(h,"setCursor");function d(){return e.canvas.style.cursor}s(d,"getCursor");function M(f){if(f)try{let E=e.canvas.requestPointerLock();E.catch&&E.catch(F=>console.error(F))}catch(E){console.error(E)}else document.exitPointerLock()}s(M,"setCursorLocked");function y(){return!!document.pointerLockElement}s(y,"isCursorLocked");function U(f){f.requestFullscreen?f.requestFullscreen():f.webkitRequestFullscreen&&f.webkitRequestFullscreen()}s(U,"enterFullscreen");function x(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}s(x,"exitFullscreen");function K(f=!0){f?U(e.canvas):x()}s(K,"setFullscreen");function H(){return document.fullscreenElement===e.canvas||document.webkitFullscreenElement===e.canvas}s(H,"isFullscreen");function ee(){e.stopped=!0;for(let f in De)e.canvas.removeEventListener(f,De[f]);for(let f in wt)document.removeEventListener(f,wt[f]);for(let f in st)window.removeEventListener(f,st[f]);zt.disconnect()}s(ee,"quit");function j(f){e.loopID!==null&&cancelAnimationFrame(e.loopID);let E=0,F=s(Z=>{if(e.stopped)return;if(document.visibilityState!=="visible"){e.loopID=requestAnimationFrame(F);return}let Ue=Z/1e3,we=Ue-e.realTime,Oe=t.maxFPS?1/t.maxFPS:0;e.realTime=Ue,E+=we,E>Oe&&(e.skipTime||(e.dt=E,e.time+=n(),e.fpsCounter.tick(e.dt)),E=0,e.skipTime=!1,e.numFrames++,er(),f(),xt()),e.loopID=requestAnimationFrame(F)},"frame");F(0)}s(j,"run");function J(){return"ontouchstart"in window||navigator.maxTouchPoints>0}s(J,"isTouchscreen");function V(){return e.mousePos.clone()}s(V,"mousePos");function se(){return e.mouseDeltaPos.clone()}s(se,"mouseDeltaPos");function Q(f="left"){return e.mouseState.pressed.has(f)}s(Q,"isMousePressed");function ue(f="left"){return e.mouseState.down.has(f)}s(ue,"isMouseDown");function N(f="left"){return e.mouseState.released.has(f)}s(N,"isMouseReleased");function _(){return e.isMouseMoved}s(_,"isMouseMoved");function me(f){return f===void 0?e.keyState.pressed.size>0:nt(e.keyState.pressed,f)}s(me,"isKeyPressed");function fe(f){return f===void 0?e.keyState.pressedRepeat.size>0:nt(e.keyState.pressedRepeat,f)}s(fe,"isKeyPressedRepeat");function ae(f){return f===void 0?e.keyState.down.size>0:nt(e.keyState.down,f)}s(ae,"isKeyDown");function xe(f){return f===void 0?e.keyState.released.size>0:nt(e.keyState.released,f)}s(xe,"isKeyReleased");function he(f){return f===void 0?e.mergedGamepadState.buttonState.pressed.size>0:nt(e.mergedGamepadState.buttonState.pressed,f)}s(he,"isGamepadButtonPressed");function Be(f){return f===void 0?e.mergedGamepadState.buttonState.down.size>0:nt(e.mergedGamepadState.buttonState.down,f)}s(Be,"isGamepadButtonDown");function de(f){return f===void 0?e.mergedGamepadState.buttonState.released.size>0:nt(e.mergedGamepadState.buttonState.released,f)}s(de,"isGamepadButtonReleased");function Fe(f){return f===void 0?e.buttonState.pressed.size>0:nt(e.buttonState.pressed,f)}s(Fe,"isButtonPressed");function ce(f){return f===void 0?e.buttonState.down.size>0:nt(e.buttonState.down,f)}s(ce,"isButtonDown");function ye(f){return f===void 0?e.buttonState.released.size>0:nt(e.buttonState.released,f)}s(ye,"isButtonReleased");function ve(f){return e.buttons?.[f]}s(ve,"getButton");function Te(f,E){e.buttons[f]={...e.buttons[f],...E}}s(Te,"setButton");function Se(f){for(let E in e.buttons)if((e.buttons[E].keyboard?.length?e.buttons[E].keyboard:[E]).includes(f))return Object.keys(e.buttons).find(Z=>e.buttons[Z]===e.buttons[E])}s(Se,"getButtonNameByKey");function Xe(f){for(let E in e.buttons)if((e.buttons[E].gamepad?.length?e.buttons[E].gamepad:[E]).includes(f))return Object.keys(e.buttons).find(Z=>e.buttons[Z]===e.buttons[E])}s(Xe,"getButtonByGamepadButton");function te(f){for(let E in e.buttons)if((e.buttons[E].mouse?.length?e.buttons[E].mouse:[E]).includes(f))return Object.keys(e.buttons).find(Z=>e.buttons[Z]===e.buttons[E])}s(te,"getButtonByMouseButton");function Ut(f){return e.events.on("resize",f)}s(Ut,"onResize");let ln=Re(f=>e.events.on("keyDown",f),(f,E)=>e.events.on("keyDown",F=>Qe(f,F)&&E(F))),Hn=Re(f=>e.events.on("keyPress",E=>f(E)),(f,E)=>e.events.on("keyPress",F=>Qe(f,F)&&E(F))),mn=Re(f=>e.events.on("keyPressRepeat",f),(f,E)=>e.events.on("keyPressRepeat",F=>Qe(f,F)&&E(F))),qn=Re(f=>e.events.on("keyRelease",f),(f,E)=>e.events.on("keyRelease",F=>Qe(f,F)&&E(F))),zn=Re(f=>e.events.on("mouseDown",E=>f(E)),(f,E)=>e.events.on("mouseDown",F=>Qe(f,F)&&E(F))),dn=Re(f=>e.events.on("mousePress",E=>f(E)),(f,E)=>e.events.on("mousePress",F=>Qe(f,F)&&E(F))),Wn=Re(f=>e.events.on("mouseRelease",E=>f(E)),(f,E)=>e.events.on("mouseRelease",F=>F===f&&E(F)));function $n(f){return e.events.on("mouseMove",()=>f(V(),se()))}s($n,"onMouseMove");function hn(f){return e.events.on("charInput",f)}s(hn,"onCharInput");function pn(f){return e.events.on("touchStart",f)}s(pn,"onTouchStart");function Xn(f){return e.events.on("touchMove",f)}s(Xn,"onTouchMove");function kt(f){return e.events.on("touchEnd",f)}s(kt,"onTouchEnd");function Yn(f){return e.events.on("scroll",f)}s(Yn,"onScroll");function ot(f){return e.events.on("hide",f)}s(ot,"onHide");function _e(f){return e.events.on("show",f)}s(_e,"onShow");let Nt=Re(f=>e.events.on("gamepadButtonPress",E=>f(E)),(f,E)=>e.events.on("gamepadButtonPress",F=>Qe(f,F)&&E(F))),Qn=Re(f=>e.events.on("gamepadButtonDown",E=>f(E)),(f,E)=>e.events.on("gamepadButtonDown",F=>Qe(f,F)&&E(F))),_t=Re(f=>e.events.on("gamepadButtonRelease",E=>f(E)),(f,E)=>e.events.on("gamepadButtonRelease",F=>Qe(f,F)&&E(F)));function Jn(f,E){return e.events.on("gamepadStick",(F,Z)=>F===f&&E(Z))}s(Jn,"onGamepadStick");function Zn(f){e.events.on("gamepadConnect",f)}s(Zn,"onGamepadConnect");function Ee(f){e.events.on("gamepadDisconnect",f)}s(Ee,"onGamepadDisconnect");function yt(f){return e.mergedGamepadState.stickState.get(f)||new P(0)}s(yt,"getGamepadStick");function pt(){return[...e.charInputted]}s(pt,"charInputted");function He(){return[...e.gamepads]}s(He,"getGamepads");let qe=Re(f=>e.events.on("buttonPress",E=>f(E)),(f,E)=>e.events.on("buttonPress",F=>Qe(f,F)&&E(F))),Mt=Re(f=>e.events.on("buttonDown",E=>f(E)),(f,E)=>e.events.on("buttonDown",F=>Qe(f,F)&&E(F))),Ht=Re(f=>e.events.on("buttonRelease",E=>f(E)),(f,E)=>e.events.on("buttonRelease",F=>Qe(f,F)&&E(F)));function er(){e.events.trigger("input"),e.keyState.down.forEach(f=>e.events.trigger("keyDown",f)),e.mouseState.down.forEach(f=>e.events.trigger("mouseDown",f)),e.buttonState.down.forEach(f=>e.events.trigger("buttonDown",f)),tr()}s(er,"processInput");function xt(){e.keyState.update(),e.mouseState.update(),e.buttonState.update(),e.mergedGamepadState.buttonState.update(),e.mergedGamepadState.stickState.forEach((f,E)=>{e.mergedGamepadState.stickState.set(E,new P(0))}),e.charInputted=[],e.isMouseMoved=!1,e.gamepadStates.forEach(f=>{f.buttonState.update(),f.stickState.forEach((E,F)=>{f.stickState.set(F,new P(0))})})}s(xt,"resetInput");function Ye(f){let E={index:f.index,isPressed:s(F=>e.gamepadStates.get(f.index).buttonState.pressed.has(F),"isPressed"),isDown:s(F=>e.gamepadStates.get(f.index).buttonState.down.has(F),"isDown"),isReleased:s(F=>e.gamepadStates.get(f.index).buttonState.released.has(F),"isReleased"),getStick:s(F=>e.gamepadStates.get(f.index).stickState.get(F),"getStick")};return e.gamepads.push(E),e.gamepadStates.set(f.index,{buttonState:new Ot,stickState:new Map([["left",new P(0)],["right",new P(0)]])}),E}s(Ye,"registerGamepad");function vt(f){e.gamepads=e.gamepads.filter(E=>E.index!==f.index),e.gamepadStates.delete(f.index)}s(vt,"removeGamepad");function tr(){for(let f of navigator.getGamepads())f&&!e.gamepadStates.has(f.index)&&Ye(f);for(let f of e.gamepads){let E=navigator.getGamepads()[f.index],Z=(t.gamepads??{})[E.id]??Or[E.id]??Or.default,Ue=e.gamepadStates.get(f.index);for(let we=0;we<E.buttons.length;we++){let Oe=Z.buttons[we],ut=E.buttons[we],tt=Xe(Oe);ut.pressed?(Ue.buttonState.down.has(Oe)||(e.mergedGamepadState.buttonState.press(Oe),Ue.buttonState.press(Oe),e.buttonState.press(tt),e.events.trigger("gamepadButtonPress",Oe),e.events.trigger("buttonPress",tt)),e.events.trigger("gamepadButtonDown",Oe),e.events.trigger("buttonDown",tt)):Ue.buttonState.down.has(Oe)&&(e.mergedGamepadState.buttonState.release(Oe),Ue.buttonState.release(Oe),e.buttonState.release(tt),e.events.trigger("gamepadButtonRelease",Oe),e.events.trigger("buttonRelease",tt))}for(let we in Z.sticks){let Oe=Z.sticks[we],ut=new P(E.axes[Oe.x],E.axes[Oe.y]);Ue.stickState.set(we,ut),e.mergedGamepadState.stickState.set(we,ut),e.events.trigger("gamepadStick",we,ut)}}}s(tr,"processGamepad");let De={},wt={},st={},qt=t.pixelDensity||window.devicePixelRatio||1;De.mousemove=f=>{let E=new P(f.offsetX,f.offsetY),F=new P(f.movementX,f.movementY);if(H()){let Z=e.canvas.width/qt,Ue=e.canvas.height/qt,we=window.innerWidth,Oe=window.innerHeight,ut=we/Oe,tt=Z/Ue;if(ut>tt){let ze=Oe/Ue,Gt=(we-Z*ze)/2;E.x=Ze(f.offsetX-Gt,0,Z*ze,0,Z),E.y=Ze(f.offsetY,0,Ue*ze,0,Ue)}else{let ze=we/Z,Gt=(Oe-Ue*ze)/2;E.x=Ze(f.offsetX,0,Z*ze,0,Z),E.y=Ze(f.offsetY-Gt,0,Ue*ze,0,Ue)}}e.events.onOnce("input",()=>{e.isMouseMoved=!0,e.mousePos=E,e.mouseDeltaPos=F,e.events.trigger("mouseMove")})};let fn=["left","middle","right","back","forward"];De.mousedown=f=>{e.events.onOnce("input",()=>{let E=fn[f.button];if(!E)return;let F=te(E);e.mouseState.press(E),e.buttonState.press(F),e.events.trigger("mousePress",E),e.events.trigger("buttonPress",F)})},De.mouseup=f=>{e.events.onOnce("input",()=>{let E=fn[f.button];if(!E)return;let F=te(E);e.mouseState.release(E),e.buttonState.release(F),e.events.trigger("mouseRelease",E),e.events.trigger("buttonRelease",F)})};let gn=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),Dt={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};De.keydown=f=>{gn.has(f.key)&&f.preventDefault(),e.events.onOnce("input",()=>{let E=Dt[f.key]||f.key.toLowerCase();if(E.length===1?(e.events.trigger("charInput",E),e.charInputted.push(E)):E==="space"&&(e.events.trigger("charInput"," "),e.charInputted.push(" ")),f.repeat)e.keyState.pressRepeat(E),e.events.trigger("keyPressRepeat",E);else{let F=Se(E);e.keyState.press(E),e.buttonState.press(F),e.events.trigger("keyPressRepeat",E),e.events.trigger("keyPress",E),e.events.trigger("buttonPress",F)}})},De.keyup=f=>{e.events.onOnce("input",()=>{let E=Dt[f.key]||f.key.toLowerCase(),F=Se(E);e.keyState.release(E),e.buttonState.release(F),e.events.trigger("keyRelease",E),e.events.trigger("buttonRelease",F)})},De.touchstart=f=>{f.preventDefault(),e.events.onOnce("input",()=>{let E=[...f.changedTouches],F=e.canvas.getBoundingClientRect();if(t.touchToMouse!==!1){e.mousePos=new P(E[0].clientX-F.x,E[0].clientY-F.y);let Z=te("left");e.mouseState.press("left"),e.buttonState.press(Z),e.events.trigger("mousePress","left"),e.events.trigger("buttonPress",Z)}E.forEach(Z=>{e.events.trigger("touchStart",new P(Z.clientX-F.x,Z.clientY-F.y),Z)})})},De.touchmove=f=>{f.preventDefault(),e.events.onOnce("input",()=>{let E=[...f.changedTouches],F=e.canvas.getBoundingClientRect();if(t.touchToMouse!==!1){let Z=e.mousePos;e.mousePos=new P(E[0].clientX-F.x,E[0].clientY-F.y),e.mouseDeltaPos=e.mousePos.sub(Z),e.events.trigger("mouseMove")}E.forEach(Z=>{e.events.trigger("touchMove",new P(Z.clientX-F.x,Z.clientY-F.y),Z)})})},De.touchend=f=>{e.events.onOnce("input",()=>{let E=[...f.changedTouches],F=e.canvas.getBoundingClientRect();if(t.touchToMouse!==!1){e.mousePos=new P(E[0].clientX-F.x,E[0].clientY-F.y),e.mouseDeltaPos=new P(0,0);let Z=te("left");e.buttonState.release(Z),e.mouseState.release("left"),e.events.trigger("mouseRelease","left"),e.events.trigger("buttonRelease",Z)}E.forEach(Z=>{e.events.trigger("touchEnd",new P(Z.clientX-F.x,Z.clientY-F.y),Z)})})},De.touchcancel=f=>{e.events.onOnce("input",()=>{let E=[...f.changedTouches],F=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=new P(E[0].clientX-F.x,E[0].clientY-F.y),e.mouseState.release("left"),e.events.trigger("mouseRelease","left")),E.forEach(Z=>{e.events.trigger("touchEnd",new P(Z.clientX-F.x,Z.clientY-F.y),Z)})})},De.wheel=f=>{f.preventDefault(),e.events.onOnce("input",()=>{e.events.trigger("scroll",new P(f.deltaX,f.deltaY))})},De.contextmenu=f=>f.preventDefault(),wt.visibilitychange=()=>{document.visibilityState==="visible"?(e.skipTime=!0,e.isHidden=!1,e.events.trigger("show")):(e.isHidden=!0,e.events.trigger("hide"))},st.gamepadconnected=f=>{let E=Ye(f.gamepad);e.events.onOnce("input",()=>{e.events.trigger("gamepadConnect",E)})},st.gamepaddisconnected=f=>{let E=He().filter(F=>F.index===f.gamepad.index)[0];vt(f.gamepad),e.events.onOnce("input",()=>{e.events.trigger("gamepadDisconnect",E)})};for(let f in De)e.canvas.addEventListener(f,De[f]);for(let f in wt)document.addEventListener(f,wt[f]);for(let f in st)window.addEventListener(f,st[f]);let zt=new ResizeObserver(f=>{for(let E of f)if(E.target===e.canvas){if(e.lastWidth===e.canvas.offsetWidth&&e.lastHeight===e.canvas.offsetHeight)return;e.lastWidth=e.canvas.offsetWidth,e.lastHeight=e.canvas.offsetHeight,e.events.onOnce("input",()=>{e.events.trigger("resize")})}});return zt.observe(e.canvas),{dt:n,time:i,run:j,canvas:e.canvas,fps:u,numFrames:l,quit:ee,isHidden:o,setFullscreen:K,isFullscreen:H,setCursor:h,screenshot:m,getGamepads:He,getCursor:d,setCursorLocked:M,isCursorLocked:y,isTouchscreen:J,mousePos:V,mouseDeltaPos:se,isKeyDown:ae,isKeyPressed:me,isKeyPressedRepeat:fe,isKeyReleased:xe,isMouseDown:ue,isMousePressed:Q,isMouseReleased:N,isMouseMoved:_,isGamepadButtonPressed:he,isGamepadButtonDown:Be,isGamepadButtonReleased:de,getGamepadStick:yt,isButtonPressed:Fe,isButtonDown:ce,isButtonReleased:ye,setButton:Te,getButton:ve,charInputted:pt,onResize:Ut,onKeyDown:ln,onKeyPress:Hn,onKeyPressRepeat:mn,onKeyRelease:qn,onMouseDown:zn,onMousePress:dn,onMouseRelease:Wn,onMouseMove:$n,onCharInput:hn,onTouchStart:pn,onTouchMove:Xn,onTouchEnd:kt,onScroll:Yn,onHide:ot,onShow:_e,onGamepadButtonDown:Qn,onGamepadButtonPress:Nt,onGamepadButtonRelease:_t,onGamepadStick:Jn,onGamepadConnect:Zn,onGamepadDisconnect:Ee,onButtonPress:qe,onButtonDown:Mt,onButtonRelease:Ht,events:e.events}},"default");var et=class t{static{s(this,"Texture")}ctx;src=null;glTex;width;height;constructor(e,n,o,i={}){this.ctx=e;let u=e.gl;this.glTex=e.gl.createTexture(),e.onDestroy(()=>this.free()),this.width=n,this.height=o;let l={linear:u.LINEAR,nearest:u.NEAREST}[i.filter??e.opts.texFilter]??u.NEAREST,m={repeat:u.REPEAT,clampToEadge:u.CLAMP_TO_EDGE}[i.wrap]??u.CLAMP_TO_EDGE;this.bind(),n&&o&&u.texImage2D(u.TEXTURE_2D,0,u.RGBA,n,o,0,u.RGBA,u.UNSIGNED_BYTE,null),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,l),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,l),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,m),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,m),this.unbind()}static fromImage(e,n,o={}){let i=new t(e,n.width,n.height,o);return i.update(n),i.src=n,i}update(e,n=0,o=0){let i=this.ctx.gl;this.bind(),i.texSubImage2D(i.TEXTURE_2D,0,n,o,i.RGBA,i.UNSIGNED_BYTE,e),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},Vt=class{static{s(this,"FrameBuffer")}ctx;tex;glFramebuffer;glRenderbuffer;constructor(e,n,o,i={}){this.ctx=e;let u=e.gl;e.onDestroy(()=>this.free()),this.tex=new et(e,n,o,i),this.glFramebuffer=u.createFramebuffer(),this.glRenderbuffer=u.createRenderbuffer(),this.bind(),u.renderbufferStorage(u.RENDERBUFFER,u.DEPTH_STENCIL,n,o),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,this.tex.glTex,0),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let e=this.ctx.gl,n=new Uint8ClampedArray(this.width*this.height*4);this.bind(),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,n),this.unbind();let o=this.width*4,i=new Uint8Array(o);for(let u=0;u<(this.height/2|0);u++){let l=u*o,m=(this.height-u-1)*o;i.set(n.subarray(l,l+o)),n.copyWithin(l,m,m+o),n.set(i,m)}return new ImageData(n,this.width,this.height)}toDataURL(){let e=document.createElement("canvas"),n=e.getContext("2d");return e.width=this.width,e.height=this.height,n.putImageData(this.toImageData(),0,0),e.toDataURL()}clear(){let e=this.ctx.gl;e.clear(e.COLOR_BUFFER_BIT)}draw(e){this.bind(),e(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let e=this.ctx.gl;e.deleteFramebuffer(this.glFramebuffer),e.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},Un=class{static{s(this,"Shader")}ctx;glProgram;constructor(e,n,o,i){this.ctx=e,e.onDestroy(()=>this.free());let u=e.gl,l=u.createShader(u.VERTEX_SHADER),m=u.createShader(u.FRAGMENT_SHADER);u.shaderSource(l,n),u.shaderSource(m,o),u.compileShader(l),u.compileShader(m);let h=u.createProgram();if(this.glProgram=h,u.attachShader(h,l),u.attachShader(h,m),i.forEach((d,M)=>u.bindAttribLocation(h,M,d)),u.linkProgram(h),!u.getProgramParameter(h,u.LINK_STATUS)){let d=u.getShaderInfoLog(l);if(d)throw new Error("VERTEX SHADER "+d);let M=u.getShaderInfoLog(m);if(M)throw new Error("FRAGMENT SHADER "+M)}u.deleteShader(l),u.deleteShader(m)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(e){let n=this.ctx.gl;for(let o in e){let i=e[o],u=n.getUniformLocation(this.glProgram,o);if(typeof i=="number")n.uniform1f(u,i);else if(i instanceof $e)n.uniformMatrix4fv(u,!1,new Float32Array(i.m));else if(i instanceof ie)n.uniform3f(u,i.r,i.g,i.b);else if(i instanceof P)n.uniform2f(u,i.x,i.y);else if(Array.isArray(i)){let l=i[0];typeof l=="number"?n.uniform1fv(u,i):l instanceof P?n.uniform2fv(u,i.map(m=>[m.x,m.y]).flat()):l instanceof ie&&n.uniform3fv(u,i.map(m=>[m.r,m.g,m.b]).flat())}else throw new Error("Unsupported uniform data type")}}free(){this.ctx.gl.deleteProgram(this.glProgram)}},Mn=class{static{s(this,"BatchRenderer")}ctx;glVBuf;glIBuf;vqueue=[];iqueue=[];stride;maxVertices;maxIndices;vertexFormat;numDraws=0;curPrimitive=null;curTex=null;curShader=null;curUniform={};constructor(e,n,o,i){let u=e.gl;this.vertexFormat=n,this.ctx=e,this.stride=n.reduce((l,m)=>l+m.size,0),this.maxVertices=o,this.maxIndices=i,this.glVBuf=u.createBuffer(),e.pushArrayBuffer(this.glVBuf),u.bufferData(u.ARRAY_BUFFER,o*4,u.DYNAMIC_DRAW),e.popArrayBuffer(),this.glIBuf=u.createBuffer(),e.pushElementArrayBuffer(this.glIBuf),u.bufferData(u.ELEMENT_ARRAY_BUFFER,i*4,u.DYNAMIC_DRAW),e.popElementArrayBuffer()}push(e,n,o,i,u=null,l={}){(e!==this.curPrimitive||u!==this.curTex||i!==this.curShader||!Pn(this.curUniform,l)||this.vqueue.length+n.length*this.stride>this.maxVertices||this.iqueue.length+o.length>this.maxIndices)&&this.flush();let m=this.vqueue.length/this.stride;for(let h of n)this.vqueue.push(h);for(let h of o)this.iqueue.push(h+m);this.curPrimitive=e,this.curShader=i,this.curTex=u,this.curUniform=l}flush(){if(!this.curPrimitive||!this.curShader||this.vqueue.length===0||this.iqueue.length===0)return;let e=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),e.bufferSubData(e.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),this.curTex?.bind(),e.drawElements(this.curPrimitive,this.iqueue.length,e.UNSIGNED_SHORT,0),this.curTex?.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let e=this.ctx.gl;e.deleteBuffer(this.glVBuf),e.deleteBuffer(this.glIBuf)}};function At(t){let e=[],n=s(u=>{e.push(u),t(u)},"push"),o=s(()=>{e.pop(),t(i()??null)},"pop"),i=s(()=>e[e.length-1],"cur");return[n,o,i]}s(At,"genStack");function Pr(t,e={}){let n=[];function o(Q){n.push(Q)}s(o,"onDestroy");function i(){n.forEach(Q=>Q()),t.getExtension("WEBGL_lose_context").loseContext()}s(i,"destroy");let u=null;function l(Q){if(Pn(Q,u))return;u=Q;let ue=Q.reduce((N,_)=>N+_.size,0);Q.reduce((N,_,me)=>(t.vertexAttribPointer(me,_.size,t.FLOAT,!1,ue*4,N),t.enableVertexAttribArray(me),N+_.size*4),0)}s(l,"setVertexFormat");let[m,h]=At(Q=>t.bindTexture(t.TEXTURE_2D,Q)),[d,M]=At(Q=>t.bindBuffer(t.ARRAY_BUFFER,Q)),[y,U]=At(Q=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,Q)),[x,K]=At(Q=>t.bindFramebuffer(t.FRAMEBUFFER,Q)),[H,ee]=At(Q=>t.bindRenderbuffer(t.RENDERBUFFER,Q)),[j,J]=At(({x:Q,y:ue,w:N,h:_})=>{t.viewport(Q,ue,N,_)}),[V,se]=At(Q=>t.useProgram(Q));return j({x:0,y:0,w:t.drawingBufferWidth,h:t.drawingBufferHeight}),{gl:t,opts:e,onDestroy:o,destroy:i,pushTexture2D:m,popTexture2D:h,pushArrayBuffer:d,popArrayBuffer:M,pushElementArrayBuffer:y,popElementArrayBuffer:U,pushFramebuffer:x,popFramebuffer:K,pushRenderbuffer:H,popRenderbuffer:ee,pushViewport:j,popViewport:J,pushProgram:V,popProgram:se,setVertexFormat:l}}s(Pr,"initGfx");var Ne=class t{static{s(this,"Asset")}loaded=!1;data=null;error=null;onLoadEvents=new Pe;onErrorEvents=new Pe;onFinishEvents=new Pe;constructor(e){e.then(n=>{this.loaded=!0,this.data=n,this.onLoadEvents.trigger(n)}).catch(n=>{if(this.error=n,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(n);else throw n}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(e){let n=new t(Promise.resolve(e));return n.data=e,n.loaded=!0,n}onLoad(e){return this.loaded&&this.data?e(this.data):this.onLoadEvents.add(e),this}onError(e){return this.loaded&&this.error?e(this.error):this.onErrorEvents.add(e),this}onFinish(e){return this.loaded?e():this.onFinishEvents.add(e),this}then(e){return this.onLoad(e)}catch(e){return this.onError(e)}finally(e){return this.onFinish(e)}},ht=class{static{s(this,"AssetBucket")}assets=new Map;lastUID=0;add(e,n){let o=e??this.lastUID+++"",i=new Ne(n);return this.assets.set(o,i),i}addLoaded(e,n){let o=e??this.lastUID+++"",i=Ne.loaded(n);return this.assets.set(o,i),i}get(e){return this.assets.get(e)}progress(){if(this.assets.size===0)return 1;let e=0;return this.assets.forEach(n=>{n.loaded&&e++}),e/this.assets.size}};function Rr(t){return fetch(t).then(e=>{if(!e.ok)throw new Error(`Failed to fetch "${t}"`);return e})}s(Rr,"fetchURL");function Zt(t){return Rr(t).then(e=>e.json())}s(Zt,"fetchJSON");function _o(t){return Rr(t).then(e=>e.text())}s(_o,"fetchText");function Ho(t){return Rr(t).then(e=>e.arrayBuffer())}s(Ho,"fetchArrayBuffer");function en(t){let e=new Image;return e.crossOrigin="anonymous",e.src=t,new Promise((n,o)=>{e.onload=()=>n(e),e.onerror=()=>o(new Error(`Failed to load image from "${t}"`))})}s(en,"loadImg");var Ur=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",jt="topleft";var qo="monospace",tn="monospace";var nn="linear";var Dn=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],Ua=Dn.reduce((t,e)=>t+e.size,0),zo=2048,Wo=zo*4*Ua,$o=zo*6,Xo=`
attribute vec2 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 0.0, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,Yo=`
precision mediump float;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	return v_color * texture2D(u_tex, v_uv);
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,Gn=`
vec4 vert(vec2 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,Bn=`
vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,Qo=new Set(["id","require"]),Jo=new Set(["add","update","draw","destroy","inspect","drawInspect"]),Mr=/\[(?<style>\w+)\](?<text>.*?)\[\/\k<style>\]/g,Zo=200,es=640,ts=65536;function Ma(t,e,n){let o=[],i=e;for(o.push(i);i!==t;){if(i=n.get(i),i==null)return null;o.push(i)}return o.reverse()}s(Ma,"buildPath");function ns(t,e,n){let o=new Kt((l,m)=>l.cost<m.cost);o.insert({cost:0,node:e});let i=new Map;i.set(e,e);let u=new Map;for(u.set(e,0);o.length!==0;){let l=o.remove()?.node;if(l===n)break;let m=t.getNeighbours(l);for(let h of m){let d=(u.get(l)||0)+t.getCost(l,h)+t.getHeuristic(h,n);(!u.has(h)||d<u.get(h))&&(u.set(h,d),o.insert({cost:d,node:h}),i.set(h,l))}}return Ma(e,n,i)}s(ns,"aStarSearch");var Dr=class{static{s(this,"NavEdge")}a;b;polygon;constructor(e,n,o){this.a=e,this.b=n,this.polygon=new WeakRef(o)}isLeft(e,n){return(this.b.x-this.a.x)*(n-this.a.y)-(e-this.a.x)*(this.b.y-this.a.y)}get middle(){return this.a.add(this.b).scale(.5)}},Gr=class{static{s(this,"NavPolygon")}_edges;_centroid;_id;constructor(e){this._id=e}get id(){return this._id}set edges(e){this._edges=e;let n=0,o=0,i=0;for(let u of this._edges){u.polygon=new WeakRef(this);let l=u.a.x*u.b.y-u.a.y*u.b.x;n+=(u.a.x+u.b.x)*l,o+=(u.a.y+u.b.y)*l,i+=l}i/=2,this._centroid=S(n/(6*i),o/(6*i))}get edges(){return this._edges}get centroid(){return this._centroid}contains(e){let n=!1;for(let o of this.edges)o.b.y>e.y!=o.a.y>e.y&&e.x<(o.a.x-o.b.x)*(e.y-o.b.y)/(o.a.y-o.b.y)+o.b.x&&(n=!n);return n}},Fn=class{static{s(this,"NavMesh")}_polygons;_pointCache;_edgeCache;constructor(){this._polygons=[],this._pointCache={},this._edgeCache={}}_addPoint(e){let n=this._pointCache[`${e.x}_${e.y}`];return n||(n=e.clone(),this._pointCache[`${e.x}_${e.y}`]=n,n)}_addEdge(e){let n=`${e.a.x}_${e.a.y}-${e.b.x}_${e.b.y}`;return this._edgeCache[n]=e,e}_findEdge(e,n){let o=`${e.x}_${e.y}-${n.x}_${n.y}`;return this._edgeCache[o]}_findCommonEdge(e,n){for(let o of e.edges){let i=this._findEdge(o.b,o.a);if(i&&i.polygon.deref().id===n.id)return i}return null}addPolygon(e){let n=new Gr(this._polygons.length),o=e.map((i,u)=>new Dr(i,e[(u+1)%e.length],n));n.edges=o,this._polygons.push(n);for(let i of n.edges)this._addEdge(i);return n}addRect(e,n){let o=this._addPoint(e),i=this._addPoint(e.add(n.x,0)),u=this._addPoint(e.add(n)),l=this._addPoint(e.add(0,n.y));return this.addPolygon([o,i,u,l])}_getLocation(e){for(let n of this._polygons)if(n.contains(e))return n;return null}getNeighbours(e){let n=[];for(let o of this._polygons[e].edges){let i=this._findEdge(o.b,o.a);if(i){let u=i.polygon.deref();u&&n.push(u.id)}}return n}getCost(e,n){return 1}getHeuristic(e,n){let o=this._polygons[e],i=this._polygons[n],u=o.centroid.x-i.centroid.x,l=o.centroid.y-i.centroid.y;return Math.sqrt(u*u+l*l)}getPath(e,n){return e===void 0||n===void 0?[]:e===n?[e,n]:ns(this,e,n)}getWaypointPath(e,n,o){let i=o?.type||"centroids",u=this._getLocation(e),l=this._getLocation(n);if(u===void 0||l===void 0)return[];let m=this.getPath(u.id,l.id);if(!m)return[];if(i==="edges"){let h=[];for(let d=1;d<m.length;d++){let M=this._polygons[m[d-1]],y=this._polygons[m[d]],U=this._findCommonEdge(M,y);h.push(U.middle.add(y.centroid.sub(U.middle).unit().scale(4)))}return[e,...h,n]}else return[e,...m.slice(1,-1).map(h=>this._polygons[h].centroid),n]}};var rn=class{static{s(this,"TexPacker")}textures=[];bigTextures=[];canvas;c2d;x=0;y=0;curHeight=0;gfx;constructor(e,n,o){this.gfx=e,this.canvas=document.createElement("canvas"),this.canvas.width=n,this.canvas.height=o,this.textures=[et.fromImage(e,this.canvas)],this.bigTextures=[],this.c2d=this.canvas.getContext("2d")}add(e){if(e.width>this.canvas.width||e.height>this.canvas.height){let i=et.fromImage(this.gfx,e);return this.bigTextures.push(i),[i,new pe(0,0,1,1)]}this.x+e.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+e.height>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(et.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let n=this.textures[this.textures.length-1],o=new P(this.x,this.y);return this.x+=e.width,e.height>this.curHeight&&(this.curHeight=e.height),e instanceof ImageData?this.c2d.putImageData(e,o.x,o.y):this.c2d.drawImage(e,o.x,o.y),n.update(this.canvas),[n,new pe(o.x/this.canvas.width,o.y/this.canvas.height,e.width/this.canvas.width,e.height/this.canvas.height)]}free(){for(let e of this.textures)e.free();for(let e of this.bigTextures)e.free()}};var In=2.5949095,rs=1.70158+1,os=2*Math.PI/3,ss=2*Math.PI/4.5,Ln={linear:s(t=>t,"linear"),easeInSine:s(t=>1-Math.cos(t*Math.PI/2),"easeInSine"),easeOutSine:s(t=>Math.sin(t*Math.PI/2),"easeOutSine"),easeInOutSine:s(t=>-(Math.cos(Math.PI*t)-1)/2,"easeInOutSine"),easeInQuad:s(t=>t*t,"easeInQuad"),easeOutQuad:s(t=>1-(1-t)*(1-t),"easeOutQuad"),easeInOutQuad:s(t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,"easeInOutQuad"),easeInCubic:s(t=>t*t*t,"easeInCubic"),easeOutCubic:s(t=>1-Math.pow(1-t,3),"easeOutCubic"),easeInOutCubic:s(t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,"easeInOutCubic"),easeInQuart:s(t=>t*t*t*t,"easeInQuart"),easeOutQuart:s(t=>1-Math.pow(1-t,4),"easeOutQuart"),easeInOutQuart:s(t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2,"easeInOutQuart"),easeInQuint:s(t=>t*t*t*t*t,"easeInQuint"),easeOutQuint:s(t=>1-Math.pow(1-t,5),"easeOutQuint"),easeInOutQuint:s(t=>t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2,"easeInOutQuint"),easeInExpo:s(t=>t===0?0:Math.pow(2,10*t-10),"easeInExpo"),easeOutExpo:s(t=>t===1?1:1-Math.pow(2,-10*t),"easeOutExpo"),easeInOutExpo:s(t=>t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2,"easeInOutExpo"),easeInCirc:s(t=>1-Math.sqrt(1-Math.pow(t,2)),"easeInCirc"),easeOutCirc:s(t=>Math.sqrt(1-Math.pow(t-1,2)),"easeOutCirc"),easeInOutCirc:s(t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2,"easeInOutCirc"),easeInBack:s(t=>rs*t*t*t-1.70158*t*t,"easeInBack"),easeOutBack:s(t=>1+rs*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2),"easeOutBack"),easeInOutBack:s(t=>t<.5?Math.pow(2*t,2)*((In+1)*2*t-In)/2:(Math.pow(2*t-2,2)*((In+1)*(t*2-2)+In)+2)/2,"easeInOutBack"),easeInElastic:s(t=>t===0?0:t===1?1:-Math.pow(2,10*t-10)*Math.sin((t*10-10.75)*os),"easeInElastic"),easeOutElastic:s(t=>t===0?0:t===1?1:Math.pow(2,-10*t)*Math.sin((t*10-.75)*os)+1,"easeOutElastic"),easeInOutElastic:s(t=>t===0?0:t===1?1:t<.5?-(Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*ss))/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*ss)/2+1,"easeInOutElastic"),easeInBounce:s(t=>1-Ln.easeOutBounce(1-t),"easeInBounce"),easeOutBounce:s(t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,"easeOutBounce"),easeInOutBounce:s(t=>t<.5?(1-Ln.easeOutBounce(1-2*t))/2:(1+Ln.easeOutBounce(2*t-1))/2,"easeInOutBounce")},bt=Ln;var Pt=class{static{s(this,"FontData")}fontface;filter=nn;outline=null;size=64;constructor(e,n={}){if(this.fontface=e,this.filter=n.filter??nn,this.size=n.size??64,this.size>256)throw new Error(`Max font size: ${256}`);n.outline&&(this.outline={width:1,color:le(0,0,0)},typeof n.outline=="number"?this.outline.width=n.outline:typeof n.outline=="object"&&(n.outline.width&&(this.outline.width=n.outline.width),n.outline.color&&(this.outline.color=n.outline.color)))}};function is(t,e={}){let n=ne(this),{getRenderProps:o}=n._k;return{id:"circle",radius:t,draw(){n.drawCircle(Object.assign(o(this),{radius:this.radius,fill:e.fill}))},renderArea(){return new be(new P(this.anchor?0:-this.radius),this.radius*2,this.radius*2)},inspect(){return`radius: ${Math.ceil(this.radius)}`}}}s(is,"circle");function Br(...t){return{id:"color",color:le(...t),inspect(){return`color: ${this.color.toString()}`}}}s(Br,"color");function as(t){return{add(){this.canvas=t}}}s(as,"drawon");function us(t=1){let e=ne(this),n,o=0,i=!1;return{require:["opacity"],add(){n=this.opacity,this.opacity=0},update(){i||(o+=e.dt(),this.opacity=e.map(o,0,t,0,n),o>=t&&(this.opacity=n,i=!0))}}}s(us,"fadeIn");function cs(t="intersect"){return{id:"mask",mask:t}}s(cs,"mask");function Fr(t){let e=ne(this),{toFixed:n}=e._k;return{id:"opacity",opacity:t??1,fadeIn(o=1,i=e.easings.linear){return e.tween(0,this.opacity,o,u=>this.opacity=u,i)},fadeOut(o=1,i=e.easings.linear){return e.tween(this.opacity,0,o,u=>this.opacity=u,i)},inspect(){return`opacity: ${n(this.opacity,1)}`}}}s(Fr,"opacity");function ls(t=1,e=le(0,0,0),n=1,o="miter",i=10,u="butt"){return{id:"outline",outline:{width:t,color:e,opacity:n,join:o,miterLimit:i,cap:u},inspect(){return`outline: ${this.outline.width}px, ${this.outline.color}`}}}s(ls,"outline");var Ir=class{static{s(this,"Particle")}pos;vel;acc;angle;angularVelocity;damping;t;lt;gc;constructor(){this.t=0,this.gc=!0}get progress(){return this.lt?this.t/this.lt:this.t}};function ms(t,e){let n=ne(this),o=e.lifetime,i=[],u=t.colors||[n.WHITE],l=t.opacities||[1],m=t.quads||[new pe(0,0,1,1)],h=t.scales||[1],d=t.lifeTime,M=e.direction,y=e.spread,U=t.speed||[0,0],x=t.angle||[0,0],K=t.angularVelocity||[0,0],H=t.acceleration||[S(0),S(0)],ee=t.damping||[0,0],j=[],J=new Array(t.max),V=0,se=0;for(let N=0;N<t.max;N++){j[N*6+0]=N*4+0,j[N*6+1]=N*4+1,j[N*6+2]=N*4+3,j[N*6+3]=N*4+1,j[N*6+4]=N*4+2,j[N*6+5]=N*4+3;for(let _=0;_<4;_++)J[N*4+_]={pos:new P(0,0),uv:new P(0,0),color:n.rgb(255,255,255),opacity:1};i[N]=new Ir}let Q=new Pe;function ue(N=0){for(;N<t.max;){if(i[N].gc)return N;N++}return null}return s(ue,"nextFree"),{id:"particles",emit(N){let _=0;for(let me=0;me<N;me++){if(_=ue(_),_==null)return;let fe=n.rand(M-y,M+y),ae=P.fromAngle(fe).scale(n.rand(U[0],U[1])),xe=n.rand(x[0],x[1]),he=n.rand(K[0],K[1]),Be=S(n.rand(H[0].x,H[1].x),n.rand(H[0].y,H[1].y)),de=n.rand(ee[0],ee[1]),Fe=d?n.rand(d[0],d[1]):null,ce=e.shape?e.shape.random():S(),ye=i[_];ye.lt=Fe,ye.pos=ce,ye.vel=ae,ye.acc=Be,ye.angle=xe,ye.angularVelocity=he,ye.damping=de,ye.angularVelocity=he,ye.gc=!1}V+=N},update(){if(e.lifetime<=0)return;let N=n.dt();for(let _ of i)if(!_.gc){if(_.t+=N,_.lt&&_.t>=_.lt){_.gc=!0,V--;continue}_.vel=_.vel.add(_.acc.scale(N)).scale(1-_.damping*N),_.pos=_.pos.add(_.vel.scale(N)),_.angle+=_.angularVelocity*N}for(o!==void 0&&(o-=N,o<=0&&Q.trigger()),se+=N;V<t.max&&e.rate&&se>e.rate;)this.emit(1),V++,se-=e.rate},draw(){if(!(o<=0)){for(let N=0;N<i.length;N++){let _=i[N];if(_.gc)continue;let me=_.progress,fe=Math.floor(_.progress*u.length),ae=fe<u.length-1?Ke(u[fe],u[fe+1],Ze(me,fe/u.length,(fe+1)/u.length,0,1)):u[fe],xe=Math.floor(_.progress*l.length),he=xe<l.length-1?Ke(l[xe],l[xe+1],Ze(me,xe/l.length,(xe+1)/l.length,0,1)):l[xe],Be=Math.floor(_.progress*m.length),de=m[Be],Fe=Math.floor(_.progress*h.length),ce=h[Fe],ye=Math.cos(_.angle*Math.PI/180),ve=Math.sin(_.angle*Math.PI/180),Te=(t.texture?t.texture.width:10)*de.w/2,Se=(t.texture?t.texture.height:10)*de.h/2,Xe=N*4,te=J[Xe];te.pos.x=_.pos.x+-Te*ce*ye- -Se*ce*ve,te.pos.y=_.pos.y+-Te*ce*ve+-Se*ce*ye,te.uv.x=de.x,te.uv.y=de.y,te.color.r=ae.r,te.color.g=ae.g,te.color.b=ae.b,te.opacity=he,te=J[Xe+1],te.pos.x=_.pos.x+Te*ce*ye- -Se*ce*ve,te.pos.y=_.pos.y+Te*ce*ve+-Se*ce*ye,te.uv.x=de.x+de.w,te.uv.y=de.y,te.color.r=ae.r,te.color.g=ae.g,te.color.b=ae.b,te.opacity=he,te=J[Xe+2],te.pos.x=_.pos.x+Te*ce*ye-Se*ce*ve,te.pos.y=_.pos.y+Te*ce*ve+Se*ce*ye,te.uv.x=de.x+de.w,te.uv.y=de.y+de.h,te.color.r=ae.r,te.color.g=ae.g,te.color.b=ae.b,te.opacity=he,te=J[Xe+3],te.pos.x=_.pos.x+-Te*ce*ye-Se*ce*ve,te.pos.y=_.pos.y+-Te*ce*ve+Se*ce*ye,te.uv.x=de.x,te.uv.y=de.y+de.h,te.color.r=ae.r,te.color.g=ae.g,te.color.b=ae.b,te.opacity=he}n._k.drawRaw(J,j,this.fixed,t.texture,this.shader,this.uniform)}},onEnd(N){return Q.add(N)},inspect(){return`count: ${V}/${t.max}`}}}s(ms,"particles");function ds(t,e={}){let n=ne(this),{getRenderProps:o}=n._k;if(t.length<3)throw new Error(`Polygon's need more than two points, ${t.length} points provided`);return{id:"polygon",pts:t,colors:e.colors,uv:e.uv,tex:e.tex,radius:e.radius,draw(){n.drawPolygon(Object.assign(o(this),{pts:this.pts,colors:this.colors,uv:this.uv,tex:this.tex,radius:this.radius,fill:e.fill,triangulate:e.triangulate}))},renderArea(){return new Ie(this.pts)},inspect(){return`polygon: ${this.pts.map(i=>`[${i.x},${i.y}]`).join(",")}`}}}s(ds,"polygon");function Kn(t,e,n){let o=ne(this),i;return o.get("area").forEach(l=>{if(n&&n.some(d=>l.is(d)))return;let h=l.worldArea().raycast(t,e);h&&(i?h.fraction<i.fraction&&(i=h,i.object=l):(i=h,i.object=l))}),i}s(Kn,"raycast");function Lr(t,e,n={}){let o=ne(this),{getRenderProps:i}=o._k;return{id:"rect",width:t,height:e,radius:n.radius||0,draw(){o.drawRect(Object.assign(i(this),{width:this.width,height:this.height,radius:this.radius,fill:n.fill}))},renderArea(){return new be(S(0),this.width,this.height)},inspect(){return`rect: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)}h)`}}}s(Lr,"rect");function hs(t,e){return{id:"shader",shader:t,...typeof e=="function"?{uniform:e(),update(){this.uniform=e()}}:{uniform:e},inspect(){return`shader: ${t}`}}}s(hs,"shader");function jn(t,e={}){let n=ne(this),{drawTexture:o,getRenderProps:i,resolveSprite:u}=n._k,l=null,m=null,h=null,d=new Pe;if(!t)throw new Error("Please pass the resource name or data to sprite()");let M=s((y,U,x,K)=>{let H=S(1,1);return x&&K?(H.x=x/(y.width*U.w),H.y=K/(y.height*U.h)):x?(H.x=x/(y.width*U.w),H.y=H.x):K&&(H.y=K/(y.height*U.h),H.x=H.y),H},"calcTexScale");return{id:"sprite",width:0,height:0,frame:e.frame||0,quad:e.quad||new pe(0,0,1,1),animSpeed:e.animSpeed??1,flipX:e.flipX??!1,flipY:e.flipY??!1,get sprite(){return t.toString()},draw(){if(!l)return;let y=l.frames[this.frame??0];if(!y)throw new Error(`Frame not found: ${this.frame??0}`);if(l.slice9){let{left:U,right:x,top:K,bottom:H}=l.slice9,ee=l.tex.width*y.w,j=l.tex.height*y.h,J=this.width-U-x,V=this.height-K-H,se=U/ee,Q=x/ee,ue=1-se-Q,N=K/j,_=H/j,me=1-N-_,fe=[Ae(0,0,se,N),Ae(se,0,ue,N),Ae(se+ue,0,Q,N),Ae(0,N,se,me),Ae(se,N,ue,me),Ae(se+ue,N,Q,me),Ae(0,N+me,se,_),Ae(se,N+me,ue,_),Ae(se+ue,N+me,Q,_),Ae(0,0,U,K),Ae(U,0,J,K),Ae(U+J,0,x,K),Ae(0,K,U,V),Ae(U,K,J,V),Ae(U+J,K,x,V),Ae(0,K+V,U,H),Ae(U,K+V,J,H),Ae(U+J,K+V,x,H)];for(let ae=0;ae<9;ae++){let xe=fe[ae],he=fe[ae+9];o(Object.assign(i(this),{pos:he.pos(),tex:l.tex,quad:y.scale(xe),flipX:this.flipX,flipY:this.flipY,tiled:e.tiled,width:he.w,height:he.h}))}}else o(Object.assign(i(this),{tex:l.tex,quad:y.scale(this.quad??new pe(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:e.tiled,width:this.width,height:this.height}))},add(){let y=s(x=>{let K=x.frames[0].clone();e.quad&&(K=K.scale(e.quad));let H=M(x.tex,K,e.width,e.height);this.width=x.tex.width*K.w*H.x,this.height=x.tex.height*K.h*H.y,e.anim&&this.play(e.anim),l=x,d.trigger(l)},"setSpriteData"),U=u(t);U?U.onLoad(y):n.onLoad(()=>y(u(t).data))},update(){if(!m)return;let y=l.anims[m.name];if(typeof y=="number"){this.frame=y;return}if(y.speed===0)throw new Error("Sprite anim speed cannot be 0");m.timer+=n.dt()*this.animSpeed,m.timer>=1/m.speed&&(m.timer=0,this.frame+=h,(this.frame<Math.min(y.from,y.to)||this.frame>Math.max(y.from,y.to))&&(m.loop?m.pingpong?(this.frame-=h,h*=-1,this.frame+=h):this.frame=y.from:m.pingpong?h===Math.sign(y.to-y.from)?(this.frame=y.to,h*=-1,this.frame+=h):(this.frame=y.from,m.onEnd(),this.stop()):(this.frame=y.to,m.onEnd(),this.stop())))},play(y,U={}){if(!l){d.add(()=>this.play(y,U));return}let x=l.anims[y];if(x===void 0)throw new Error(`Anim not found: ${y}`);m&&this.stop(),m=typeof x=="number"?{name:y,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:s(()=>{},"onEnd")}:{name:y,timer:0,loop:U.loop??x.loop??!1,pingpong:U.pingpong??x.pingpong??!1,speed:U.speed??x.speed??10,onEnd:U.onEnd??(()=>{})},h=typeof x=="number"?null:x.from<x.to?1:-1,this.frame=typeof x=="number"?x:x.from,this.trigger("animStart",y)},stop(){if(!m)return;let y=m.name;m=null,this.trigger("animEnd",y)},numFrames(){return l?.frames.length??0},getCurAnim(){return m},curAnim(){return m?.name},onAnimEnd(y){return this.on("animEnd",y)},onAnimStart(y){return this.on("animStart",y)},renderArea(){return new n.Rect(S(0),this.width,this.height)},inspect(){if(typeof t=="string")return`sprite: "${t}"`}}}s(jn,"sprite");function ps(t,e={}){let n=ne(this),{getRenderProps:o}=n._k;function i(l){let m=n.formatText(Object.assign(o(l),{text:l.text+"",size:l.textSize,font:l.font,width:e.width&&l.width,align:l.align,letterSpacing:l.letterSpacing,lineSpacing:l.lineSpacing,transform:l.textTransform,styles:l.textStyles}));return e.width||(l.width=m.width/(l.scale?.x||1)),l.height=m.height/(l.scale?.y||1),m}s(i,"update");let u={id:"text",set text(l){t=l,i(this)},get text(){return t},textSize:e.size??36,font:e.font,width:e.width??0,height:0,align:e.align,lineSpacing:e.lineSpacing,letterSpacing:e.letterSpacing,textTransform:e.transform,textStyles:e.styles,add(){n.onLoad(()=>i(this))},draw(){n.drawFormattedText(i(this))},renderArea(){return new be(S(0),this.width,this.height)}};return i(u),u}s(ps,"text");function fs(t,e){let n=ne(this),{getRenderProps:o}=n._k;return{id:"rect",width:t,height:e,draw(){n.drawUVQuad(Object.assign(o(this),{width:this.width,height:this.height}))},renderArea(){return new be(S(0),this.width,this.height)},inspect(){return`uvquad: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)})h`}}}s(fs,"uvquad");function gs(t={}){let e=null,n=null,o=null,i=null;return{id:"agent",require:["pos","tile"],agentSpeed:t.speed??100,allowDiagonals:t.allowDiagonals??!0,getDistanceToTarget(){return e?this.pos.dist(e):0},getNextLocation(){return n&&o?n[o]:null},getPath(){return n?n.slice():null},getTarget(){return e},isNavigationFinished(){return n?o===null:!0},isTargetReachable(){return n!==null},isTargetReached(){return e?this.pos.eq(e):!0},setTarget(u){e=u,n=this.getLevel().getPath(this.pos,e,{allowDiagonals:this.allowDiagonals}),o=n?0:null,n?(i||(i=this.getLevel().onNavigationMapChanged(()=>{n&&o!==null&&(n=this.getLevel().getPath(this.pos,e,{allowDiagonals:this.allowDiagonals}),o=n?0:null,n?this.trigger("navigation-next",this,n[o]):this.trigger("navigation-ended",this))}),this.onDestroy(()=>i.cancel())),this.trigger("navigation-started",this),this.trigger("navigation-next",this,n[o])):this.trigger("navigation-ended",this)},update(){if(n&&o!==null){if(this.pos.sdist(n[o])<2)if(o===n.length-1){this.pos=e.clone(),o=null,this.trigger("navigation-ended",this),this.trigger("target-reached",this);return}else o++,this.trigger("navigation-next",this,n[o]);this.moveTo(n[o],this.agentSpeed)}},onNavigationStarted(u){return this.on("navigation-started",u)},onNavigationNext(u){return this.on("navigation-next",u)},onNavigationEnded(u){return this.on("navigation-ended",u)},onTargetReached(u){return this.on("target-reached",u)},inspect(){return"agent: "+JSON.stringify({target:JSON.stringify(e),path:JSON.stringify(n)})}}}s(gs,"agent");function bs(t){let e=t.graph;return{id:"navigator",require:["pos"],navigateTo(n){return this.graph?.getWaypointPath(this.pos,n,t.navigationOpt)},get graph(){if(e)return e;let n=this.parent;for(;n;){if(n.is("navigatormap"))return n.graph;n=n.parent}return null},set graph(n){e=n}}}s(bs,"navigation");function ys(t={}){let e=t.waypoints,n=t.speed||100,o=t.endBehavior||"stop",i=0,u=e!=null;return{id:"patrol",require:["pos"],get patrolSpeed(){return n},set patrolSpeed(l){n=l},get waypoints(){return e},set waypoints(l){e=l,i=0,u=!1},get nextLocation(){return e?e[i]:null},update(){let l=this.nextLocation;if(!(!e||!l||u)&&(this.moveTo(l,n),this.pos.sdist(l)<9))switch(o){case"loop":i=(i+1)%e.length;break;case"ping-pong":i=i+1,i==e.length&&(e.reverse(),i=0);break;case"stop":i=Math.min(i+1,e.length-1),i==e.length-1&&(u=!0,this.trigger("patrol-finished"));break}},onPatrolFinished(l){return this.on("patrol-finished",l)}}}s(ys,"patrol");function xs(t,e={}){let n=ne(this),o=typeof t=="function"?t:()=>n.query(t),i=e.checkFrequency||1,u=typeof e.direction=="number"?P.fromAngle(e.direction):e.direction,l=0;return{id:"sentry",require:["pos"],direction:typeof e.direction=="number"?P.fromAngle(e.direction):e.direction,spotted:[],set directionAngle(m){this.direction=m!==void 0?P.fromAngle(m):void 0},get directionAngle(){return this.direction?this.direction.angle():void 0},fieldOfView:e.fieldOfView||200,isWithinFieldOfView(m,h,d){let M=(typeof h=="number"?P.fromAngle(h):h)||u,y=d||e.fieldOfView;if(!M||!y||y>=360)return!0;let U=y/2;return m.pos&&M.angleBetween(m.pos.sub(this.pos))<=U},hasLineOfSight(m){let h=Kn(this.pos,m.pos.sub(this.pos),e.raycastExclude);return h&&h.object===m},update(){if(l+=n.dt(),l>i){l-=i;let m=o();if(m.length&&u&&this.fieldOfView&&this.fieldOfView<360){let h=this.fieldOfView/2;m=m.filter(d=>d.pos&&u.angleBetween(d.pos.sub(this.pos))<=h)}m.length&&e.lineOfSight&&(m=m.filter(h=>h.pos&&this.hasLineOfSight(h))),m.length>0&&(this.spotted=m,this.trigger("object-spotted",m))}},onObjectsSpotted(m){return this.on("object-spotted",m)}}}s(xs,"sentry");function Kr(t={}){let e=S(0),n=t.isObstacle??!1,o=t.cost??0,i=t.edges??[],u=s(()=>{let m={left:1,top:2,right:4,bottom:8};return i.map(h=>m[h]||0).reduce((h,d)=>h|d,0)},"getEdgeMask"),l=u();return{id:"tile",tilePosOffset:t.offset??S(0),set tilePos(m){let h=this.getLevel();e=m.clone(),this.pos=S(this.tilePos.x*h.tileWidth(),this.tilePos.y*h.tileHeight()).add(this.tilePosOffset)},get tilePos(){return e},set isObstacle(m){n!==m&&(n=m,this.getLevel().invalidateNavigationMap())},get isObstacle(){return n},set cost(m){o!==m&&(o=m,this.getLevel().invalidateNavigationMap())},get cost(){return o},set edges(m){i=m,l=u(),this.getLevel().invalidateNavigationMap()},get edges(){return i},get edgeMask(){return l},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(S(-1,0))},moveRight(){this.tilePos=this.tilePos.add(S(1,0))},moveUp(){this.tilePos=this.tilePos.add(S(0,-1))},moveDown(){this.tilePos=this.tilePos.add(S(0,1))}}}s(Kr,"tile");var an=class{static{s(this,"AnimateChannel")}name;duration;endBehavior;easing;interpolation;isFinished;timing;easings;constructor(e,n){this.name=e,this.duration=n.duration,this.endBehavior=n.endBehavior||"stop",this.easing=n.easing||bt.linear,this.interpolation=n.interpolation||"linear",this.isFinished=!1,this.timing=n.timing,this.easings=n.easings}update(e,n){return!0}getLowerKeyIndexAndRelativeTime(e,n,o){let i=n-1;if(e>=this.duration&&this.endBehavior=="stop")return[i,0];let u=e/this.duration,l=Math.trunc(u);if(u-=l,this.endBehavior=="ping-pong"&&l&1&&(u=1-u),o){let m=0;for(;o[m+1]!==void 0&&o[m+1]<u;)m++;return m>=i?[i,0]:[m,(u-o[m])/(o[m+1]-o[m])]}else{let m=Math.floor((n-1)*u);return[m,(u-m/i)*i]}}};function vs(t,e){return e.add(e.sub(t))}s(vs,"reflect");var jr=class extends an{static{s(this,"AnimateChannelNumber")}keys;constructor(e,n,o){super(e,o),this.keys=n}update(e,n){let[o,i]=this.getLowerKeyIndexAndRelativeTime(n,this.keys.length,this.timing);if(i==0)e[this.name]=this.keys[o];else{let u=this.easings?this.easings[o]:this.easing;e[this.name]=Ke(this.keys[o],this.keys[o+1],u(i))}return i==1}},kr=class extends an{static{s(this,"AnimateChannelVec2")}keys;constructor(e,n,o){super(e,o),this.keys=n}update(e,n){let[o,i]=this.getLowerKeyIndexAndRelativeTime(n,this.keys.length,this.timing);if(i==0)e[this.name]=this.keys[o];else{let u=this.easings?this.easings[o]:this.easing;if(this.interpolation==="linear")e[this.name]=this.keys[o].lerp(this.keys[o+1],u(i));else{let l=this.keys[o],m=o+1,h=this.keys[m],d=o>0?this.keys[o-1]:vs(h,l),M=m<this.keys.length-1?this.keys[m+1]:vs(l,h);e[this.name]=Vn(d,l,h,M,u(i))}}return i==1}},Nr=class extends an{static{s(this,"AnimateChannelColor")}keys;constructor(e,n,o){super(e,o),this.keys=n}update(e,n){let[o,i]=this.getLowerKeyIndexAndRelativeTime(n,this.keys.length,this.timing);if(i==0)e[this.name]=this.keys[o];else{let u=this.easings?this.easings[o]:this.easing;e[this.name]=this.keys[o].lerp(this.keys[o+1],u(i))}return i==1}};function ws(){let t=ne(this),e=[],n=0,o=!1;return{update(){let i=!0,u;n+=t.dt();for(let l of e)u=l.update(this,n),u&&!l.isFinished&&(l.isFinished=!0,this.trigger("animate-channel-finished",l.name)),i&&=u;i&&!o&&(o=!0,this.trigger("animate-finished"))},animate(i,u,l){o=!1,this.unanimate(i),typeof u[0]=="number"?e.push(new jr(i,u,l)):u[0]instanceof P?e.push(new kr(i,u,l)):u[0]instanceof ie&&e.push(new Nr(i,u,l))},unanimate(i){let u=e.findIndex(l=>l.name===i);u>=0&&e.splice(u,1)},unanimateAll(){e.splice(0,e.length)},onAnimateFinished(i){return this.on("animate-finished",i)},onAnimateChannelFinished(i){return this.on("animate-channel-finished",i)}}}s(ws,"animate");function Cs(t,e){if(t==null)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(n=1){this.setHP(t-n),this.trigger("hurt",n)},heal(n=1){let o=t;this.setHP(t+n),this.trigger("heal",t-o)},hp(){return t},maxHP(){return e??null},setMaxHP(n){e=n},setHP(n){t=e?Math.min(e,n):n,t<=0&&this.trigger("death")},onHurt(n){return this.on("hurt",n)},onHeal(n){return this.on("heal",n)},onDeath(n){return this.on("death",n)},inspect(){return`health: ${t}`}}}s(Cs,"health");function Ts(t,e={}){let n=ne(this);if(t==null)throw new Error("lifespan() requires time");let o=e.fade??0;return{id:"lifespan",require:["opacity"],async add(){await n.wait(t),this.opacity=this.opacity??1,o>0&&await n.tween(this.opacity,0,o,i=>this.opacity=i,bt.linear),this.destroy()}}}s(Ts,"lifespan");function Ss(t){return{name:t}}s(Ss,"named");function Es(t,e,n){if(!t)throw new Error("state() requires an initial state");let o={};function i(h){o[h]||(o[h]={enter:new Pe,end:new Pe,update:new Pe,draw:new Pe})}s(i,"initStateEvents");function u(h,d,M){return i(d),o[d][h].add(M)}s(u,"on");function l(h,d,...M){i(d),o[d][h].trigger(...M)}s(l,"trigger");let m=!1;return{id:"state",state:t,enterState(h,...d){if(m=!0,e&&!e.includes(h))throw new Error(`State not found: ${h}`);let M=this.state;if(n){if(!n?.[M])return;let y=typeof n[M]=="string"?[n[M]]:n[M];if(!y.includes(h))throw new Error(`Cannot transition state from "${M}" to "${h}". Available transitions: ${y.map(U=>`"${U}"`).join(", ")}`)}l("end",M,...d),this.state=h,l("enter",h,...d),l("enter",`${M} -> ${h}`,...d)},onStateTransition(h,d,M){return u("enter",`${h} -> ${d}`,M)},onStateEnter(h,d){return u("enter",h,d)},onStateUpdate(h,d){return u("update",h,d)},onStateDraw(h,d){return u("draw",h,d)},onStateEnd(h,d){return u("end",h,d)},update(){m||(l("enter",t),m=!0),l("update",this.state)},draw(){l("draw",this.state)},inspect(){return`state: ${this.state}`}}}s(Es,"state");function _r(t){return{id:"stay",stay:!0,scenesToStay:t}}s(_r,"stay");function Os(t=!0,e){let n=ne(this),o,i;return{id:"textInput",hasFocus:t,add(){o=n.onCharInput(u=>{this.hasFocus&&(!e||this.text.length<e)&&(n.isKeyDown("shift")?this.text+=u.toUpperCase():this.text+=u)}),i=n.onKeyPress("backspace",()=>{this.hasFocus&&(this.text=this.text.slice(0,-1))})},destroy(){o.cancel(),i.cancel()}}}s(Os,"textInput");function kn(){return{id:"timer",wait(t,e){let n=ne(this),o=[];e&&o.push(e);let i=0,u=this.onUpdate(()=>{i+=n.dt(),i>=t&&(o.forEach(l=>l()),u.cancel())});return{get paused(){return u.paused},set paused(l){u.paused=l},cancel:u.cancel,onEnd(l){o.push(l)},then(l){return this.onEnd(l),this}}},loop(t,e){let n=null,o=s(()=>{n=this.wait(t,o),e()},"newAction");return n=this.wait(0,o),{get paused(){return n.paused},set paused(i){n.paused=i},cancel:s(()=>n.cancel(),"cancel")}},tween(t,e,n,o,i=bt.linear){let u=ne(this),l=0,m=[],h=this.onUpdate(()=>{l+=u.dt();let d=Math.min(l/n,1);o(Ke(t,e,i(d))),d===1&&(h.cancel(),o(e),m.forEach(M=>M()))});return{get paused(){return h.paused},set paused(d){h.paused=d},onEnd(d){m.push(d)},then(d){return this.onEnd(d),this},cancel(){h.cancel()},finish(){h.cancel(),o(e),m.forEach(d=>d())}}}}}s(kn,"timer");function As(t={}){let e=ne(this),{app:n,isFixed:o,getViewportScale:i,game:u}=e._k,l={},m=new Set;return{id:"area",collisionIgnore:t.collisionIgnore??[],add(){this.area.cursor&&this.onHover(()=>n.setCursor(this.area.cursor)),this.onCollideUpdate((h,d)=>{l[h.id]||this.trigger("collide",h,d),l[h.id]=d,m.add(h.id)})},update(){for(let h in l)m.has(Number(h))||(this.trigger("collideEnd",l[h].target),delete l[h]);m.clear()},drawInspect(){let h=this.localArea();e.pushTransform(),e.pushScale(this.area.scale),e.pushTranslate(this.area.offset);let d={outline:{width:4/i(),color:le(0,0,255)},anchor:this.anchor,fill:!1,fixed:o(this)};h instanceof e.Rect?e.drawRect({...d,pos:h.pos,width:h.width,height:h.height}):h instanceof e.Polygon?e.drawPolygon({...d,pts:h.pts}):h instanceof e.Circle&&e.drawCircle({...d,pos:h.center,radius:h.radius}),e.popTransform()},area:{shape:t.shape??null,scale:t.scale?S(t.scale):S(1),offset:t.offset??S(0),cursor:t.cursor??null},isClicked(){return n.isMousePressed()&&this.isHovering()},isHovering(){let h=o(this)?e.mousePos():e.toWorld(e.mousePos());return this.hasPoint(h)},checkCollision(h){return l[h.id]??null},getCollisions(){return Object.values(l)},isColliding(h){return!!l[h.id]},isOverlapping(h){let d=l[h.id];return d&&d.hasOverlap()},onClick(h,d="left"){let M=n.onMousePress(d,()=>{this.isHovering()&&h()});return this.onDestroy(()=>M.cancel()),M},onHover(h){let d=!1;return this.onUpdate(()=>{d?d=this.isHovering():this.isHovering()&&(d=!0,h())})},onHoverUpdate(h){return this.onUpdate(()=>{this.isHovering()&&h()})},onHoverEnd(h){let d=!1;return this.onUpdate(()=>{d?this.isHovering()||(d=!1,h()):d=this.isHovering()})},onCollide(h,d){if(typeof h=="function"&&d===void 0)return this.on("collide",h);if(typeof h=="string")return this.onCollide((M,y)=>{M.is(h)&&d(M,y)})},onCollideUpdate(h,d){if(typeof h=="function"&&d===void 0)return this.on("collideUpdate",h);if(typeof h=="string")return this.on("collideUpdate",(M,y)=>M.is(h)&&d(M,y))},onCollideEnd(h,d){if(typeof h=="function"&&d===void 0)return this.on("collideEnd",h);if(typeof h=="string")return this.on("collideEnd",M=>M.is(h)&&d(M))},hasPoint(h){return lt(this.worldArea(),h)},resolveCollision(h){let d=this.checkCollision(h);d&&!d.resolved&&(this.pos=this.pos.add(d.displacement),d.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let h=this.localArea();if(!(h instanceof e.Polygon||h instanceof e.Rect))throw new Error("Only support polygon and rect shapes for now");let d=this.transform.clone().scale(S(this.area.scale??1)).translate(this.area.offset);if(h instanceof e.Rect){let M=Rt(this.anchor||jt).add(1,1).scale(-.5).scale(h.width,h.height);d.translate(M)}return h.transform(d)},screenArea(){let h=this.worldArea();return o(this)?h:h.transform(u.cam.transform)},inspect(){return this.area.scale.x==this.area.scale.y?`area: ${this.area.scale.x.toFixed(1)}x`:`area: (${this.area.scale.x.toFixed(1)}x, ${this.area.scale.y.toFixed(1)}y)`}}}s(As,"area");function Vs(t={}){let e=ne(this),{calcTransform:n,game:o}=e._k,i=null,u=null,l=!1;return{id:"body",require:["pos"],vel:S(0),drag:t.drag??0,jumpForce:t.jumpForce??es,gravityScale:t.gravityScale??1,isStatic:t.isStatic??!1,mass:t.mass??1,add(){if(this.mass===0)throw new Error("Can't set body mass to 0");this.is("area")&&(this.onCollideUpdate((m,h)=>{if(!m.is("body")||h.resolved)return;this.trigger("beforePhysicsResolve",h);let d=h.reverse();if(m.trigger("beforePhysicsResolve",d),!(h.resolved||d.resolved)&&!(this.isStatic&&m.isStatic)){if(!this.isStatic&&!m.isStatic){let M=this.mass+m.mass;this.pos=this.pos.add(h.displacement.scale(m.mass/M)),m.pos=m.pos.add(h.displacement.scale(-this.mass/M)),this.transform=n(this),m.transform=n(m)}else{let M=!this.isStatic&&m.isStatic?h:h.reverse();M.source.pos=M.source.pos.add(M.displacement),M.source.transform=n(M.source)}h.resolved=!0,this.trigger("physicsResolve",h),m.trigger("physicsResolve",h.reverse())}}),this.onPhysicsResolve(m=>{o.gravity&&(m.isBottom()&&this.isFalling()?(this.vel=this.vel.reject(o.gravity.unit()),i=m.target,u=m.target.pos,l?l=!1:this.trigger("ground",i)):m.isTop()&&this.isJumping()&&(this.vel=this.vel.reject(o.gravity.unit()),this.trigger("headbutt",m.target)))}))},update(){if(o.gravity&&!this.isStatic){l&&(i=null,u=null,this.trigger("fallOff"),l=!1);let m=!0;if(i&&(!this.isColliding(i)||!i.exists()||!i.is("body")?l=!0:(!i.pos.eq(u)&&t.stickToPlatform!==!1&&this.moveBy(i.pos.sub(u)),u=i.pos,m=!1)),m){let h=this.vel.clone();this.vel=this.vel.add(o.gravity.scale(this.gravityScale*e.dt()));let d=t.maxVelocity??ts;this.vel.slen()>d*d&&(this.vel=this.vel.unit().scale(d)),h.dot(o.gravity)<0&&this.vel.dot(o.gravity)>=0&&this.trigger("fall")}}this.vel.x*=1-this.drag,this.vel.y*=1-this.drag,this.move(this.vel)},onPhysicsResolve(m){return this.on("physicsResolve",m)},onBeforePhysicsResolve(m){return this.on("beforePhysicsResolve",m)},curPlatform(){return i},isGrounded(){return i!==null},isFalling(){return this.vel.dot(e.getGravityDirection())>0},isJumping(){return this.vel.dot(e.getGravityDirection())<0},jump(m){i=null,u=null,this.vel=e.getGravityDirection().scale(-m||-this.jumpForce)},onGround(m){return this.on("ground",m)},onFall(m){return this.on("fall",m)},onFallOff(m){return this.on("fallOff",m)},onHeadbutt(m){return this.on("headbutt",m)},inspect(){return`gravityScale: ${this.gravityScale}x`}}}s(Vs,"body");function Ps(t=2){let e=t;return{id:"doubleJump",require:["body"],numJumps:t,add(){this.onGround(()=>{e=this.numJumps})},doubleJump(n){e<=0||(e<this.numJumps&&this.trigger("doubleJump"),e--,this.jump(n))},onDoubleJump(n){return this.on("doubleJump",n)},inspect(){return`jumpsLeft: ${e}`}}}s(Ps,"doubleJump");function Nn(t){if(!t)throw new Error("Please define an anchor");return{id:"anchor",anchor:t,inspect(){return typeof this.anchor=="string"?"anchor: "+this.anchor:"anchor: "+this.anchor.toString()}}}s(Nn,"anchor");function Hr(){return{id:"fixed",fixed:!0}}s(Hr,"fixed");function Rs(t,e){return{id:"follow",require:["pos"],follow:{obj:t,offset:e??S(0)},add(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}s(Rs,"follow");function Us(t){let e=ne(this),{game:n}=e._k,o=n.layers.indexOf(t);return{id:"layer",get layerIndex(){return o},get layer(){return n.layers[o]},set layer(i){if(o=n.layers.indexOf(i),o==-1)throw Error("Invalid layer name")},inspect(){return`layer: ${this.layer}`}}}s(Us,"layer");function Ms(t,e){let n=typeof t=="number"?P.fromAngle(t):t.unit();return{id:"move",require:["pos"],update(){this.move(n.scale(e))}}}s(Ms,"move");function Ds(t={}){let e=ne(this),n=t.distance??Zo,o=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let i=this.screenPos(),u=new be(S(0),e.width(),e.height());return!e.testRectPoint(u,i)&&u.sdistToPoint(i)>n*n},onExitScreen(i){return this.on("exitView",i)},onEnterScreen(i){return this.on("enterView",i)},update(){this.isOffScreen()?(o||(this.trigger("exitView"),o=!0),t.hide&&(this.hidden=!0),t.pause&&(this.paused=!0),t.destroy&&this.destroy()):(o&&(this.trigger("enterView"),o=!1),t.hide&&(this.hidden=!1),t.pause&&(this.paused=!1))}}}s(Ds,"offscreen");function _n(t){return t.fixed?!0:t.parent?_n(t.parent):!1}s(_n,"isFixed");function un(...t){let e=ne(this),{getViewportScale:n}=e._k;return{id:"pos",pos:S(...t),moveBy(...o){this.pos=this.pos.add(S(...o))},move(...o){this.moveBy(S(...o).scale(e.dt()))},moveTo(...o){if(typeof o[0]=="number"&&typeof o[1]=="number")return this.moveTo(S(o[0],o[1]),o[2]);let i=o[0],u=o[1];if(u===void 0){this.pos=S(i);return}let l=i.sub(this.pos);if(l.len()<=u*e.dt()){this.pos=S(i);return}this.move(l.unit().scale(u))},worldPos(o=null){if(o)this.pos=this.pos.add(this.fromWorld(o));else return this.parent?this.parent.transform.multVec2(this.pos):this.pos},toWorld(o){return this.parent?this.parent.transform.multVec2(this.pos.add(o)):this.pos.add(o)},fromWorld(o){return this.parent?this.parent.transform.invert().multVec2(o).sub(this.pos):o.sub(this.pos)},screenPos(o=null){if(o)this.pos=this.pos.add(this.fromScreen(o));else{let i=this.worldPos();return _n(this)?i:e.toScreen(i)}},toScreen(o){let i=this.toWorld(o);return _n(this)?i:e.toScreen(i)},fromScreen(o){return _n(this)?this.fromWorld(o):this.fromWorld(e.toWorld(o))},toOther(o,i){return o.fromWorld(this.toWorld(i))},fromOther(o,i){return o.toOther(this,i)},inspect(){return`pos: (${Math.round(this.pos.x)}x, ${Math.round(this.pos.y)}y)`},drawInspect(){e.drawCircle({color:e.rgb(255,0,0),radius:4/n()})}}}s(un,"pos");function Gs(t){return{id:"rotate",angle:t??0,rotateBy(e){this.angle+=e},rotateTo(e){this.angle=e},inspect(){return`angle: ${Math.round(this.angle)}`}}}s(Gs,"rotate");function cn(...t){let e=ne(this),{toFixed:n}=e._k;return t.length===0?cn(1):{id:"scale",scale:S(...t),scaleTo(...o){this.scale=S(...o)},scaleBy(...o){this.scale.scale(S(...o))},inspect(){return this.scale.x==this.scale.y?`scale: ${this.scale.x.toFixed(1)}x`:`scale: (${this.scale.x.toFixed(1)}x, ${this.scale.y.toFixed(1)}y)`}}}s(cn,"scale");function Bs(t){return{id:"z",z:t,inspect(){return`z: ${this.z}`}}}s(Bs,"z");var Fs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==";var Is="data:image/png;base64,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";var Ls=oo("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L5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV");var Ks="data:image/png;base64,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";var zs="3001.0.0";function Rt(t){switch(t){case"topleft":return new P(-1,-1);case"top":return new P(0,-1);case"topright":return new P(1,-1);case"left":return new P(-1,0);case"center":return new P(0,0);case"right":return new P(1,0);case"botleft":return new P(-1,1);case"bot":return new P(0,1);case"botright":return new P(1,1);default:return t}}s(Rt,"anchorPt");function ka(t){switch(t){case"left":return 0;case"center":return .5;case"right":return 1;default:return 0}}s(ka,"alignPt");function Na(t){return t.createBuffer(1,1,44100)}s(Na,"createEmptyAudioBuffer");var rt,_a=s(t=>t&&t.VERSION===zs,"isKaboomCtx"),ne=s(t=>{if(!rt)throw new Error("You are trying to access to Kaboom Context before their initialization.");return _a(t)?t:rt},"getKaboomContext"),Ha=s((t={})=>{let e=t.root??document.body;e===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let n=t.canvas??e.appendChild(document.createElement("canvas")),o=t.scale??1,i=t.width&&t.height&&!t.stretch&&!t.letterbox;i?(n.width=t.width*o,n.height=t.height*o):(n.width=n.parentElement.offsetWidth,n.height=n.parentElement.offsetHeight);let u=["outline: none","cursor: default"];if(i){let r=n.width,a=n.height;u.push(`width: ${r}px`),u.push(`height: ${a}px`)}else u.push("width: 100%"),u.push("height: 100%");t.crisp&&(u.push("image-rendering: pixelated"),u.push("image-rendering: crisp-edges")),n.style.cssText=u.join(";");let l=t.pixelDensity||window.devicePixelRatio;n.width*=l,n.height*=l,n.tabIndex=0;let m=document.createElement("canvas");m.width=256,m.height=256;let h=m.getContext("2d",{willReadFrequently:!0}),d=No({canvas:n,touchToMouse:t.touchToMouse,gamepads:t.gamepads,pixelDensity:t.pixelDensity,maxFPS:t.maxFPS,buttons:t.buttons}),M=[],y=d.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});if(!y||y===null)throw new Error("WebGL not supported");let U=Pr(y,{texFilter:t.texFilter}),x=(()=>{let r=kt(Gn,Bn),a=et.fromImage(U,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),c=t.width&&t.height?new Vt(U,t.width*l*o,t.height*l*o):new Vt(U,y.drawingBufferWidth,y.drawingBufferHeight),p=null,b=1;t.background&&(p=le(t.background),b=Array.isArray(t.background)?t.background[3]:1,y.clearColor(p.r/255,p.g/255,p.b/255,b??1)),y.enable(y.BLEND),y.blendFuncSeparate(y.SRC_ALPHA,y.ONE_MINUS_SRC_ALPHA,y.ONE,y.ONE_MINUS_SRC_ALPHA);let w=new Mn(U,Dn,Wo,$o),v=et.fromImage(U,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{lastDrawCalls:0,defShader:r,defTex:a,frameBuffer:c,postShader:null,postShaderUniform:null,renderer:w,transform:new $e,transformStack:[],bgTex:v,bgColor:p,bgAlpha:b,width:t.width??y.drawingBufferWidth/l/o,height:t.height??y.drawingBufferHeight/l/o,viewport:{x:0,y:0,width:y.drawingBufferWidth,height:y.drawingBufferHeight},fixed:!1}})();class K{static{s(this,"SpriteData")}tex;frames=[new pe(0,0,1,1)];anims={};slice9=null;constructor(a,c,p={},b=null){this.tex=a,c&&(this.frames=c),this.anims=p,this.slice9=b}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(a,c={}){return typeof a=="string"?K.fromURL(a,c):Promise.resolve(K.fromImage(a,c))}static fromImage(a,c={}){let[p,b]=j.packer.add(a),w=c.frames?c.frames.map(v=>new pe(b.x+v.x*b.w,b.y+v.y*b.h,v.w*b.w,v.h*b.h)):fe(c.sliceX||1,c.sliceY||1,b.x,b.y,b.w,b.h);return new K(p,w,c.anims,c.slice9)}static fromURL(a,c={}){return en(a).then(p=>K.fromImage(p,c))}}class H{static{s(this,"SoundData")}buf;constructor(a){this.buf=a}static fromArrayBuffer(a){return new Promise((c,p)=>ee.ctx.decodeAudioData(a,c,p)).then(c=>new H(c))}static fromURL(a){return Sr(a)?H.fromArrayBuffer(Bo(a)):Ho(a).then(c=>H.fromArrayBuffer(c))}}let ee=(()=>{let r=new(window.AudioContext||window.webkitAudioContext),a=r.createGain();a.connect(r.destination);let c=new H(Na(r));return r.decodeAudioData(Ls.buffer.slice(0)).then(p=>{c.buf=p}).catch(p=>{console.error("Failed to load burp: ",p)}),{ctx:r,masterNode:a,burpSnd:c}})(),j={urlPrefix:"",sprites:new ht,fonts:new ht,bitmapFonts:new ht,sounds:new ht,shaders:new ht,custom:new ht,music:{},packer:new rn(U,2048,2048),loaded:!1};function J(r){return typeof r!="string"||Sr(r)?r:j.urlPrefix+r}s(J,"fixURL");let V={events:new dt,objEvents:new dt,root:rr([]),gravity:null,scenes:{},currentScene:null,layers:null,defaultLayerIndex:0,logs:[],cam:{pos:null,scale:new P(1),angle:0,shake:0,transform:new $e}};V.root.use(kn());function se(r){return j.custom.add(null,r)}s(se,"load");function Q(){let r=[j.sprites,j.sounds,j.shaders,j.fonts,j.bitmapFonts,j.custom];return r.reduce((a,c)=>a+c.progress(),0)/r.length}s(Q,"loadProgress");function ue(r){return r!==void 0&&(j.urlPrefix=r),j.urlPrefix}s(ue,"loadRoot");function N(r,a){return j.custom.add(r,Zt(a))}s(N,"loadJSON");function _(r,a,c={}){let p=new FontFace(r,typeof a=="string"?`url(${a})`:a);return document.fonts.add(p),j.fonts.add(r,p.load().catch(b=>{throw new Error(`Failed to load font from "${a}": ${b}`)}).then(b=>new Pt(b,c)))}s(_,"loadFont");function me(r,a,c,p,b={}){return j.bitmapFonts.add(r,en(a).then(w=>Yn(et.fromImage(U,w,b),c,p,b.chars??Ur)))}s(me,"loadBitmapFont");function fe(r=1,a=1,c=0,p=0,b=1,w=1){let v=[],D=b/r,O=w/a;for(let g=0;g<a;g++)for(let C=0;C<r;C++)v.push(new pe(c+C*D,p+g*O,D,O));return v}s(fe,"slice");function ae(r,a){return r=J(r),se(typeof a=="string"?new Promise((c,p)=>{Zt(a).then(b=>{ae(r,b).then(c).catch(p)})}):K.from(r).then(c=>{let p={};for(let b in a){let w=a[b],v=c.frames[0],D=2048*v.w,O=2048*v.h,g=w.frames?w.frames.map(I=>new pe(v.x+(w.x+I.x)/D*v.w,v.y+(w.y+I.y)/O*v.h,I.w/D*v.w,I.h/O*v.h)):fe(w.sliceX||1,w.sliceY||1,v.x+w.x/D*v.w,v.y+w.y/O*v.h,w.width/D*v.w,w.height/O*v.h),C=new K(c.tex,g,w.anims);j.sprites.addLoaded(b,C),p[b]=C}return p}))}s(ae,"loadSpriteAtlas");function xe(r,a={}){let c=document.createElement("canvas"),p=r[0].width,b=r[0].height;c.width=p*r.length,c.height=b;let w=c.getContext("2d");if(!w)throw new Error("Failed to create canvas context");r.forEach((D,O)=>{D instanceof ImageData?w.putImageData(D,O*p,0):w.drawImage(D,O*p,0)});let v=w.getImageData(0,0,r.length*p,b);return K.fromImage(v,{...a,sliceX:r.length,sliceY:1})}s(xe,"createSpriteSheet");function he(r,a,c={sliceX:1,sliceY:1,anims:{}}){return a=J(a),Array.isArray(a)?a.some(p=>typeof p=="string")?j.sprites.add(r,Promise.all(a.map(p=>typeof p=="string"?en(p):Promise.resolve(p))).then(p=>xe(p,c))):j.sprites.addLoaded(r,xe(a,c)):typeof a=="string"?j.sprites.add(r,K.from(a,c)):j.sprites.addLoaded(r,K.fromImage(a,c))}s(he,"loadSprite");function Be(r,a){return a=J(a),j.sprites.add(r,new Promise(async c=>{let p=typeof a=="string"?await Zt(a):a,b=await Promise.all(p.frames.map(en)),w=document.createElement("canvas");w.width=p.width,w.height=p.height*p.frames.length;let v=w.getContext("2d");if(!v)throw new Error("Failed to create canvas context");b.forEach((O,g)=>{v.drawImage(O,0,g*p.height)});let D=await he(null,w,{sliceY:p.frames.length,anims:p.anims});c(D)}))}s(Be,"loadPedit");function de(r,a,c){a=J(a),c=J(c),typeof a=="string"&&!c&&(c=Io(a)+".json");let p=typeof c=="string"?Zt(c):Promise.resolve(c);return j.sprites.add(r,p.then(b=>{let w=b.meta.size,v=b.frames.map(O=>new pe(O.frame.x/w.w,O.frame.y/w.h,O.frame.w/w.w,O.frame.h/w.h)),D={};for(let O of b.meta.frameTags)O.from===O.to?D[O.name]=O.from:D[O.name]={from:O.from,to:O.to,speed:10,loop:!0,pingpong:O.direction==="pingpong"};return K.from(a,{frames:v,anims:D})}))}s(de,"loadAseprite");function Fe(r,a,c){return j.shaders.addLoaded(r,kt(a,c))}s(Fe,"loadShader");function ce(r,a,c){a=J(a),c=J(c);let p=s(w=>w?_o(w):Promise.resolve(null),"resolveUrl"),b=Promise.all([p(a),p(c)]).then(([w,v])=>kt(w,v));return j.shaders.add(r,b)}s(ce,"loadShaderURL");function ye(r,a){return a=J(a),j.sounds.add(r,typeof a=="string"?H.fromURL(a):H.fromArrayBuffer(a))}s(ye,"loadSound");function ve(r,a){let c=new Audio(a);return c.preload="auto",j.music[r]=J(a)}s(ve,"loadMusic");function Te(r="bean"){return he(r,Fs)}s(Te,"loadBean");function Se(r){return j.sprites.get(r)}s(Se,"getSprite");function Xe(r){return j.sounds.get(r)}s(Xe,"getSound");function te(r){return j.fonts.get(r)}s(te,"getFont");function Ut(r){return j.bitmapFonts.get(r)}s(Ut,"getBitmapFont");function ln(r){return j.shaders.get(r)}s(ln,"getShader");function Hn(r){return j.custom.get(r)}s(Hn,"getAsset");function mn(r){if(typeof r=="string"){let a=Se(r);if(a)return a;if(Q()<1)return null;throw new Error(`Sprite not found: ${r}`)}else{if(r instanceof K)return Ne.loaded(r);if(r instanceof Ne)return r;throw new Error(`Invalid sprite: ${r}`)}}s(mn,"resolveSprite");function qn(r){if(typeof r=="string"){let a=Xe(r);if(a)return a;if(Q()<1)return null;throw new Error(`Sound not found: ${r}`)}else{if(r instanceof H)return Ne.loaded(r);if(r instanceof Ne)return r;throw new Error(`Invalid sound: ${r}`)}}s(qn,"resolveSound");function zn(r){if(!r)return x.defShader;if(typeof r=="string"){let a=ln(r);if(a)return a.data??a;if(Q()<1)return null;throw new Error(`Shader not found: ${r}`)}else if(r instanceof Ne)return r.data?r.data:r;return r}s(zn,"resolveShader");function dn(r){if(!r)return dn(t.font??qo);if(typeof r=="string"){let a=Ut(r),c=te(r);if(a)return a.data??a;if(c)return c.data??c;if(document.fonts.check(`${64}px ${r}`))return r;if(Q()<1)return null;throw new Error(`Font not found: ${r}`)}else if(r instanceof Ne)return r.data?r.data:r;return r}s(dn,"resolveFont");function Wn(r){return r!==void 0&&(ee.masterNode.gain.value=r),ee.masterNode.gain.value}s(Wn,"volume");function $n(r,a={}){let c=new Pe,p=new Audio(r);ee.ctx.createMediaElementSource(p).connect(ee.masterNode);function w(){Ce.paused||d.isHidden()&&!t.backgroundAudio||ee.ctx.resume()}s(w,"resumeAudioCtx");function v(){w(),p.play()}return s(v,"play"),a.paused||v(),p.onended=()=>c.trigger(),{play(){v()},seek(D){p.currentTime=D},stop(){p.pause(),this.seek(0)},set loop(D){p.loop=D},get loop(){return p.loop},set paused(D){D?p.pause():v()},get paused(){return p.paused},time(){return p.currentTime},duration(){return p.duration},set volume(D){p.volume=it(D,0,1)},get volume(){return p.volume},set speed(D){p.playbackRate=Math.max(D,0)},get speed(){return p.playbackRate},set detune(D){},get detune(){return 0},onEnd(D){return c.add(D)},then(D){return this.onEnd(D)}}}s($n,"playMusic");function hn(r,a={}){if(typeof r=="string"&&j.music[r])return $n(j.music[r],a);let c=ee.ctx,p=a.paused??!1,b=c.createBufferSource(),w=new Pe,v=c.createGain(),D=a.seek??0,O=0,g=0,C=!1;b.loop=!!a.loop,b.detune.value=a.detune??0,b.playbackRate.value=a.speed??1,b.connect(v),b.onended=()=>{L()>=(b.buffer?.duration??Number.POSITIVE_INFINITY)&&w.trigger()},v.connect(ee.masterNode),v.gain.value=a.volume??1;let I=s(B=>{b.buffer=B.buf,p||(O=c.currentTime,b.start(0,D),C=!0)},"start"),G=qn(r);G instanceof Ne&&G.onLoad(I);let L=s(()=>{if(!b.buffer)return 0;let B=p?g-O:c.currentTime-O,A=b.buffer.duration;return b.loop?B%A:Math.min(B,A)},"getTime"),T=s(B=>{let A=c.createBufferSource();return A.buffer=B.buffer,A.loop=B.loop,A.playbackRate.value=B.playbackRate.value,A.detune.value=B.detune.value,A.onended=B.onended,A.connect(v),A},"cloneNode");return{stop(){this.paused=!0,this.seek(0)},set paused(B){if(p!==B)if(p=B,B)C&&(b.stop(),C=!1),g=c.currentTime;else{b=T(b);let A=g-O;b.start(0,A),C=!0,O=c.currentTime-A,g=0}},get paused(){return p},play(B=0){this.seek(B),this.paused=!1},seek(B){b.buffer?.duration&&(B>b.buffer.duration||(p?(b=T(b),O=g-B):(b.stop(),b=T(b),O=c.currentTime-B,b.start(0,B),C=!0,g=0)))},set speed(B){b.playbackRate.value=B},get speed(){return b.playbackRate.value},set detune(B){b.detune.value=B},get detune(){return b.detune.value},set volume(B){v.gain.value=Math.max(B,0)},get volume(){return v.gain.value},set loop(B){b.loop=B},get loop(){return b.loop},duration(){return b.buffer?.duration??0},time(){return L()%this.duration()},onEnd(B){return w.add(B)},then(B){return this.onEnd(B)}}}s(hn,"play");function pn(r){return hn(ee.burpSnd,r)}s(pn,"burp");function Xn(r,a){let c=new Vt(U,r,a);return{clear:s(()=>c.clear(),"clear"),free:s(()=>c.free(),"free"),toDataURL:s(()=>c.toDataURL(),"toDataURL"),toImageData:s(()=>c.toImageData(),"toImageData"),width:c.width,height:c.height,draw:s(p=>{_e(),c.bind(),p(),_e(),c.unbind()},"draw")}}s(Xn,"makeCanvas");function kt(r=Gn,a=Bn){let c=Xo.replace("{{user}}",r??Gn),p=Yo.replace("{{user}}",a??Bn);try{return new Un(U,c,p,Dn.map(b=>b.name))}catch(b){let v=/(?<type>^\w+) SHADER ERROR: 0:(?<line>\d+): (?<msg>.+)/,D=Ko(b).match(v);if(!D?.groups)throw b;let O=Number(D.groups.line)-14,g=D.groups.msg.trim(),C=D.groups.type.toLowerCase();throw new Error(`${C} shader line ${O}: ${g}`)}}s(kt,"makeShader");function Yn(r,a,c,p){let b=r.width/a,w={},v=p.split("").entries();for(let[D,O]of v)w[O]=new pe(D%b*a,Math.floor(D/b)*c,a,c);return{tex:r,map:w,size:c}}s(Yn,"makeFont");function ot(r,a,c,p=x.defTex,b=x.defShader,w={}){let v=zn(b);if(!v||v instanceof Ne)return;let D=x.fixed||c?x.transform:V.cam.transform.mult(x.transform),O=[];for(let g of r){let C=Jn(D.multVec2(g.pos));O.push(C.x,C.y,g.uv.x,g.uv.y,g.color.r/255,g.color.g/255,g.color.b/255,g.opacity)}x.renderer.push(y.TRIANGLES,O,a,v,p,w)}s(ot,"drawRaw");function _e(){x.renderer.flush()}s(_e,"flush");function Nt(){y.clear(y.COLOR_BUFFER_BIT),x.frameBuffer.bind(),y.clear(y.COLOR_BUFFER_BIT),x.bgColor||we(()=>{Mt({width:Le(),height:We(),quad:new pe(0,0,Le()/64,We()/64),tex:x.bgTex,fixed:!0})}),x.renderer.numDraws=0,x.fixed=!1,x.transformStack.length=0,x.transform=new $e}s(Nt,"frameStart");function Qn(r,a){x.postShader=r,x.postShaderUniform=a??null}s(Qn,"usePostEffect");function _t(){_e(),x.lastDrawCalls=x.renderer.numDraws,x.frameBuffer.unbind(),y.viewport(0,0,y.drawingBufferWidth,y.drawingBufferHeight);let r=x.width,a=x.height;x.width=y.drawingBufferWidth/l,x.height=y.drawingBufferHeight/l,Ht({flipY:!0,tex:x.frameBuffer.tex,pos:new P(x.viewport.x,x.viewport.y),width:x.viewport.width,height:x.viewport.height,shader:x.postShader,uniform:typeof x.postShaderUniform=="function"?x.postShaderUniform():x.postShaderUniform,fixed:!0}),_e(),x.width=r,x.height=a}s(_t,"frameEnd");function Jn(r){return new P(r.x/Le()*2-1,-r.y/We()*2+1)}s(Jn,"screen2ndc");function Zn(r){x.transform=r.clone()}s(Zn,"pushMatrix");function Ee(...r){if(r[0]===void 0)return;let a=S(...r);a.x===0&&a.y===0||x.transform.translate(a)}s(Ee,"pushTranslate");function yt(...r){if(r[0]===void 0)return;let a=S(...r);a.x===1&&a.y===1||x.transform.scale(a)}s(yt,"pushScale");function pt(r){r&&x.transform.rotate(r)}s(pt,"pushRotate");function He(){x.transformStack.push(x.transform.clone())}s(He,"pushTransform");function qe(){x.transformStack.length>0&&(x.transform=x.transformStack.pop())}s(qe,"popTransform");function Mt(r){if(r.width===void 0||r.height===void 0)throw new Error('drawUVQuad() requires property "width" and "height".');if(r.width<=0||r.height<=0)return;let a=r.width,c=r.height,b=Rt(r.anchor||jt).scale(new P(a,c).scale(-.5)),w=r.quad||new pe(0,0,1,1),v=r.color||le(255,255,255),D=r.opacity??1,O=r.tex?.1/r.tex.width:0,g=r.tex?.1/r.tex.height:0,C=w.x+O,I=w.y+g,G=w.w-O*2,L=w.h-g*2;He(),Ee(r.pos),pt(r.angle),yt(r.scale),Ee(b),ot([{pos:new P(-a/2,c/2),uv:new P(r.flipX?C+G:C,r.flipY?I:I+L),color:v,opacity:D},{pos:new P(-a/2,-c/2),uv:new P(r.flipX?C+G:C,r.flipY?I+L:I),color:v,opacity:D},{pos:new P(a/2,-c/2),uv:new P(r.flipX?C:C+G,r.flipY?I+L:I),color:v,opacity:D},{pos:new P(a/2,c/2),uv:new P(r.flipX?C:C+G,r.flipY?I:I+L),color:v,opacity:D}],[0,1,3,1,2,3],r.fixed,r.tex,r.shader,r.uniform),qe()}s(Mt,"drawUVQuad");function Ht(r){if(!r.tex)throw new Error('drawTexture() requires property "tex".');let a=r.quad??new pe(0,0,1,1),c=r.tex.width*a.w,p=r.tex.height*a.h,b=new P(1);if(r.tiled){let v=Rt(r.anchor||jt).add(new P(1,1)).scale(.5).scale(r.width||c,r.height||p),D=(r.width||c)/c,O=(r.height||p)/p,g=Math.floor(D),C=Math.floor(O),I=D-g,G=O-C,L=(g+I?1:0)*(C+G?1:0),T=new Array(L*6),B=new Array(L*4),A=0,$=s((q,W,Y,Ge,R)=>{T[A*6+0]=A*4+0,T[A*6+1]=A*4+1,T[A*6+2]=A*4+3,T[A*6+3]=A*4+1,T[A*6+4]=A*4+2,T[A*6+5]=A*4+3,B[A*4+0]={pos:new P(q-v.x,W-v.y),uv:new P(R.x,R.y),color:r.color||ie.WHITE,opacity:r.opacity||1},B[A*4+1]={pos:new P(q+Y-v.x,W-v.y),uv:new P(R.x+R.w,R.y),color:r.color||ie.WHITE,opacity:r.opacity||1},B[A*4+2]={pos:new P(q+Y-v.x,W+Ge-v.y),uv:new P(R.x+R.w,R.y+R.h),color:r.color||ie.WHITE,opacity:r.opacity||1},B[A*4+3]={pos:new P(q-v.x,W+Ge-v.y),uv:new P(R.x,R.y+R.h),color:r.color||ie.WHITE,opacity:r.opacity||1},A++},"addQuad");for(let q=0;q<C;q++){for(let W=0;W<g;W++)$(W*c,q*p,c,p,a);I&&$(g*c,q*p,c*I,p,new pe(a.x,a.y,a.w*I,a.h))}if(G){for(let q=0;q<g;q++)$(q*c,C*p,c,p*G,new pe(a.x,a.y,a.w,a.h*G));I&&$(g*c,C*p,c*I,p*G,new pe(a.x,a.y,a.w*I,a.h*G))}ot(B,T,r.fixed,r.tex,r.shader,r.uniform)}else r.width&&r.height?(b.x=r.width/c,b.y=r.height/p):r.width?(b.x=r.width/c,b.y=b.x):r.height&&(b.y=r.height/p,b.x=b.y),Mt(Object.assign({},r,{scale:b.scale(r.scale||new P(1)),tex:r.tex,quad:a,width:c,height:p}))}s(Ht,"drawTexture");function er(r){if(!r.sprite)throw new Error('drawSprite() requires property "sprite"');let a=mn(r.sprite);if(!a||!a.data)return;let c=a.data.frames[r.frame??0];if(!c)throw new Error(`Frame not found: ${r.frame??0}`);Ht(Object.assign({},r,{tex:a.data.tex,quad:c.scale(r.quad??new pe(0,0,1,1))}))}s(er,"drawSprite");function xt(r,a,c,p,b,w=1){p=Ve(p%360),b=Ve(b%360),b<=p&&(b+=Math.PI*2);let v=[],D=Math.ceil((b-p)/Ve(8)*w),O=(b-p)/D,g=S(Math.cos(p),Math.sin(p)),C=S(Math.cos(O),Math.sin(O));for(let I=0;I<=D;I++)v.push(r.add(a*g.x,c*g.y)),g=S(g.x*C.x-g.y*C.y,g.x*C.y+g.y*C.x);return v}s(xt,"getArcPts");function Ye(r){if(r.width===void 0||r.height===void 0)throw new Error('drawRect() requires property "width" and "height".');if(r.width<=0||r.height<=0)return;let a=r.width,c=r.height,b=Rt(r.anchor||jt).add(1,1).scale(new P(a,c).scale(-.5)),w=[new P(0,0),new P(a,0),new P(a,c),new P(0,c)];if(r.radius){let v=Math.min(a,c)/2,D=Array.isArray(r.radius)?r.radius.map(O=>Math.min(v,O)):new Array(4).fill(Math.min(v,r.radius));w=[new P(D[0],0),...D[1]?xt(new P(a-D[1],D[1]),D[1],D[1],270,360):[S(a,0)],...D[2]?xt(new P(a-D[2],c-D[2]),D[2],D[2],0,90):[S(a,c)],...D[3]?xt(new P(D[3],c-D[3]),D[3],D[3],90,180):[S(0,c)],...D[0]?xt(new P(D[0],D[0]),D[0],D[0],180,270):[]]}f(Object.assign({},r,{offset:b,pts:w,...r.gradient?{colors:r.horizontal?[r.gradient[0],r.gradient[1],r.gradient[1],r.gradient[0]]:[r.gradient[0],r.gradient[0],r.gradient[1],r.gradient[1]]}:{}}))}s(Ye,"drawRect");function vt(r){let{p1:a,p2:c}=r;if(!a||!c)throw new Error('drawLine() requires properties "p1" and "p2".');let p=r.width||1,b=c.sub(a).unit().normal().scale(p*.5),w=[a.sub(b),a.add(b),c.add(b),c.sub(b)].map(v=>({pos:new P(v.x,v.y),uv:new P(0),color:r.color??ie.WHITE,opacity:r.opacity??1}));ot(w,[0,1,3,1,2,3],r.fixed,x.defTex,r.shader,r.uniform)}s(vt,"drawLine");function tr(r){let a=r.pts,c=[],p=(r.width||1)*.5,b=a[0]===a[a.length-1]||a[0].eq(a[a.length-1]),w=r.pos||S(0,0),v;b?v=a[0].sub(a[a.length-2]):v=a[1].sub(a[0]);let D=v.len(),O=v.normal().scale(-p/D),g,C=a[0];if(!b)switch(r.cap){case"square":{let T=v.scale(-p/D);c.push(C.add(T).add(O)),c.push(C.add(T).sub(O));break}case"round":{let T=Math.max(p,10),B=Math.PI/T,A=O.scale(-1),$=Math.cos(B),q=Math.sin(B);for(let W=0;W<T;W++)c.push(C),c.push(C.sub(A)),A=S(A.x*$-A.y*q,A.x*q+A.y*$)}}for(let T=1;T<a.length;T++){if(C===a[T]||C.eq(a[T]))continue;g=C,C=a[T];let B=C.sub(g),A=B.len(),$=B.normal().scale(-p/A),q=v.cross(B);if(Math.abs(q)/(D*A)<.05){c.push(g.add(O)),c.push(g.sub(O)),v.dot(B)<0&&(c.push(g.sub(O)),c.push(g.add(O))),v=B,D=A,O=$;continue}let W=$.sub(O).cross(B)/q,Y=O.add(v.scale(W));q>0?(c.push(g.add(Y)),c.push(g.sub(O)),c.push(g.add(Y)),c.push(g.sub($))):(c.push(g.add(O)),c.push(g.sub(Y)),c.push(g.add($)),c.push(g.sub(Y))),v=B,D=A,O=$}if(!b)switch(c.push(C.add(O)),c.push(C.sub(O)),r.cap){case"square":{let T=v.scale(p/D);c.push(C.add(T).add(O)),c.push(C.add(T).sub(O));break}case"round":{let T=Math.max(p,10),B=Math.PI/T,A=O.scale(1),$=Math.cos(B),q=Math.sin(B);for(let W=0;W<T;W++)A=S(A.x*$-A.y*q,A.x*q+A.y*$),c.push(C),c.push(C.sub(A))}}if(c.length<4)return;let I=c.map(T=>({pos:w.add(T),uv:S(),color:r.color||ie.WHITE,opacity:r.opacity??1})),G=[],L=0;for(let T=0;T<c.length-2;T+=2)G[L++]=T+1,G[L++]=T,G[L++]=T+2,G[L++]=T+2,G[L++]=T+3,G[L++]=T+1;b&&(G[L++]=c.length-1,G[L++]=c.length-2,G[L++]=0,G[L++]=0,G[L++]=1,G[L++]=c.length-1),ot(I,G,r.fixed,x.defTex,r.shader,r.uniform)}s(tr,"_drawLinesBevel");function De(r){let a=r.pts,c=[],p=(r.width||1)*.5,b=a[0]===a[a.length-1]||a[0].eq(a[a.length-1]),w=r.pos||S(0,0),v;b?v=a[0].sub(a[a.length-2]):v=a[1].sub(a[0]);let D=v.len(),O=v.normal().scale(-p/D),g,C=a[0];if(!b)switch(r.cap){case"square":{let T=v.scale(-p/D);c.push(C.add(T).add(O)),c.push(C.add(T).sub(O));break}case"round":{let T=Math.max(p,10),B=Math.PI/T,A=O.scale(-1),$=Math.cos(B),q=Math.sin(B);for(let W=0;W<T;W++)c.push(C),c.push(C.sub(A)),A=S(A.x*$-A.y*q,A.x*q+A.y*$)}}for(let T=1;T<a.length;T++){if(C===a[T]||C.eq(a[T]))continue;g=C,C=a[T];let B=C.sub(g),A=B.len(),$=B.normal().scale(-p/A),q=v.cross(B);if(Math.abs(q)/(D*A)<.05){c.push(g.add(O)),c.push(g.sub(O)),v.dot(B)<0&&(c.push(g.sub(O)),c.push(g.add(O))),v=B,D=A,O=$;continue}let W=$.sub(O).cross(B)/q,Y=O.add(v.scale(W));if(q>0){let Ge=g.add(Y),R=Math.max(p,10),z=Ve(O.angleBetween($)/R),k=O,X=Math.cos(z),re=Math.sin(z);for(let oe=0;oe<R;oe++)c.push(Ge),c.push(g.sub(k)),k=S(k.x*X-k.y*re,k.x*re+k.y*X)}else{let Ge=g.sub(Y),R=Math.max(p,10),z=Ve(O.angleBetween($)/R),k=O,X=Math.cos(z),re=Math.sin(z);for(let oe=0;oe<R;oe++)c.push(g.add(k)),c.push(Ge),k=S(k.x*X-k.y*re,k.x*re+k.y*X)}v=B,D=A,O=$}if(!b)switch(c.push(C.add(O)),c.push(C.sub(O)),r.cap){case"square":{let T=v.scale(p/D);c.push(C.add(T).add(O)),c.push(C.add(T).sub(O));break}case"round":{let T=Math.max(p,10),B=Math.PI/T,A=O.scale(1),$=Math.cos(B),q=Math.sin(B);for(let W=0;W<T;W++)A=S(A.x*$-A.y*q,A.x*q+A.y*$),c.push(C),c.push(C.sub(A))}}if(c.length<4)return;let I=c.map(T=>({pos:w.add(T),uv:S(),color:r.color||ie.WHITE,opacity:r.opacity??1})),G=[],L=0;for(let T=0;T<c.length-2;T+=2)G[L++]=T+1,G[L++]=T,G[L++]=T+2,G[L++]=T+2,G[L++]=T+3,G[L++]=T+1;b&&(G[L++]=c.length-1,G[L++]=c.length-2,G[L++]=0,G[L++]=0,G[L++]=1,G[L++]=c.length-1),ot(I,G,r.fixed,x.defTex,r.shader,r.uniform)}s(De,"_drawLinesRound");function wt(r){let a=r.pts,c=[],p=(r.width||1)*.5,b=a[0]===a[a.length-1]||a[0].eq(a[a.length-1]),w=r.pos||S(0,0),v;b?v=a[0].sub(a[a.length-2]):v=a[1].sub(a[0]);let D=v.len(),O=v.normal().scale(-p/D),g,C=a[0];if(!b)switch(r.cap){case"square":{let T=v.scale(-p/D);c.push(C.add(T).add(O)),c.push(C.add(T).sub(O));break}case"round":{let T=Math.max(p,10),B=Math.PI/T,A=O.scale(-1),$=Math.cos(B),q=Math.sin(B);for(let W=0;W<T;W++)c.push(C),c.push(C.sub(A)),A=S(A.x*$-A.y*q,A.x*q+A.y*$)}}for(let T=1;T<a.length;T++){if(C===a[T]||C.eq(a[T]))continue;g=C,C=a[T];let B=C.sub(g),A=B.len(),$=B.normal().scale(-p/A),q=v.cross(B);if(Math.abs(q)/(D*A)<.05){c.push(g.add(O)),c.push(g.sub(O)),v.dot(B)<0&&(c.push(g.sub(O)),c.push(g.add(O))),v=B,D=A,O=$;continue}let W=$.sub(O).cross(B)/q,Y=O.add(v.scale(W));c.push(g.add(Y)),c.push(g.sub(Y)),v=B,D=A,O=$}if(!b)switch(c.push(C.add(O)),c.push(C.sub(O)),r.cap){case"square":{let T=v.scale(p/D);c.push(C.add(T).add(O)),c.push(C.add(T).sub(O));break}case"round":{let T=Math.max(p,10),B=Math.PI/T,A=O.scale(1),$=Math.cos(B),q=Math.sin(B);for(let W=0;W<T;W++)A=S(A.x*$-A.y*q,A.x*q+A.y*$),c.push(C),c.push(C.sub(A))}}if(c.length<4)return;let I=c.map(T=>({pos:w.add(T),uv:S(),color:r.color||ie.WHITE,opacity:r.opacity??1})),G=[],L=0;for(let T=0;T<c.length-2;T+=2)G[L++]=T+1,G[L++]=T,G[L++]=T+2,G[L++]=T+2,G[L++]=T+3,G[L++]=T+1;b&&(G[L++]=c.length-1,G[L++]=c.length-2,G[L++]=0,G[L++]=0,G[L++]=1,G[L++]=c.length-1),ot(I,G,r.fixed,x.defTex,r.shader,r.uniform)}s(wt,"_drawLinesMiter");function st(r){let a=r.pts;if(!a)throw new Error('drawLines() requires property "pts".');if(!(a.length<2)){if(a.length>2)switch(r.join){case"bevel":return tr(r);case"round":return De(r);case"miter":return wt(r)}if(r.radius&&a.length>=3){vt(Object.assign({},r,{p1:a[0],p2:a[1]}));for(let c=1;c<a.length-2;c++){let p=a[c],b=a[c+1];vt(Object.assign({},r,{p1:p,p2:b}))}vt(Object.assign({},r,{p1:a[a.length-2],p2:a[a.length-1]}))}else for(let c=0;c<a.length-1;c++)vt(Object.assign({},r,{p1:a[c],p2:a[c+1]})),r.join!=="none"&&Dt(Object.assign({},r,{pos:a[c],radius:r.width/2}))}}s(st,"drawLines");function qt(r,a){let c=a.segments??16,p=[];for(let b=0;b<=c;b++)p.push(r(b/c));st({pts:p,width:a.width||1,pos:a.pos,color:a.color,opacity:a.opacity})}s(qt,"drawCurve");function fn(r){qt(a=>An(r.pt1,r.pt2,r.pt3,r.pt4,a),r)}s(fn,"drawBezier");function gn(r){if(!r.p1||!r.p2||!r.p3)throw new Error('drawTriangle() requires properties "p1", "p2" and "p3".');return f(Object.assign({},r,{pts:[r.p1,r.p2,r.p3]}))}s(gn,"drawTriangle");function Dt(r){if(typeof r.radius!="number")throw new Error('drawCircle() requires property "radius".');r.radius!==0&&zt(Object.assign({},r,{radiusX:r.radius,radiusY:r.radius,angle:0}))}s(Dt,"drawCircle");function zt(r){if(r.radiusX===void 0||r.radiusY===void 0)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(r.radiusX===0||r.radiusY===0)return;let a=r.start??0,c=r.end??360,p=Rt(r.anchor??"center").scale(new P(-r.radiusX,-r.radiusY)),b=xt(p,r.radiusX,r.radiusY,a,c,r.resolution);b.unshift(p);let w=Object.assign({},r,{pts:b,radius:0,...r.gradient?{colors:[r.gradient[0],...Array(b.length-1).fill(r.gradient[1])]}:{}});if(c-a>=360&&r.outline){r.fill!==!1&&f(Object.assign({},w,{outline:null})),f(Object.assign({},w,{pts:b.slice(1),fill:!1}));return}f(w)}s(zt,"drawEllipse");function f(r){if(!r.pts)throw new Error('drawPolygon() requires property "pts".');let a=r.pts.length;if(!(a<3)){if(He(),Ee(r.pos),yt(r.scale),pt(r.angle),Ee(r.offset),r.fill!==!1){let c=r.color??ie.WHITE,p=r.pts.map((w,v)=>({pos:new P(w.x,w.y),uv:r.uv?r.uv[v]:new P(0,0),color:r.colors&&r.colors[v]?r.colors[v].mult(c):c,opacity:r.opacity??1})),b;r.triangulate?b=wr(r.pts).map(v=>v.map(D=>r.pts.indexOf(D))).flat():b=[...Array(a-2).keys()].map(w=>[0,w+1,w+2]).flat(),ot(p,r.indices??b,r.fixed,r.uv?r.tex:x.defTex,r.shader,r.uniform)}r.outline&&st({pts:[...r.pts,r.pts[0]],radius:r.radius,width:r.outline.width,color:r.outline.color,join:r.outline.join,uniform:r.uniform,fixed:r.fixed,opacity:r.opacity??r.outline.opacity}),qe()}}s(f,"drawPolygon");function E(r,a,c){_e(),y.clear(y.STENCIL_BUFFER_BIT),y.enable(y.STENCIL_TEST),y.stencilFunc(y.NEVER,1,255),y.stencilOp(y.REPLACE,y.REPLACE,y.REPLACE),a(),_e(),y.stencilFunc(c,1,255),y.stencilOp(y.KEEP,y.KEEP,y.KEEP),r(),_e(),y.disable(y.STENCIL_TEST)}s(E,"drawStenciled");function F(r,a){E(r,a,y.EQUAL)}s(F,"drawMasked");function Z(r,a){E(r,a,y.NOTEQUAL)}s(Z,"drawSubtracted");function Ue(){return(x.viewport.width+x.viewport.height)/(x.width+x.height)}s(Ue,"getViewportScale");function we(r){_e();let a=x.width,c=x.height;x.width=x.viewport.width,x.height=x.viewport.height,r(),_e(),x.width=a,x.height=c}s(we,"drawUnscaled");function Oe(r,a){a.pos&&(r.pos=r.pos.add(a.pos)),a.scale&&(r.scale=r.scale.scale(S(a.scale))),a.angle&&(r.angle+=a.angle),a.color&&r.ch.length===1&&(r.color=r.color.mult(a.color)),a.opacity&&(r.opacity*=a.opacity)}s(Oe,"applyCharTransform");function ut(r){let a={},c=r.replace(Mr,"$2"),p=0;for(let b of r.matchAll(Mr)){let w=b.index-p;for(let v=0;v<b.groups.text.length;v++)a[v+w]=[b.groups.style];p+=b[0].length-b.groups.text.length}return{charStyleMap:a,text:c}}s(ut,"compileStyledText");let tt={};function ze(r){if(r.text===void 0)throw new Error('formatText() requires property "text".');let a=dn(r.font);if(r.text===""||a instanceof Ne||!a)return{width:0,height:0,chars:[],opt:r};let{charStyleMap:c,text:p}=ut(r.text+""),b=jo(p);if(a instanceof Pt||typeof a=="string"){let q=a instanceof Pt?a.fontface.family:a,W=a instanceof Pt?{outline:a.outline,filter:a.filter}:{outline:null,filter:nn},Y=tt[q]??{font:{tex:new et(U,2048,2048,{filter:W.filter}),map:{},size:64},cursor:new P(0),outline:W.outline};tt[q]||(tt[q]=Y),a=Y.font;for(let Ge of b)if(!Y.font.map[Ge]){let R=h;R.clearRect(0,0,m.width,m.height),R.font=`${a.size}px ${q}`,R.textBaseline="top",R.textAlign="left",R.fillStyle="#ffffff";let z=R.measureText(Ge),k=Math.ceil(z.width);if(!k)continue;let X=a.size;Y.outline&&(R.lineJoin="round",R.lineWidth=Y.outline.width*2,R.strokeStyle=Y.outline.color.toHex(),R.strokeText(Ge,Y.outline.width,Y.outline.width),k+=Y.outline.width*2,X+=Y.outline.width*3),R.fillText(Ge,Y.outline?.width??0,Y.outline?.width??0);let re=R.getImageData(0,0,k,X);if(Y.cursor.x+k>2048&&(Y.cursor.x=0,Y.cursor.y+=X,Y.cursor.y>2048))throw new Error("Font atlas exceeds character limit");a.tex.update(re,Y.cursor.x,Y.cursor.y),a.map[Ge]=new pe(Y.cursor.x,Y.cursor.y,k,X),Y.cursor.x+=k}}let w=r.size||a.size,v=S(r.scale??1).scale(w/a.size),D=r.lineSpacing??0,O=r.letterSpacing??0,g=0,C=0,I=0,G=[],L=[],T=0,B=null,A=null;for(;T<b.length;){let q=b[T];if(q===`
`)I+=w+D,G.push({width:g-O,chars:L}),B=null,A=null,g=0,L=[];else{let W=a.map[q];if(W){let Y=W.w*v.x;r.width&&g+Y>r.width&&(I+=w+D,B!=null&&(T-=L.length-B,q=b[T],W=a.map[q],Y=W.w*v.x,L=L.slice(0,B-1),g=A),B=null,A=null,G.push({width:g-O,chars:L}),g=0,L=[]),L.push({tex:a.tex,width:W.w,height:W.h,quad:new pe(W.x/a.tex.width,W.y/a.tex.height,W.w/a.tex.width,W.h/a.tex.height),ch:q,pos:new P(g,I),opacity:r.opacity??1,color:r.color??ie.WHITE,scale:S(v),angle:0}),q===" "&&(B=L.length,A=g),g+=Y,C=Math.max(C,g),g+=O}}T++}G.push({width:g-O,chars:L}),I+=w,r.width&&(C=r.width);let $=[];for(let q=0;q<G.length;q++){let W=(C-G[q].width)*ka(r.align??"left");for(let Y of G[q].chars){let Ge=a.map[Y.ch],R=$.length+q;if(Y.pos=Y.pos.add(W,0).add(Ge.w*v.x*.5,Ge.h*v.y*.5),r.transform){let z=typeof r.transform=="function"?r.transform(R,Y.ch):r.transform;z&&Oe(Y,z)}if(c[R]){let z=c[R];for(let k of z){let X=r.styles[k],re=typeof X=="function"?X(R,Y.ch):X;re&&Oe(Y,re)}}$.push(Y)}}return{width:C,height:I,chars:$,opt:r}}s(ze,"formatText");function Gt(r){Bt(ze(r))}s(Gt,"drawText");function Bt(r){He(),Ee(r.opt.pos),pt(r.opt.angle),Ee(Rt(r.opt.anchor??"topleft").add(1,1).scale(r.width,r.height).scale(-.5)),r.chars.forEach(a=>{Mt({tex:a.tex,width:a.width,height:a.height,pos:a.pos,scale:a.scale,angle:a.angle,color:a.color,opacity:a.opacity,quad:a.quad,anchor:"center",uniform:r.opt.uniform,shader:r.opt.shader,fixed:r.opt.fixed})}),qe()}s(Bt,"drawFormattedText");function Le(){return x.width}s(Le,"width");function We(){return x.height}s(We,"height");function Ws(){return V.root}s(Ws,"getTreeRoot");function $s(r){return new P((r.x-x.viewport.x)*Le()/x.viewport.width,(r.y-x.viewport.y)*We()/x.viewport.height)}s($s,"windowToContent");function Xs(r){return new P(r.x*x.viewport.width/x.width,r.y*x.viewport.height/x.height)}s(Xs,"contentToView");function qr(){return $s(d.mousePos())}s(qr,"mousePos");let zr=!1,Ce={inspect:!1,timeScale:1,showLog:!0,fps:s(()=>d.fps(),"fps"),numFrames:s(()=>d.numFrames(),"numFrames"),stepFrame:eo,drawCalls:s(()=>x.lastDrawCalls,"drawCalls"),clearLog:s(()=>V.logs=[],"clearLog"),log:s(r=>{let a=t.logMax??8;V.logs.unshift({msg:r,time:d.time()}),V.logs.length>a&&(V.logs=V.logs.slice(0,a))},"log"),error:s(r=>Ce.log(new Error(r.toString?r.toString():r)),"error"),curRecording:null,numObjects:s(()=>ir("*",{recursive:!0}).length,"numObjects"),get paused(){return zr},set paused(r){zr=r,r?ee.ctx.suspend():ee.ctx.resume()}};function nr(){return d.dt()*Ce.timeScale}s(nr,"dt");function Ys(...r){return r.length>0&&(V.cam.pos=S(...r)),V.cam.pos?V.cam.pos.clone():yn()}s(Ys,"camPos");function Qs(...r){return r.length>0&&(V.cam.scale=S(...r)),V.cam.scale.clone()}s(Qs,"camScale");function Js(r){return r!==void 0&&(V.cam.angle=r),V.cam.angle}s(Js,"camRot");function Zs(r=le(255,255,255),a=1){let c=Ft([Lr(Le(),We()),Br(r),Fr(1),Hr()]),p=c.fadeOut(a);return p.onEnd(()=>Jr(c)),p}s(Zs,"camFlash");function ei(){return V.cam.transform.clone()}s(ei,"camTransform");function ti(r=12){V.cam.shake+=r}s(ti,"shake");function ni(r){return V.cam.transform.multVec2(r)}s(ni,"toScreen");function ri(r){return V.cam.transform.invert().multVec2(r)}s(ri,"toWorld");function Wr(r){let a=new $e;return r.pos&&a.translate(r.pos),r.scale&&a.scale(r.scale),r.angle&&a.rotate(r.angle),r.parent?a.mult(r.parent.transform):a}s(Wr,"calcTransform");function rr(r=[]){let a=new Map,c={},p=new dt,b=[],w=null,v=!1,D={id:Lo(),hidden:!1,transform:new $e,children:[],parent:null,set paused(g){if(g!==v){v=g;for(let C of b)C.paused=g}},get paused(){return v},get tags(){let g=[];for(let[C,I]of a.entries())Object.keys(I).length==1&&g.push(C);return g},add(g){let C=Array.isArray(g)?rr(g):g;if(C.parent)throw new Error("Cannot add a game obj that already has a parent.");return C.parent=this,C.transform=Wr(C),this.children.push(C),C.trigger("add",C),V.events.trigger("add",C),C},readd(g){let C=this.children.indexOf(g);return C!==-1&&(this.children.splice(C,1),this.children.push(g)),g},remove(g){let C=this.children.indexOf(g);if(C!==-1){g.parent=null,this.children.splice(C,1);let I=s(G=>{G.trigger("destroy"),V.events.trigger("destroy",G),G.children.forEach(L=>I(L))},"trigger");I(g)}},removeAll(g){if(g)this.get(g).forEach(C=>this.remove(C));else for(let C of[...this.children])this.remove(C)},update(){this.paused||(this.children.forEach(g=>g.update()),this.trigger("update"))},draw(){if(this.hidden)return;this.canvas&&(_e(),this.canvas.bind());let g=x.fixed;this.fixed&&(x.fixed=!0),He(),Ee(this.pos),yt(this.scale),pt(this.angle);let C=this.children.sort((I,G)=>{let L=I.layerIndex??V.defaultLayerIndex,T=G.layerIndex??V.defaultLayerIndex;return L-T||(I.z??0)-(G.z??0)});if(this.mask){let I={intersect:F,subtract:Z}[this.mask];if(!I)throw new Error(`Invalid mask func: "${this.mask}"`);I(()=>{C.forEach(G=>G.draw())},()=>{this.trigger("draw")})}else this.trigger("draw"),C.forEach(I=>I.draw());qe(),x.fixed=g,this.canvas&&(_e(),this.canvas.unbind())},drawInspect(){this.hidden||(He(),Ee(this.pos),yt(this.scale),pt(this.angle),this.children.forEach(g=>g.drawInspect()),this.trigger("drawInspect"),qe())},use(g){if(!g)return;if(ko(g)&&(g=new g(this)),typeof g=="function")return this.use(g(this));if(typeof g=="string")return this.use({id:g});let C=[];g.id&&(this.unuse(g.id),c[g.id]=[],C=c[g.id],a.set(g.id,g));for(let G in g){if(Qo.has(G))continue;let L=Object.getOwnPropertyDescriptor(g,G);if(typeof L.value=="function"&&(g[G]=g[G].bind(this)),L.set&&Object.defineProperty(g,G,{set:L.set.bind(this)}),L.get&&Object.defineProperty(g,G,{get:L.get.bind(this)}),Jo.has(G)){let T=G==="add"?()=>{w=s(B=>C.push(B),"onCurCompCleanup"),g[G](),w=null}:g[G];C.push(this.on(G,T).cancel)}else if(this[G]===void 0)Object.defineProperty(this,G,{get:s(()=>g[G],"get"),set:s(T=>g[G]=T,"set"),configurable:!0,enumerable:!0}),C.push(()=>delete this[G]);else throw new Error(`Duplicate component property: "${G}"`)}let I=s(()=>{if(g.require){for(let G of g.require)if(!this.c(G))throw new Error(`Component "${g.id}" requires component "${G}"`)}},"checkDeps");g.destroy&&C.push(g.destroy.bind(this)),this.exists()?(I(),g.add&&(w=s(G=>C.push(G),"onCurCompCleanup"),g.add.call(this),w=null)):g.require&&C.push(this.on("add",I).cancel)},unuse(g){if(a.has(g)){for(let C of a.values())if(C.require&&C.require.includes(g))throw new Error(`Can't unuse. Component "${C.id}" requires component "${g}"`);a.delete(g)}c[g]&&(c[g].forEach(C=>C()),delete c[g])},c(g){return a.get(g)},get(g,C={}){let I=C.recursive?this.children.flatMap(s(function G(L){return[L,...L.children.flatMap(G)]},"recurse")):this.children;if(I=I.filter(G=>g?G.is(g):!0),C.liveUpdate){let G=s(T=>C.recursive?this.isAncestorOf(T):T.parent===this,"isChild"),L=[];L.push(or(T=>{G(T)&&T.is(g)&&I.push(T)})),L.push($r(T=>{if(G(T)&&T.is(g)){let B=I.findIndex(A=>A.id===T.id);B!==-1&&I.splice(B,1)}})),this.onDestroy(()=>{for(let T of L)T.cancel()})}return I},query(g){let C=g.hierarchy||"children",I=[];switch(C){case"children":I=this.children;break;case"siblings":I=this.parent?this.parent.children.filter(L=>L!==this):[];break;case"ancestors":let G=this.parent;for(;G;)I.push(G),G=G.parent;break;case"descendants":I=this.children.flatMap(s(function L(T){return[T,...T.children.flatMap(L)]},"recurse"));break}if(g.include&&((g.includeOp||"and")==="and"||!Array.isArray(g.include)?I=I.filter(L=>L.is(g.include)):I=I.filter(L=>g.include.some(T=>L.is(T)))),g.exclude&&((g.includeOp||"and")==="and"||!Array.isArray(g.include)?I=I.filter(L=>!L.is(g.exclude)):I=I.filter(L=>!g.exclude.some(T=>L.is(T)))),g.visible===!0&&(I=I.filter(G=>G.visible)),g.distance){if(!this.pos)throw Error("Can't do a distance query from an object without pos");let G=g.distanceOp||"near",L=g.distance*g.distance;G==="near"?I=I.filter(T=>T.pos&&this.pos.sdist(T.pos)<=L):I=I.filter(T=>T.pos&&this.pos.sdist(T.pos)>L)}return g.name&&(I=I.filter(G=>G.name===g.name)),I},isAncestorOf(g){return g.parent?g.parent===this||this.isAncestorOf(g.parent):!1},exists(){return V.root.isAncestorOf(this)},is(g){if(g==="*")return!0;if(Array.isArray(g)){for(let C of g)if(!this.c(C))return!1;return!0}else return this.c(g)!=null},on(g,C){let I=p.on(g,C.bind(this));return w&&w(()=>I.cancel()),I},trigger(g,...C){p.trigger(g,...C),V.objEvents.trigger(g,this,...C)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let g={};for(let[C,I]of a)g[C]=I.inspect?I.inspect():null;return g},onAdd(g){return this.on("add",g)},onUpdate(g){return this.on("update",g)},onDraw(g){return this.on("draw",g)},onDestroy(g){return this.on("destroy",g)},clearEvents(){p.clear()}},O=["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick","onButtonPress","onButtonDown","onButtonRelease"];for(let g of O)D[g]=(...C)=>{let I=d[g]?.(...C);return b.push(I),D.onDestroy(()=>I.cancel()),I};for(let g of r)D.use(g);return D}s(rr,"make");function ft(r,a,c){return V.objEvents[r]||(V.objEvents[r]=new Jt),V.objEvents.on(r,(p,...b)=>{p.is(a)&&c(p,...b)})}s(ft,"on");let oi=Re(r=>{let a=Ft([{update:r}]);return{get paused(){return a.paused},set paused(c){a.paused=c},cancel:s(()=>a.destroy(),"cancel")}},(r,a)=>ft("update",r,a)),si=Re(r=>{let a=Ft([{draw:r}]);return{get paused(){return a.hidden},set paused(c){a.hidden=c},cancel:s(()=>a.destroy(),"cancel")}},(r,a)=>ft("draw",r,a)),or=Re(r=>V.events.on("add",r),(r,a)=>ft("add",r,a)),$r=Re(r=>V.events.on("destroy",r),(r,a)=>ft("destroy",r,a));function ii(r,a,c){return ft("collide",r,(p,b,w)=>b.is(a)&&c(p,b,w))}s(ii,"onCollide");function ai(r,a,c){return ft("collideUpdate",r,(p,b,w)=>b.is(a)&&c(p,b,w))}s(ai,"onCollideUpdate");function ui(r,a,c){return ft("collideEnd",r,(p,b,w)=>b.is(a)&&c(p,b,w))}s(ui,"onCollideEnd");function bn(r,a){ir(r,{recursive:!0}).forEach(a),or(r,a)}s(bn,"forAllCurrentAndFuture");let ci=Re(r=>d.onMousePress(r),(r,a)=>{let c=[];return bn(r,p=>{if(!p.area)throw new Error("onClick() requires the object to have area() component");c.push(p.onClick(()=>a(p)))}),mt.join(c)});function li(r,a){let c=[];return bn(r,p=>{if(!p.area)throw new Error("onHover() requires the object to have area() component");c.push(p.onHover(()=>a(p)))}),mt.join(c)}s(li,"onHover");function mi(r,a){let c=[];return bn(r,p=>{if(!p.area)throw new Error("onHoverUpdate() requires the object to have area() component");c.push(p.onHoverUpdate(()=>a(p)))}),mt.join(c)}s(mi,"onHoverUpdate");function di(r,a){let c=[];return bn(r,p=>{if(!p.area)throw new Error("onHoverEnd() requires the object to have area() component");c.push(p.onHoverEnd(()=>a(p)))}),mt.join(c)}s(di,"onHoverEnd");function hi(r){V.gravity=r?(V.gravity||S(0,1)).unit().scale(r):null}s(hi,"setGravity");function pi(){return V.gravity?V.gravity.len():0}s(pi,"getGravity");function fi(r){V.gravity=r.unit().scale(V.gravity?V.gravity.len():1)}s(fi,"setGravityDirection");function gi(){return V.gravity?V.gravity.unit():S(0,1)}s(gi,"getGravityDirection");function bi(...r){r.length===1||r.length===2?(x.bgColor=le(r[0]),r[1]&&(x.bgAlpha=r[1])):(r.length===3||r.length===4)&&(x.bgColor=le(r[0],r[1],r[2]),r[3]&&(x.bgAlpha=r[3])),y.clearColor(x.bgColor.r/255,x.bgColor.g/255,x.bgColor.b/255,x.bgAlpha)}s(bi,"setBackground");function yi(){return x.bgColor.clone()}s(yi,"getBackground");function sr(r,a){return Number(r.toFixed(a))}s(sr,"toFixed");function Xr(r){return r.fixed?!0:r.parent?Xr(r.parent):!1}s(Xr,"isFixed");function xi(r){return{color:r.color,opacity:r.opacity,anchor:r.anchor,outline:r.outline,shader:r.shader,uniform:r.uniform}}s(xi,"getRenderProps");function vi(r){j.loaded?r():V.events.on("load",r)}s(vi,"onLoad");function wi(r,a){V.scenes[r]=a}s(wi,"scene");function Ci(r,...a){if(!V.scenes[r])throw new Error(`Scene not found: ${r}`);V.events.onOnce("frameEnd",()=>{V.events.trigger("sceneLeave",r),d.events.clear(),V.events.clear(),V.objEvents.clear(),[...V.root.children].forEach(c=>{(!c.stay||c.scenesToStay&&!c.scenesToStay.includes(r))&&V.root.remove(c)}),V.root.clearEvents(),ro(),V.cam={pos:null,scale:S(1),angle:0,shake:0,transform:new $e},V.scenes[r](...a)}),V.currentScene=r}s(Ci,"go");function Ti(r){return V.events.on("sceneLeave",r)}s(Ti,"onSceneLeave");function Si(){return V.currentScene}s(Si,"getSceneName");function Ei(r,a){try{return JSON.parse(window.localStorage[r])}catch{return a?(Yr(r,a),a):null}}s(Ei,"getData");function Yr(r,a){window.localStorage[r]=JSON.stringify(a)}s(Yr,"setData");function Qr(r,...a){let c=r(rt),p;typeof c=="function"?p=c(...a)(rt):p=c;for(let b in p)rt[b]=p[b],t.global!==!1&&(window[b]=p[b]);return rt}s(Qr,"plug");function yn(){return S(Le()/2,We()/2)}s(yn,"center");let Oi;(A=>(A[A.None=0]="None",A[A.Left=1]="Left",A[A.Top=2]="Top",A[A.LeftTop=3]="LeftTop",A[A.Right=4]="Right",A[A.Horizontal=5]="Horizontal",A[A.RightTop=6]="RightTop",A[A.HorizontalTop=7]="HorizontalTop",A[A.Bottom=8]="Bottom",A[A.LeftBottom=9]="LeftBottom",A[A.Vertical=10]="Vertical",A[A.LeftVertical=11]="LeftVertical",A[A.RightBottom=12]="RightBottom",A[A.HorizontalBottom=13]="HorizontalBottom",A[A.RightVertical=14]="RightVertical",A[A.All=15]="All"))(Oi||={});function Ai(r,a){if(!a.tileWidth||!a.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let c=Ft([un(a.pos??S(0))]),p=r.length,b=0,w=null,v=null,D=null,O=null,g=s(R=>R.x+R.y*b,"tile2Hash"),C=s(R=>S(Math.floor(R%b),Math.floor(R/b)),"hash2Tile"),I=s(()=>{w=[];for(let R of c.children)G(R)},"createSpatialMap"),G=s(R=>{let z=g(R.tilePos);w[z]?w[z].push(R):w[z]=[R]},"insertIntoSpatialMap"),L=s(R=>{let z=g(R.tilePos);if(w[z]){let k=w[z].indexOf(R);k>=0&&w[z].splice(k,1)}},"removeFromSpatialMap"),T=s(()=>{let R=!1;for(let z of c.children){let k=c.pos2Tile(z.pos);(z.tilePos.x!=k.x||z.tilePos.y!=k.y)&&(R=!0,L(z),z.tilePos.x=k.x,z.tilePos.y=k.y,G(z))}R&&c.trigger("spatial_map_changed")},"updateSpatialMap"),B=s(()=>{let R=c.getSpatialMap(),z=c.numRows()*c.numColumns();v?v.length=z:v=new Array(z),v.fill(1,0,z);for(let k=0;k<R.length;k++){let X=R[k];if(X){let re=0;for(let oe of X)if(oe.isObstacle){re=1/0;break}else re+=oe.cost;v[k]=re||1}}},"createCostMap"),A=s(()=>{let R=c.getSpatialMap(),z=c.numRows()*c.numColumns();D?D.length=z:D=new Array(z),D.fill(15,0,z);for(let k=0;k<R.length;k++){let X=R[k];if(X){let re=X.length,oe=15;for(let ge=0;ge<re;ge++)oe|=X[ge].edgeMask;D[k]=oe}}},"createEdgeMap"),$=s(()=>{let R=c.numRows()*c.numColumns(),z=s((X,re)=>{let oe=[];for(oe.push(X);oe.length>0;){let ge=oe.pop();Y(ge).forEach(Me=>{O[Me]<0&&(O[Me]=re,oe.push(Me))})}},"traverse");O?O.length=R:O=new Array(R),O.fill(-1,0,R);let k=0;for(let X=0;X<v.length;X++){if(O[X]>=0){k++;continue}z(X,k),k++}},"createConnectivityMap"),q=s((R,z)=>v[z],"getCost"),W=s((R,z)=>{let k=C(R),X=C(z);return k.dist(X)},"getHeuristic"),Y=s((R,z)=>{let k=[],X=Math.floor(R%b),re=X>0&&D[R]&1&&v[R-1]!==1/0,oe=R>=b&&D[R]&2&&v[R-b]!==1/0,ge=X<b-1&&D[R]&4&&v[R+1]!==1/0,Me=R<b*p-b-1&&D[R]&8&&v[R+b]!==1/0;return z?(re&&(oe&&k.push(R-b-1),k.push(R-1),Me&&k.push(R+b-1)),oe&&k.push(R-b),ge&&(oe&&k.push(R-b+1),k.push(R+1),Me&&k.push(R+b+1)),Me&&k.push(R+b)):(re&&k.push(R-1),oe&&k.push(R-b),ge&&k.push(R+1),Me&&k.push(R+b)),k},"getNeighbours"),Ge={id:"level",tileWidth(){return a.tileWidth},tileHeight(){return a.tileHeight},spawn(R,...z){let k=S(...z),X=(()=>{if(typeof R=="string"){if(a.tiles[R]){if(typeof a.tiles[R]!="function")throw new Error("Level symbol def must be a function returning a component list");return a.tiles[R](k)}else if(a.wildcardTile)return a.wildcardTile(R,k)}else{if(Array.isArray(R))return R;throw new Error("Expected a symbol or a component list")}})();if(!X)return null;let re=!1,oe=!1;for(let Me of X)Me.id==="tile"&&(oe=!0),Me.id==="pos"&&(re=!0);re||X.push(un()),oe||X.push(Kr());let ge=c.add(X);return re&&(ge.tilePosOffset=ge.pos.clone()),ge.tilePos=k,w&&(G(ge),this.trigger("spatial_map_changed"),this.trigger("navigation_map_invalid")),ge},numColumns(){return b},numRows(){return p},levelWidth(){return b*this.tileWidth()},levelHeight(){return p*this.tileHeight()},tile2Pos(...R){return S(...R).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...R){let z=S(...R);return S(Math.floor(z.x/this.tileWidth()),Math.floor(z.y/this.tileHeight()))},getSpatialMap(){return w||I(),w},onSpatialMapChanged(R){return this.on("spatial_map_changed",R)},onNavigationMapInvalid(R){return this.on("navigation_map_invalid",R)},getAt(R){w||I();let z=g(R);return w[z]||[]},raycast(R,z){R=R.scale(1/this.tileWidth(),1/this.tileHeight());let k=vo(R,z,X=>{let re=this.getAt(X);if(re.some(ge=>ge.isObstacle))return!0;let oe;for(let ge of re)if(ge.is("area")){let Ct=ge.worldArea().raycast(R,z);oe?Ct.fraction<oe.fraction&&(oe=Ct,oe.object=ge):(oe=Ct,oe.object=ge)}return oe||!1},64);return k&&(k.point=k.point.scale(this.tileWidth(),this.tileHeight())),k},update(){w&&T()},invalidateNavigationMap(){v=null,D=null,O=null},onNavigationMapChanged(R){return this.on("navigation_map_changed",R)},getTilePath(R,z,k={}){if(v||B(),D||A(),O||$(),R.x<0||R.x>=b||R.y<0||R.y>=p||z.x<0||z.x>=b||z.y<0||z.y>=p)return null;let X=g(R),re=g(z);if(v[re]===1/0)return null;if(X===re)return[];if(O[X]!=-1&&O[X]!==O[re])return null;let oe=new Kt((ct,ur)=>ct.cost<ur.cost);oe.insert({cost:0,node:X});let ge=new Map;ge.set(X,X);let Me=new Map;for(Me.set(X,0);oe.length!==0;){let ct=oe.remove()?.node;if(ct===re)break;let ur=Y(ct,k.allowDiagonals);for(let Tt of ur){let cr=(Me.get(ct)||0)+q(ct,Tt)+W(Tt,re);(!Me.has(Tt)||cr<Me.get(Tt))&&(Me.set(Tt,cr),oe.insert({cost:cr,node:Tt}),ge.set(Tt,ct))}}let Ct=[],Wt=re,Yi=C(Wt);for(Ct.push(Yi);Wt!==X;){Wt=ge.get(Wt);let ct=C(Wt);Ct.push(ct)}return Ct.reverse()},getPath(R,z,k={}){let X=this.tileWidth(),re=this.tileHeight(),oe=this.getTilePath(this.pos2Tile(R),this.pos2Tile(z),k);return oe?[R,...oe.slice(1,-1).map(ge=>ge.scale(X,re).add(X/2,re/2)),z]:null}};return c.use(Ge),c.onNavigationMapInvalid(()=>{c.invalidateNavigationMap(),c.trigger("navigation_map_changed")}),r.forEach((R,z)=>{let k=R.split("");b=Math.max(k.length,b),k.forEach((X,re)=>{c.spawn(X,S(re,z))})}),c}s(Ai,"addLevel");function Vi(r){let a=d.canvas.captureStream(r),c=ee.ctx.createMediaStreamDestination();ee.masterNode.connect(c);let p=new MediaRecorder(a),b=[];return p.ondataavailable=w=>{w.data.size>0&&b.push(w.data)},p.onerror=()=>{ee.masterNode.disconnect(c),a.getTracks().forEach(w=>w.stop())},p.start(),{resume(){p.resume()},pause(){p.pause()},stop(){return p.stop(),ee.masterNode.disconnect(c),a.getTracks().forEach(w=>w.stop()),new Promise(w=>{p.onstop=()=>{w(new Blob(b,{type:"video/mp4"}))}})},download(w="kaboom.mp4"){this.stop().then(v=>Tr(w,v))}}}s(Vi,"record");function Pi(){return document.activeElement===d.canvas}s(Pi,"isFocused");function Jr(r){r.destroy()}s(Jr,"destroy");let Ft=V.root.add.bind(V.root),Ri=V.root.readd.bind(V.root),Ui=V.root.removeAll.bind(V.root),ir=V.root.get.bind(V.root),Mi=V.root.wait.bind(V.root),Di=V.root.loop.bind(V.root),Gi=V.root.query.bind(V.root),Bi=V.root.tween.bind(V.root),Fi=s(function(r,a){if(V.layers)throw Error("Layers can only be assigned once.");let c=r.indexOf(a);if(c==-1)throw Error("The default layer name should be present in the layers list.");V.layers=r,V.defaultLayerIndex=c},"layers");function Zr(r=2,a=1){let c=0;return{require:["scale"],update(){let p=Math.sin(c*r)*a;p<0&&this.destroy(),this.scale=S(p),c+=nr()}}}s(Zr,"boom");let Ii=he(null,Ks),Li=he(null,Is);function Ki(r,a={}){let c=Ft([un(r),_r()]),p=(a.speed||1)*5,b=a.scale||1;c.add([jn(Li),cn(0),Nn("center"),Zr(p,b),...a.comps??[]]);let w=c.add([jn(Ii),cn(0),Nn("center"),kn(),...a.comps??[]]);return w.wait(.4/p,()=>w.use(Zr(p,b))),w.onDestroy(()=>c.destroy()),c}s(Ki,"addKaboom");function eo(){V.root.update()}s(eo,"updateFrame");class ar{static{s(this,"Collision")}source;target;displacement;resolved=!1;constructor(a,c,p,b=!1){this.source=a,this.target=c,this.displacement=p,this.resolved=b}reverse(){return new ar(this.target,this.source,this.displacement.scale(-1),this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.cross(V.gravity||S(0,1))>0}isRight(){return this.displacement.cross(V.gravity||S(0,1))<0}isTop(){return this.displacement.dot(V.gravity||S(0,1))>0}isBottom(){return this.displacement.dot(V.gravity||S(0,1))<0}preventResolution(){this.resolved=!0}}function ji(){let r={},a=t.hashGridSize||64,c=new $e,p=[];function b(w){if(p.push(c.clone()),w.pos&&c.translate(w.pos),w.scale&&c.scale(w.scale),w.angle&&c.rotate(w.angle),w.transform=c.clone(),w.c("area")&&!w.paused){let v=w,O=v.worldArea().bbox(),g=Math.floor(O.pos.x/a),C=Math.floor(O.pos.y/a),I=Math.ceil((O.pos.x+O.width)/a),G=Math.ceil((O.pos.y+O.height)/a),L=new Set;for(let T=g;T<=I;T++)for(let B=C;B<=G;B++)if(!r[T])r[T]={},r[T][B]=[v];else if(!r[T][B])r[T][B]=[v];else{let A=r[T][B];e:for(let $ of A){if($.paused||!$.exists()||L.has($.id))continue;for(let W of v.collisionIgnore)if($.is(W))continue e;for(let W of $.collisionIgnore)if(v.is(W))continue e;let q=Uo(v.worldArea(),$.worldArea());if(q){let W=new ar(v,$,q);v.trigger("collideUpdate",$,W);let Y=W.reverse();Y.resolved=W.resolved,$.trigger("collideUpdate",v,Y)}L.add($.id)}A.push(v)}}w.children.forEach(b),c=p.pop()}s(b,"checkObj"),b(V.root)}s(ji,"checkFrame");function ki(){let r=V.cam,a=P.fromAngle(at(0,360)).scale(r.shake);r.shake=Ke(r.shake,0,5*nr()),r.transform=new $e().translate(yn()).scale(r.scale).rotate(r.angle).translate((r.pos??yn()).scale(-1).add(a)),V.root.draw(),_e()}s(ki,"drawFrame");function Ni(){let r=Q();V.events.numListeners("loading")>0?V.events.trigger("loading",r):we(()=>{let a=Le()/2,c=24,p=S(Le()/2,We()/2).sub(S(a/2,c/2));Ye({pos:S(0),width:Le(),height:We(),color:le(0,0,0)}),Ye({pos:p,width:a,height:c,fill:!1,outline:{width:4}}),Ye({pos:p,width:a*r,height:c})})}s(Ni,"drawLoadScreen");function to(r,a){we(()=>{let c=S(8);He(),Ee(r);let p=ze({text:a,font:tn,size:16,pos:c,color:le(255,255,255),fixed:!0}),b=p.width+c.x*2,w=p.height+c.x*2;r.x+b>=Le()&&Ee(S(-b,0)),r.y+w>=We()&&Ee(S(0,-w)),Ye({width:b,height:w,color:le(0,0,0),radius:4,opacity:.8,fixed:!0}),Bt(p),qe()})}s(to,"drawInspectText");function _i(){if(Ce.inspect){let r=null;for(let a of V.root.get("*",{recursive:!0}))if(a.c("area")&&a.isHovering()){r=a;break}if(V.root.drawInspect(),r){let a=[],c=r.inspect();for(let p in c)c[p]?a.push(`${c[p]}`):a.push(`${p}`);to(Xs(qr()),a.join(`
`))}to(S(8),`FPS: ${Ce.fps()}`)}Ce.paused&&we(()=>{He(),Ee(Le(),0),Ee(-8,8);let r=32;Ye({width:r,height:r,anchor:"topright",color:le(0,0,0),opacity:.8,radius:4,fixed:!0});for(let a=1;a<=2;a++)Ye({width:4,height:r*.6,anchor:"center",pos:S(-r/3*a,r*.5),color:le(255,255,255),radius:2,fixed:!0});qe()}),Ce.timeScale!==1&&we(()=>{He(),Ee(Le(),We()),Ee(-8,-8);let r=8,a=ze({text:Ce.timeScale.toFixed(1),font:tn,size:16,color:le(255,255,255),pos:S(-r),anchor:"botright",fixed:!0});Ye({width:a.width+r*2+r*4,height:a.height+r*2,anchor:"botright",color:le(0,0,0),opacity:.8,radius:4,fixed:!0});for(let c=0;c<2;c++){let p=Ce.timeScale<1;gn({p1:S(-a.width-r*(p?2:3.5),-r),p2:S(-a.width-r*(p?2:3.5),-r-a.height),p3:S(-a.width-r*(p?3.5:2),-r-a.height/2),pos:S(-c*r*1+(p?-r*.5:0),0),color:le(255,255,255),fixed:!0})}Bt(a),qe()}),Ce.curRecording&&we(()=>{He(),Ee(0,We()),Ee(24,-24),Dt({radius:12,color:le(255,0,0),opacity:hr(0,1,d.time()*4),fixed:!0}),qe()}),Ce.showLog&&V.logs.length>0&&we(()=>{He(),Ee(0,We()),Ee(8,-8);let r=8,a=[];for(let p of V.logs){let b="",w=p.msg instanceof Error?"error":"info";b+=`[time]${p.time.toFixed(2)}[/time]`,b+=" ",b+=`[${w}]${p.msg?.toString?p.msg.toString():p.msg}[/${w}]`,a.push(b)}V.logs=V.logs.filter(p=>d.time()-p.time<(t.logTime||4));let c=ze({text:a.join(`
`),font:tn,pos:S(r,-r),anchor:"botleft",size:16,width:Le()*.6,lineSpacing:r/2,fixed:!0,styles:{time:{color:le(127,127,127)},info:{color:le(255,255,255)},error:{color:le(255,0,127)}}});Ye({width:c.width+r*2,height:c.height+r*2,anchor:"botleft",color:le(0,0,0),radius:4,opacity:.8,fixed:!0}),Bt(c),qe()})}s(_i,"drawDebug");function Hi(r){V.events.on("loading",r)}s(Hi,"onLoading");function qi(r){d.onResize(r)}s(qi,"onResize");function zi(r){V.events.on("error",r)}s(zi,"onError");function Wi(r){console.error(r),ee.ctx.suspend(),d.run(()=>{Nt(),we(()=>{let p=Le(),b=We(),w={size:36,width:p-32*2,letterSpacing:4,lineSpacing:4,font:tn,fixed:!0};Ye({width:p,height:b,color:le(0,0,255),fixed:!0});let v=ze({...w,text:"Error",pos:S(32),color:le(255,128,0),fixed:!0});Bt(v),Gt({...w,text:r.message,pos:S(32,32+v.height+16),fixed:!0}),qe(),V.events.trigger("error",r)}),_t()})}s(Wi,"handleErr");function $i(r){M.push(r)}s($i,"onCleanup");function Xi(){V.events.onOnce("frameEnd",()=>{d.quit(),y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT|y.STENCIL_BUFFER_BIT);let r=y.getParameter(y.MAX_TEXTURE_IMAGE_UNITS);for(let a=0;a<r;a++)y.activeTexture(y.TEXTURE0+a),y.bindTexture(y.TEXTURE_2D,null),y.bindTexture(y.TEXTURE_CUBE_MAP,null);y.bindBuffer(y.ARRAY_BUFFER,null),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,null),y.bindRenderbuffer(y.RENDERBUFFER,null),y.bindFramebuffer(y.FRAMEBUFFER,null),U.destroy(),M.forEach(a=>a())})}s(Xi,"quit");let xn=!0;d.run(()=>{try{j.loaded||Q()===1&&!xn&&(j.loaded=!0,V.events.trigger("load")),!j.loaded&&t.loadingScreen!==!1||xn?(Nt(),Ni(),_t()):(Ce.paused||eo(),ji(),Nt(),ki(),t.debug!==!1&&_i(),_t()),xn&&(xn=!1),V.events.trigger("frameEnd")}catch(r){Wi(r)}});function no(){let r=l,a=y.drawingBufferWidth/r,c=y.drawingBufferHeight/r;if(t.letterbox){if(!t.width||!t.height)throw new Error("Letterboxing requires width and height defined.");let p=a/c,b=t.width/t.height;if(p>b){let w=c*b,v=(a-w)/2;x.viewport={x:v,y:0,width:w,height:c}}else{let w=a/b,v=(c-w)/2;x.viewport={x:0,y:v,width:a,height:w}}return}if(t.stretch&&(!t.width||!t.height))throw new Error("Stretching requires width and height defined.");x.viewport={x:0,y:0,width:a,height:c}}s(no,"updateViewport");function ro(){d.onHide(()=>{t.backgroundAudio||ee.ctx.suspend()}),d.onShow(()=>{!t.backgroundAudio&&!Ce.paused&&ee.ctx.resume()}),d.onResize(()=>{if(d.isFullscreen())return;let r=t.width&&t.height;r&&!t.stretch&&!t.letterbox||(n.width=n.offsetWidth*l,n.height=n.offsetHeight*l,no(),r||(x.frameBuffer.free(),x.frameBuffer=new Vt(U,y.drawingBufferWidth,y.drawingBufferHeight),x.width=y.drawingBufferWidth/l/o,x.height=y.drawingBufferHeight/l/o))}),t.debug!==!1&&(d.onKeyPress(t.debugKey??"f1",()=>Ce.inspect=!Ce.inspect),d.onKeyPress("f2",()=>Ce.clearLog()),d.onKeyPress("f8",()=>Ce.paused=!Ce.paused),d.onKeyPress("f7",()=>{Ce.timeScale=sr(it(Ce.timeScale-.2,0,2),1)}),d.onKeyPress("f9",()=>{Ce.timeScale=sr(it(Ce.timeScale+.2,0,2),1)}),d.onKeyPress("f10",()=>Ce.stepFrame())),t.burp&&d.onKeyPress("b",()=>pn())}if(s(ro,"initEvents"),no(),ro(),rt={_k:{kaboomCtx:rt,app:d,game:V,isFixed:Xr,toFixed:sr,getViewportScale:Ue,getRenderProps:xi,resolveSprite:mn,drawTexture:Ht,drawRaw:ot,calcTransform:Wr},VERSION:zs,loadRoot:ue,loadProgress:Q,loadSprite:he,loadSpriteAtlas:ae,loadSound:ye,loadMusic:ve,loadBitmapFont:me,loadFont:_,loadShader:Fe,loadShaderURL:ce,loadAseprite:de,loadPedit:Be,loadBean:Te,loadJSON:N,load:se,getSprite:Se,getSound:Xe,getFont:te,getBitmapFont:Ut,getShader:ln,getAsset:Hn,Asset:Ne,SpriteData:K,SoundData:H,width:Le,height:We,center:yn,dt:nr,time:d.time,screenshot:d.screenshot,record:Vi,isFocused:Pi,setCursor:d.setCursor,getCursor:d.getCursor,setCursorLocked:d.setCursorLocked,isCursorLocked:d.isCursorLocked,setFullscreen:d.setFullscreen,isFullscreen:d.isFullscreen,isTouchscreen:d.isTouchscreen,onLoad:vi,onLoading:Hi,onResize:qi,onGamepadConnect:d.onGamepadConnect,onGamepadDisconnect:d.onGamepadDisconnect,onError:zi,onCleanup:$i,camPos:Ys,camScale:Qs,camFlash:Zs,camRot:Js,camTransform:ei,shake:ti,toScreen:ni,toWorld:ri,setGravity:hi,getGravity:pi,setGravityDirection:fi,getGravityDirection:gi,setBackground:bi,getBackground:yi,getGamepads:d.getGamepads,getTreeRoot:Ws,add:Ft,make:rr,destroy:Jr,destroyAll:Ui,get:ir,query:Gi,readd:Ri,pos:un,scale:cn,rotate:Gs,color:Br,opacity:Fr,anchor:Nn,area:As,sprite:jn,text:ps,polygon:ds,rect:Lr,circle:is,uvquad:fs,outline:ls,particles:ms,body:Vs,doubleJump:Ps,shader:hs,textInput:Os,timer:kn,fixed:Hr,stay:_r,health:Cs,lifespan:Ts,named:Ss,state:Es,z:Bs,layer:Us,move:Ms,offscreen:Ds,follow:Rs,fadeIn:us,mask:cs,drawon:as,raycast:Kn,tile:Kr,animate:ws,agent:gs,sentry:xs,patrol:ys,navigation:bs,on:ft,onUpdate:oi,onDraw:si,onAdd:or,onDestroy:$r,onClick:ci,onCollide:ii,onCollideUpdate:ai,onCollideEnd:ui,onHover:li,onHoverUpdate:mi,onHoverEnd:di,onKeyDown:d.onKeyDown,onKeyPress:d.onKeyPress,onKeyPressRepeat:d.onKeyPressRepeat,onKeyRelease:d.onKeyRelease,onMouseDown:d.onMouseDown,onMousePress:d.onMousePress,onMouseRelease:d.onMouseRelease,onMouseMove:d.onMouseMove,onCharInput:d.onCharInput,onTouchStart:d.onTouchStart,onTouchMove:d.onTouchMove,onTouchEnd:d.onTouchEnd,onScroll:d.onScroll,onHide:d.onHide,onShow:d.onShow,onGamepadButtonDown:d.onGamepadButtonDown,onGamepadButtonPress:d.onGamepadButtonPress,onGamepadButtonRelease:d.onGamepadButtonRelease,onGamepadStick:d.onGamepadStick,onButtonPress:d.onButtonPress,onButtonDown:d.onButtonDown,onButtonRelease:d.onButtonRelease,mousePos:qr,mouseDeltaPos:d.mouseDeltaPos,isKeyDown:d.isKeyDown,isKeyPressed:d.isKeyPressed,isKeyPressedRepeat:d.isKeyPressedRepeat,isKeyReleased:d.isKeyReleased,isMouseDown:d.isMouseDown,isMousePressed:d.isMousePressed,isMouseReleased:d.isMouseReleased,isMouseMoved:d.isMouseMoved,isGamepadButtonPressed:d.isGamepadButtonPressed,isGamepadButtonDown:d.isGamepadButtonDown,isGamepadButtonReleased:d.isGamepadButtonReleased,getGamepadStick:d.getGamepadStick,isButtonPressed:d.isButtonPressed,isButtonDown:d.isButtonDown,isButtonReleased:d.isButtonReleased,setButton:d.setButton,getButton:d.getButton,charInputted:d.charInputted,loop:Di,wait:Mi,play:hn,volume:Wn,burp:pn,audioCtx:ee.ctx,Line:je,Rect:be,Circle:ke,Ellipse:Je,Point:wn,Polygon:Ie,Vec2:P,Color:ie,Mat4:$e,Quad:pe,RNG:Yt,rand:at,randi:pr,randSeed:uo,vec2:S,rgb:le,hsl2rgb:ao,quad:Ae,choose:mo,chooseMultiple:lo,shuffle:fr,chance:co,lerp:Ke,tween:Bi,easings:bt,map:Ze,mapc:io,wave:hr,deg2rad:Ve,rad2deg:gt,clamp:it,evaluateQuadratic:wo,evaluateQuadraticFirstDerivative:Co,evaluateQuadraticSecondDerivative:To,evaluateBezier:An,evaluateBezierFirstDerivative:So,evaluateBezierSecondDerivative:Eo,evaluateCatmullRom:Vn,evaluateCatmullRomFirstDerivative:Oo,curveLengthApproximation:vr,normalizedCurve:Ao,easingSteps:Ro,easingLinear:Vo,easingCubicBezier:Po,testLineLine:Cn,testRectRect:gr,testRectLine:Tn,testRectPoint:Sn,testCirclePolygon:Qt,testLinePoint:En,testLineCircle:Lt,isConvex:Do,triangulate:wr,NavMesh:Fn,drawSprite:er,drawText:Gt,formatText:ze,drawRect:Ye,drawLine:vt,drawLines:st,drawTriangle:gn,drawCircle:Dt,drawEllipse:zt,drawUVQuad:Mt,drawPolygon:f,drawCurve:qt,drawBezier:fn,drawFormattedText:Bt,drawMasked:F,drawSubtracted:Z,pushTransform:He,popTransform:qe,pushTranslate:Ee,pushScale:yt,pushRotate:pt,pushMatrix:Zn,usePostEffect:Qn,makeCanvas:Xn,debug:Ce,scene:wi,getSceneName:Si,go:Ci,onSceneLeave:Ti,layers:Fi,addLevel:Ai,getData:Ei,setData:Yr,download:Rn,downloadJSON:Fo,downloadText:Cr,downloadBlob:Tr,plug:Qr,ASCII_CHARS:Ur,canvas:d.canvas,addKaboom:Ki,LEFT:P.LEFT,RIGHT:P.RIGHT,UP:P.UP,DOWN:P.DOWN,RED:ie.RED,GREEN:ie.GREEN,BLUE:ie.BLUE,YELLOW:ie.YELLOW,MAGENTA:ie.MAGENTA,CYAN:ie.CYAN,WHITE:ie.WHITE,BLACK:ie.BLACK,quit:Xi,KEvent:Pe,KEventHandler:dt,KEventController:mt},t.plugins&&t.plugins.forEach(Qr),t.global!==!1)for(let r in rt)window[r]=rt[r];return t.focus!==!1&&d.canvas.focus(),rt},"kaplay"),Rd=Ha;export{Rt as anchorPt,Rd as default,ne as getKaboomContext,_a as isKaboomCtx};
//# sourceMappingURL=kaboom.mjs.map
